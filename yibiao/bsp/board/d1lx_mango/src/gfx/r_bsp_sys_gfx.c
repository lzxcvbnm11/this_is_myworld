/* **************************************************************************** PROJECT : BSP - GFX FILE : $Id: r_bsp_sys_gfx.c 7643 2016-02-12 15:52:29Z florian.zimmermann $ ============================================================================ DESCRIPTION BSP Implementation D1X MANGO Board ============================================================================ C O P Y R I G H T ============================================================================ Copyright (c) 2014 by Renesas Electronics (Europe) GmbH. Arcadiastrasse 10 D-40472 Duesseldorf Germany All rights reserved. ============================================================================ Purpose: only for testing  DISCLAIMER This software is supplied by Renesas Electronics Corporation and is only intended for use with Renesas products. No other uses are authorized. This software is owned by Renesas Electronics Corporation and is protected under all applicable laws, including copyright laws. THIS SOFTWARE IS PROVIDED "AS IS" AND RENESAS MAKES NO WARRANTIES REGARDING THIS SOFTWARE, WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. ALL SUCH WARRANTIES ARE EXPRESSLY DISCLAIMED. TO THE MAXIMUM EXTENT PERMITTED NOT PROHIBITED BY LAW, NEITHER RENESAS ELECTRONICS CORPORATION NOR ANY OF ITS AFFILIATED COMPANIES SHALL BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES FOR ANY REASON RELATED TO THIS SOFTWARE, EVEN IF RENESAS OR ITS AFFILIATES HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. Renesas reserves the right, without notice, to make changes to this software and to discontinue the availability of this software. By using this software, you agree to the additional terms and conditions found by accessing the following link: http://www.renesas.com/disclaimer * Copyright (C) 2014 Renesas Electronics Corporation. All rights reserved.  **************************************************************************** */  /* Section: BSP SYS GFX description  This is the board specific GFX implementation for the BSP.  */   /******************************************************************************* Section: Includes */  #include "r_typedefs.h" /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Renesas basic types, e.g. uint32_t */  #include "r_tick_api.h" #include "r_dev_api.h" #include "r_gpio_api.h" #include "r_xbus_api.h"  #include "r_bsp_gfx_api.h" #include "r_bsp_gfx_sys.h" #include "r_bsp_board_config.h"  #ifdef BSP_INIT_SFMA #include "r_sfma_calib.h" #include "yd_sfma_api.h" #include "r_sfma_api.h"  #include "r_sfcdb_macronix.h" #include "r_sfcdb_spansion.h" #include "r_bsp_stdio_api.h" #endif   /******************************************************************************* Section: Local Defines */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Module reset control register */ #define LOC_MRSTC 0xFFF8F400u #define LOC_PROTSMRST 0xFFF8F484u #define LOC_PROTCMDMRST 0xFFF8F480u  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Module reset control register bits */ #define MRSTC_XC0RES ((uint32_t)(1ul<<13u)) #define MRSTC_SDRB0RES ((uint32_t)(1ul<<12u)) #define MRSTC_MLBB0RES ((uint32_t)(1ul<<11u)) #define MRSTC_LCBI0RES ((uint32_t)(1ul<<10u)) #define MRSTC_SG4RES ((uint32_t)(1ul<<9u)) #define MRSTC_SG3RES ((uint32_t)(1ul<<8u)) #define MRSTC_SG2RES ((uint32_t)(1ul<<7u)) #define MRSTC_SG1RES ((uint32_t)(1ul<<6u)) #define MRSTC_SG0RES ((uint32_t)(1ul<<5u)) #define MRSTC_ADCE0RES ((uint32_t)(1ul<<4u)) #define MRSTC_ISM0RES ((uint32_t)(1ul<<3u)) #define MRSTC_ETNB0RES ((uint32_t)(1ul<<2u)) #define MRSTC_VDCE1RES ((uint32_t)(1ul<<1u)) #define MRSTC_VDCE0RES ((uint32_t)(1ul<<0u))   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SDRA (DBSC3) DDR2-SDRAM MemC registers (for MANGO) */  #define DBSVCR 0xFFFA0004u #define DBSTATE0 0xFFFA0008u #define DBSTATE1 0xFFFA000cu #define DBACEN 0xFFFA0010u #define DBRFEN 0xFFFA0014u #define DBCMD 0xFFFA0018u #define DBWAIT 0xFFFA001cu #define DBKIND 0xFFFA0020u #define DBCONF0 0xFFFA0024u #define DBCONF1 0xFFFA0028u #define DBPHYTYPE 0xFFFA0030u #define DBTR0 0xFFFA0040u #define DBTR1 0xFFFA0044u #define DBTR2 0xFFFA0048u #define DBTR3 0xFFFA0050u #define DBTR4 0xFFFA0054u #define DBTR5 0xFFFA0058u #define DBTR6 0xFFFA005cu #define DBTR7 0xFFFA0060u #define DBTR8 0xFFFA0064u #define DBTR9 0xFFFA0068u #define DBTR10 0xFFFA006cu #define DBTR11 0xFFFA0070u #define DBTR12 0xFFFA0074u #define DBTR13 0xFFFA0078u #define DBTR14 0xFFFA007cu #define DBTR15 0xFFFA0080u #define DBTR16 0xFFFA0084u #define DBTR17 0xFFFA0088u #define DBTR18 0xFFFA008cu #define DBTR19 0xFFFA0090u #define DBBL 0xFFFA00b0u #define DBADJ0 0xFFFA00c0u #define DBADJ2 0xFFFA00c8u #define DBRFCNF0 0xFFFA00e0u #define DBRFCNF1 0xFFFA00e4u #define DBRFCNF2 0xFFFA00e8u #define DBRNK0 0xFFFA0100u #define DBPDNCNF 0xFFFA0180u #define DBPDCNT0 0xFFFA0200u #define DBPDCNT1 0xFFFA0204u #define DBPDCNT2 0xFFFA0208u #define DBPDCNT3 0xFFFA020cu #define DBPDLCK 0xFFFA0280u #define DBPDRGA 0xFFFA0290u #define DBPDRGD 0xFFFA02a0u  #define DBBS0CNT1 0xFFFA0304u  #define DBLGCNT0 0xFFFA1000u #define DBTMVAL00 0xFFFA1004u #define DBRQCTR0 0xFFFA1014u #define DBTHRES00 0xFFFA1018u #define DBTHRES10 0xFFFA101cu #define DBTHRES20 0xFFFA1020u #define DBLGSTS0 0xFFFA1024u #define DBLGQON0 0xFFFA1028u  #define DBLGCNT1 0xFFFA1100u #define DBTMVAL01 0xFFFA1104u #define DBRQCTR1 0xFFFA1114u #define DBTHRES01 0xFFFA1118u #define DBTHRES11 0xFFFA111cu #define DBTHRES21 0xFFFA1120u #define DBLGSTS1 0xFFFA1124u #define DBLGQON1 0xFFFA1128u  #define DBLGCNT2 0xFFFA1200u #define DBTMVAL02 0xFFFA1204u #define DBRQCTR2 0xFFFA1214u #define DBTHRES02 0xFFFA1218u #define DBTHRES12 0xFFFA121cu #define DBTHRES22 0xFFFA1220u #define DBLGSTS2 0xFFFA1224u #define DBLGQON2 0xFFFA1228u  #define DBLGCNT3 0xFFFA1300u #define DBTMVAL03 0xFFFA1304u #define DBRQCTR3 0xFFFA1314u #define DBTHRES03 0xFFFA1318u #define DBTHRES13 0xFFFA131cu #define DBTHRES23 0xFFFA1320u #define DBLGSTS3 0xFFFA1324u #define DBLGQON3 0xFFFA1328u  #define DBLGCNT4 0xFFFA1400u #define DBTMVAL04 0xFFFA1404u #define DBRQCTR4 0xFFFA1414u #define DBTHRES04 0xFFFA1418u #define DBTHRES14 0xFFFA141cu #define DBTHRES24 0xFFFA1420u #define DBLGSTS4 0xFFFA1424u #define DBLGQON4 0xFFFA1428u  #define DBLGCNT5 0xFFFA1500u #define DBTMVAL05 0xFFFA1504u #define DBRQCTR5 0xFFFA1514u #define DBTHRES05 0xFFFA1518u #define DBTHRES15 0xFFFA151cu #define DBTHRES25 0xFFFA1520u #define DBLGSTS5 0xFFFA1524u #define DBLGQON5 0xFFFA1528u  #define DBLGCNT6 0xFFFA1600u #define DBTMVAL06 0xFFFA1604u #define DBRQCTR6 0xFFFA1614u #define DBTHRES06 0xFFFA1618u #define DBTHRES16 0xFFFA161cu #define DBTHRES26 0xFFFA1620u #define DBLGSTS6 0xFFFA1624u #define DBLGQON6 0xFFFA1628u  #define DBLGCNT7 0xFFFA1700u #define DBTMVAL07 0xFFFA1704u #define DBRQCTR7 0xFFFA1714u #define DBTHRES07 0xFFFA1718u #define DBTHRES17 0xFFFA171cu #define DBTHRES27 0xFFFA1720u #define DBLGSTS7 0xFFFA1724u #define DBLGQON7 0xFFFA1728u   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr video config */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr video selection registers */ #define VDCECTL 0xFFC0601Cu  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr video selection registers */ #define TCON_UPDATE (0xF2004000u+0x1980u) #define TCON_TIM (0xF2004000u+0x1984u) #define TCON_TIM_STVA1 (0xF2004000u+0x1988u) #define TCON_TIM_STVA2 (0xF2004000u+0x198cu) #define TCON_TIM_STVB1 (0xF2004000u+0x1990u)  #define TCON_TIM_STVB2 (0xF2004000u+0x1994u) #define TCON_1PIN_VALUE (0X07U)  #define TCON_TIM_STH1 (0xF2004000u+0x1998u) #define TCON_TIM_STH2 (0xF2004000u+0x199cu) #define TCON_TIM_STB1 (0xF2004000u+0x19a0u) #define TCON_TIM_STB2 (0xF2004000u+0x19a4u) #define TCON_2PIN_VALUE (0X07U)  #define TCON_TIM_CPV1 (0xF2004000u+0x19a8u) #define TCON_TIM_CPV2 (0xF2004000u+0x19acu) #define TCON_3PIN_VALUE (0X07U)  #define TCON_TIM_POLA1 (0xF2004000u+0x19b0u) #define TCON_TIM_POLA2 (0xF2004000u+0x19b4u) #define TCON_4PIN_VALUE (0X07U)  #define TCON_TIM_POLB1 (0xF2004000u+0x19b8u) #define TCON_TIM_POLB2 (0xF2004000u+0x19bcu) #define TCON_5PIN_VALUE (0X07U)  #define TCON_TIM_DE (0xF2004000u+0x19c0u) #define TCON_TIM_DE_VALUE (0X01U)   #define VDCECTL_UPDT1 (1ul<<5) #define VDCECTL_UPDT0 (1ul<<4) #define VDCECTL_PXSL (1ul<<3) #define VDCECTL_VOSL (1ul<<2) #define VDCECTL_VISL1 (1ul<<1) #define VDCECTL_VISL0 (1ul<<0)  #define RSDSCFG 0xFFC06020u  #define RSDSCFG_ROEN (1ul<<3) #define RSDSCFG_RPHSL(x) ((x)u<<1) #define RSDSCFG_RBSW (1ul<<0)   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VRAM Aribter Settings */  #define VRAM1CONTROL 0xfffd1000u #define VRAM2CONTROL 0xfffd2000u /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IdlTime, NoOfBursts */ #define VRMTRCTL 0x40u /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Window Size for the restricted master */ #define VRMTRINTVL 0x44u   #ifdef BSP_INIT_SFMA /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA setup for Macronics MX25L51245G device only  D1L1 (144 pin) (40MHZ SDR) 1 x MX25L51245G 512Mb: 536,870,912 x 1 bit (64MByte)  D1L2 (80MHZ DDR) 1 x MX25L51245G 512Mb: 536,870,912 x 1 bit (64MByte)  D1L2H and above(120MHZ DDR) 2 x MX25L51245G 512Mb: 536,870,912 x 1 bit (128MByte) */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA macro */ #define SFMA_CH0 0  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Clock regs */ #define CKSC_ISFMAD_CTL (0xFFF85380u) #define CKSC_ISFMAS_CTL (0xFFF85340u)   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Default calibration for Serial flash memory (Macronix device only).  SPBCLK clock phase shift 3 (range 0 - 7, written to the upper 16bits) Sampling point phase shift 1 (range 0 - 7, written to the Lower 16 bits) */ #define SFMA_SPBCLK_CLOCK_PHASE_SHIFT (3u) /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr general setting for most devices */ #define SFMA_SAMPLING_POINT_PHASE_SHIFT (1u) #define SFMA_DEFAULT_CAL ((SFMA_SPBCLK_CLOCK_PHASE_SHIFT << 16) | SFMA_SAMPLING_POINT_PHASE_SHIFT)  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1M1 requires a different default cal */ #define SFMA_D1M1_SAMPLING_POINT_PHASE_SHIFT (2u) #define SFMA_D1M1_DEFAULT_CAL ((SFMA_SPBCLK_CLOCK_PHASE_SHIFT << 16) | SFMA_D1M1_SAMPLING_POINT_PHASE_SHIFT)  #endif   /******************************************************************************* Section: Local Constants */  static const r_dev_PinConfig_t loc_D1L2_VoDefaultPinConfig[] = /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Port Pin Func Dir Feedback Pull OpenDrain HiCurr HiSpeed InputType */ { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Output 24bit parallel, HSync+VSync */ //{44, 0, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Out Data 23 */ //{44, 1, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, //{44, 2, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, //{44, 3, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, //{44, 4, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, //{44, 5, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 6, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 7, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 8, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 9, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 10, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {44, 11, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1},  {45, 0, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Out CLK */ {45, 1, 4u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Out DEO */  {45, 2, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 3, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 4, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 5, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 6, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 7, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1},  {45, 8, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 9, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 10, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 11, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 12, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {45, 13, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1},  {43, 0, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Out TCON2 HS */ {43, 1, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 Out TCON0 VS */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr delimiter - do not remove */ {0u, R_DEV_PIN_LAST,0u,R_DEV_PIN_OUT,0u,R_DEV_PIN_PULLNO, 0u, 0u, 0u, R_DEV_PIN_CMOS1} };  static const r_dev_PinConfig_t loc_D1M2H_SfmaDefaultPinConfig[] = /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Port Pin Func Dir Feedback Pull OpenDrain HiCurr HiSpeed InputType */ { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA - serial Flash memory pins */ {21, 0, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr O: SFMA0CLK */ {21, 1, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr O: SFMA0SSL */ {21, 2, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[0..]0 */ {21, 3, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 4, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 5, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[..3]0 */ {21, 6, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[0..]1 */ {21, 7, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 8, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 9, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[..3]1 */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr delimiter - do not remove */ {0u, R_DEV_PIN_LAST,0u,R_DEV_PIN_OUT,0u,R_DEV_PIN_PULLNO, 0u, 0u, 0u, R_DEV_PIN_CMOS1} };  static const r_dev_PinConfig_t loc_D1L2_SfmaDefaultPinConfig[] = //@KS add /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Port Pin Func Dir Feedback Pull OpenDrain HiCurr HiSpeed InputType */ { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA - serial Flash memory pins */ {21, 0, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr O: SFMA0CLK */ {21, 1, 1u, R_DEV_PIN_OUT, 0u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr O: SFMA0SSL */ {21, 2, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[0..]0 */ {21, 3, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 4, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, {21, 5, 1u, R_DEV_PIN_DIRECT, 1u, R_DEV_PIN_PULLNO, 0u, 0u, 1u, R_DEV_PIN_CMOS1}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IO: SFMA0IO[..3]0 */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr delimiter - do not remove */ {0u, R_DEV_PIN_LAST,0u,R_DEV_PIN_OUT,0u,R_DEV_PIN_PULLNO, 0u, 0u, 0u, R_DEV_PIN_CMOS1} };  static const r_xbus_Cfg_t xbus_cfg = { 0, 0, {{R_XBUS_AM_CACHE,0x1u,0x98000000u, 0x07F00000u}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Cached SDRAM (0x9800_0000 - 0x9fff_ffff) */ {R_XBUS_AM_CACHE, 0x1u,0xa0000000u, 0x1FF00000u}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Cached SFMA mirror (0xa000_0000 - 0xBFff_ffff)*/ {R_XBUS_AM_DIRECT,0x1u,0x40000000u, 0x1FF00000u}, /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr (disabled) buffered SDRAM */ {R_XBUS_AM_DIRECT,0x1u,0x3FCE8000u, 0x00100000u}} /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr (disabled) buffered VRAM */ };  /******************************************************************************* Section: Local Types */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr --------------------------- */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SDRB ARBITER INITIALISATION */  typedef struct { uint32_t enable; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Arbiter -> 0: Disabled; 1: Enabled */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Signed values from [-8192..+8191] */ int32_t initial_value; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Initial value, must be bigger or equal to 1 */ int32_t threshold0; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 1st threshold, must be smaller than initial_value */ int32_t threshold1; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 2nd threshold, must be smaller than 1st threshold */ int32_t threshold2; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 3rd threshold, must be smaller than 2nd threshold */ uint32_t act_to_idle_type; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Count the -> 0: Requests; 1: Bytes */ uint32_t act_to_idle_threshold; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Max number of granted bytes/requests before returning to arbitration mode */ uint32_t reload_type; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Reload counter value -> 0: Without carry-over; 1: With carry over */ uint32_t counter_values_are_signed; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Interprets initial_value and threshold<n> as -> 0: unsigned; 1: signed values. Signed values will be converted. */ } r_sdrb_arbiter_config_t;   /******************************************************************************* Section: Local Functions */ static void loc_DisableVOPixelClocks(void); static void loc_InitVideoIOPort(void); static void loc_InitSfmaIOPort(void);  static void loc_InitGfxBus(void);  #ifdef BSP_INIT_SFMA void loc_SetupSFMA(void); #endif  /******************************************************************************* Function: loc_DisableVOPixelClocks  Disable the video output pixel clock as default. */  static void loc_DisableVOPixelClocks(void) { r_dev_ClkSelConfig_t ClkSelCfg;  ClkSelCfg.Cks = R_DEV_CKS_DOTCK0; ClkSelCfg.SrcId = R_DEV_CKS_SRC_DISABLED; ClkSelCfg.Div = 0; ClkSelCfg.StpReqMsk = 0; R_DEV_ClkIdSet(&ClkSelCfg); }   /******************************************************************************* Function: loc_InitVideoIOPort  Init port pins of Video I/O and select a video configuration. */  static void loc_InitVideoIOPort(void) { uint32_t val;  R_DEV_PinInit(loc_D1L2_VoDefaultPinConfig); //R_GPIO_WritePin(45, 1, 1);  val = 0; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr video output assignment */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr staight assignment */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE0 video channel 0 to VDCE0_VO port pins */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr VDCE1 video channel 1 not present */ val &= ~VDCECTL_VOSL; R_DEV_WRITE_REG(32, VDCECTL, ((val & 0x3Fu) | 0x10000u));  val =R_DEV_READ_REG(32, TCON_TIM_CPV2); R_DEV_WRITE_REG(32, TCON_TIM_CPV2, (val | TCON_3PIN_VALUE)); }  void loc_InitSfmaIOPort(void) { R_DEV_PinInit(loc_D1L2_SfmaDefaultPinConfig);//@KS }   /******************************************************************************* Function: loc_InitGfxBus  Configure the Gfx bus (cache) */ static void loc_InitGfxBus(void) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Init XBus Bridge */ if (R_XBUS_ERR_OK == R_XBUS_Init(0)) { R_XBUS_Config(0u, (r_xbus_Cfg_t *)&xbus_cfg); } }  #ifdef BSP_INIT_SFMA  /*********************************************************** Function: loc_SetupSFMA  SFMA calibration procedure */  void loc_SetupSFMA(void) { r_sfma_Config_t Config; r_sfma_Error_t sfma_error; r_dev_Device_t device;  #ifdef SFMA_USE_BSP_CALIB sf_CalConfig_t CalConfig; uint32_t f_phclk; uint32_t f_b; uint32_t u32_temp; sf_Error_t sf_error; #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA_USE_BSP_CALIB */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr common SFMA config */ Config.AddressMode = R_SFMA_ADDRESS_32BIT; Config.SerialFlashMemoryPageSize = 256; Config.SerialFlashMemoryMaxClock = 80000000; Config.SerialFlashMemorySectorSize = 4096; Config.CacheMode = R_SFMA_CACHE_OFF;  device = R_DEV_GetDev();  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1M1 requires a different cal */ if(device == R_DEV_R7F701405) /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1M1 */ { Config.Calibration = SFMA_D1M1_DEFAULT_CAL; } else { Config.Calibration = SFMA_DEFAULT_CAL; } Config.PerformanceEnMode = R_SFMA_PER_EN_MODE_ENABLE;  device = R_DEV_GetDev(); if(device >= R_DEV_R7F701403) /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1L2H and above */ { Config.SerialFlashMemorySize = ((64 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024) r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 2); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 128 MByte */ Config.MemoryNum = R_SFMA_MEMORY_DUAL; Config.Command = &r_sfc_Macronix_32bitAddrCmdPerformanceEnhance_80MHz; } else if(device >= R_DEV_R7F701402) /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1L2 and above */ { Config.SerialFlashMemorySize = ((64 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024) r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 64 MByte */ Config.MemoryNum = R_SFMA_MEMORY_SINGLE; Config.Command = &r_sfc_Macronix_32bitAddrCmdPerformanceEnhance_80MHz; } else /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr D1L1 */ { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Calibration procedure not supported for D1L1 */ Config.AddressMode = R_SFMA_ADDRESS_32BIT; Config.SerialFlashMemoryPageSize = 256; Config.SerialFlashMemoryMaxClock = 40000000; Config.SerialFlashMemorySectorSize = 4096; Config.SerialFlashMemorySize = ((64 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024 r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1024) r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 1); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 64 MByte */ Config.MemoryNum = R_SFMA_MEMORY_SINGLE; Config.Command = &r_sfc_Macronix_32bitAddrCmdPerformanceEnhance_40MHz; Config.CacheMode = R_SFMA_CACHE_OFF;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr config to external address space quad IO */ Config.Mode = R_SFMA_MODE_EX_SPACE; Config.DataTransferMode = R_SFMA_SDR_QUAD_IO;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Init the SFMA */ sfma_error = R_SFMA_Init(SFMA_CH0); if(R_SFMA_ERR_OK == sfma_error) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr open */ sfma_error = R_SFMA_Open(SFMA_CH0, &Config); if(R_SFMA_ERR_OK == sfma_error) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set address range */ sfma_error = R_SFMA_AccessAddressSet(SFMA_CH0, 0x00000000UL, R_SFMA_ACCESS_RANGE_64MB); if(R_SFMA_ERR_OK == sfma_error) { R_BSP_STDIO_Printf("SFMA configured for D1L1\n"); } } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr error */ R_BSP_STDIO_Printf("SFMA configuration error\n"); } } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr error */ R_BSP_STDIO_Printf("SFMA configuration error\n"); }  return; }  #ifdef SFMA_USE_BSP_CALIB  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Data write & erase is done in SPI single IO mode only */ Config.Mode = R_SFMA_MODE_SPI_OPERATING; Config.DataTransferMode = R_SFMA_SDR_SINGLE_IO;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr configure the calibration data */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr we will write the minimum data we can but this is dependent of the sector erase size */ if(Config.MemoryNum == R_SFMA_MEMORY_DUAL) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 2 devices */ CalConfig.TestSize = Config.SerialFlashMemorySectorSize r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h 2; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 1 device */ CalConfig.TestSize = Config.SerialFlashMemorySectorSize; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr base memory of the Serial flash data */ CalConfig.BaseMemoryAddr = 0x10000000uL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr test area right at the top */ CalConfig.TestStartAddressOs = Config.SerialFlashMemorySize - CalConfig.TestSize;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Write data to flash for preparation*/ R_BSP_STDIO_Printf("SFMA Calibration:\n");  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr init the calibration variables */ SF_CalibrationInit(SFMA_CH0, &CalConfig);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr perform a data write to the SFMA */ sf_error = SF_CalibrationWriteData(SFMA_CH0, &Config);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr write ok, so run the calibration routine */ if(sf_error == SF_ERR_OK) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Base clock Freq */ f_phclk = R_DEV_ClkFrequencyHz(R_DEV_CKS_SFMA) r_bsp_gfx_disp_init.c r_bsp_gfx_disp_init.h r_bsp_gfx_hdmi_out.c r_bsp_gfx_hdmi_out.h r_bsp_gfx_iis_audio_dac.c r_bsp_gfx_iis_audio_dac.h r_bsp_sys_gfx.c r_sfma_calib.c r_sfma_calib.h (R_DEV_READ_REG(32, CKSC_ISFMAD_CTL) + 1); f_b = R_DEV_ClkFrequencyHz(R_DEV_CKS_SFMA);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr PLL0 or 1 */ u32_temp = R_DEV_READ_REG(32, CKSC_ISFMAS_CTL); if(u32_temp == 0x01) { R_BSP_STDIO_Printf(" - f_phclk (PLL0) '%dHz' \n", f_phclk); } else { R_BSP_STDIO_Printf(" - f_phclk (PLL1) '%dHz'\n", f_phclk); }  R_BSP_STDIO_Printf(" - f_b '%dHz'\n", f_b);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr config to external address space quad IO */ Config.Mode = R_SFMA_MODE_EX_SPACE; Config.DataTransferMode = R_SFMA_DDR_QUAD_IO;  sf_error = SF_CalibrationRun(SFMA_CH0, &Config, f_phclk, f_b); } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr nothing, catch below */ }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr pass or fail */ if(sf_error == SF_ERR_OK) { R_BSP_STDIO_Printf(" - Passed\n\n"); } else { R_BSP_STDIO_Printf(" - failed\n\n"); }  #else /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA_USE_BSP_CALIB */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr config to external address space quad IO */ Config.Mode = R_SFMA_MODE_EX_SPACE; Config.DataTransferMode = R_SFMA_DDR_QUAD_IO;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Init the SFMA */ sfma_error = R_SFMA_Init(SFMA_CH0); if(R_SFMA_ERR_OK == sfma_error) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr open */ sfma_error = R_SFMA_Open(SFMA_CH0, &Config); if(R_SFMA_ERR_OK == sfma_error) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set address range 128MByte */ if(Config.SerialFlashMemorySize == (128 *1024 *1024)) { sfma_error = R_SFMA_AccessAddressSet(SFMA_CH0, 0x00000000UL, R_SFMA_ACCESS_RANGE_128MB); } else /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 64MByte */ { sfma_error = R_SFMA_AccessAddressSet(SFMA_CH0, 0x00000000UL, R_SFMA_ACCESS_RANGE_64MB); }  if(R_SFMA_ERR_OK == sfma_error) { R_BSP_STDIO_Printf("SFMA configured using default calibration\n"); } } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr error */ R_BSP_STDIO_Printf("SFMA configuration error\n"); } } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr error */ R_BSP_STDIO_Printf("SFMA configuration error\n"); }  #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SFMA_USE_BSP_CALIB */  } #endif   /******************************************************************************* Function: R_BSP_SYS_GFX_LowInit  See: r_bsp_gfx_sys.h for details */ void R_BSP_SYS_GFX_LowInit(void) { }  /******************************************************************************* Function: R_BSP_GFX_Init  See: r_bsp_gfx_sys.h for details */ void R_BSP_SYS_GFX_Init(void) { loc_DisableVOPixelClocks();  loc_InitVideoIOPort(); loc_InitSfmaIOPort();  loc_InitGfxBus();  #ifdef BSP_INIT_SFMA loc_SetupSFMA(); #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr BSP_INIT_SFMA */    /*MNI*/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Setup of the VRAM arbiter */  #if 0 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Values for 0% and 30% load */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Restrict write transactions, allow 3 x 16-beat read bursts before going back to arbitration */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 0x10010030u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 3 x 16-beat = 48 = 0x30 */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRINTVL, 0x00000001u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the time window for write transactions */ R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 0x10010030u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr */ R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRINTVL, 0x00000001u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr */ #endif #if 0 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Values for 60% load */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Restrict write transactions, allow 3 x 16-beat read bursts before going back to arbitration */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 0x20010060u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 3 x 16-beat = 48 = 0x30 */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRINTVL, 0x00000001u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the time window for write transactions */ R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 0x20010060u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr */ R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRINTVL, 0x00000001u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr */ #endif #if 0 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Values from Kawahito-san IDLTIM 128 RCTL 0b01 RTOVFL 0 WTOVFL 32, 49, 66 */   #if 0 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Single layer 48 MHz best case */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 32<<24 | 1<<16 | 16); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 32<<24 | 1<<16 | 16); #endif #if 1 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Lowest possible settings that have any effect are IDLTIM 29 and WTOVFL 16 Good for up to 40 MHz singl layer. To reach higher frquency the IDLTIM has to be increased. WTOVFL lower than 16 has no effect. IDLTIM lower than 29 has no effect. */ R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 32<<24 | 1<<16 | 16); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 32<<24 | 1<<16 | 16); #endif #if 0 R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 32); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 32); #endif #if 0 R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 49); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 49); #endif #if 0 R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 66); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRCTL, 128<<24 | 1<<16 | 66); #endif  R_DEV_WRITE_REG(32, VRAM1CONTROL+VRMTRINTVL, 0x00000000u); R_DEV_WRITE_REG(32, VRAM2CONTROL+VRMTRINTVL, 0x00000000u); #endif /*END MNI*/   }
