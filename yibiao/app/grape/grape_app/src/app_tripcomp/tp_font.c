/bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr app_tripcomp.c app_tripcomp.h app_tripcomp_image.h app_tripcomp_menu.c app_tripcomp_menu.h image tp_font.c tp_font.h PROJECT : GRAPE_APP FILE : $Id: write.c 25427 2013-06-14 07:55:45Z nan.wang $ ============================================================================ DESCRIPTION Sample program for demonstration of the D1MX GFX features ============================================================================ C O P Y R I G H T ============================================================================ Copyright (c) 2014 by Renesas Electronics (Europe) GmbH. Arcadiastrasse 10 D-40472 Duesseldorf Germany All rights reserved. ============================================================================ Purpose: only for testing, not for mass production DISCLAIMER LICENSEE has read, understood and accepted the terms and conditions defined in the license agreement, especially the usage rights. In any case, it is LICENSEE's responsibility to make sure that any user of the software complies with the terms and conditions of the signed license agreement. SAMPLE CODE is not part of the licensed software, as such it must not be used in mass-production applications. It can only be used for evaluation and demonstration purposes at customer’s premises listed in the signed license agreement. app_tripcomp.c app_tripcomp.h app_tripcomp_image.h app_tripcomp_menu.c app_tripcomp_menu.h image tp_font.c tp_font.h image/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Title: Write Module This module contains the write functions for bitmap fonts. image/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Section: Includes image/ #include "r_typedefs.h" /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Renesas basic types, e.g. uint32_t image/ #include "r_drw2d_os.h" #include "r_drw2d_api.h" #include "img_format.h" #include "font.h" #include "font_data.h" //#include "main.h" #include "tp_font.h" /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Variable: locCurrentFont Font to be used by text operations. image/ static const Font_t *locCurrentFont; static int32_t locFontHeight; static r_drw2d_Rect_t rect; static r_drw2d_Rect_t src_rect; static r_drw2d_Texture_t tex; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: locGetCharRemapping image/ static int locGetCharRemapping(unsigned char Character) { int c; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Character remapping image/ if ((Character >= 32) && (Character < 128)) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr visible ASCII characters start with 32 (blank) not visible chars 0-31 and will be omitted image/ c = (Character - 32); } else { switch (Character) { case 0xB0: /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr special remapping for non ASCII character 'degree' (Â° or 0xB0) non visible char DEL (127) will be used for 'degree' image/ c = (127 - 32); break; default: /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr use blank as default image/ c = 0; break; } } return c; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: locWriteChar Write a single character. Use the currently selected buffer, font and color to draw a character at the given position. Parameters: Dev - R_DRW2D device structure PosX - Display X position (not turned) PosY - Display Y position (not turned) Character - ASCII value of the character Returns: void image/ static void locWriteChar(r_drw2d_Device_t Dev, int PosX, int PosY, unsigned char Character) { int xsrc; int wsrc; char c; c = locGetCharRemapping(Character); xsrc = locCurrentFont->Pos[c].Offset; wsrc = locCurrentFont->Pos[c].Width; rect.Pos.X = R_DRW2D_2X(PosX); rect.Pos.Y = R_DRW2D_2X(PosY); rect.Size.Height = R_DRW2D_2X(locFontHeight); rect.Size.Width = R_DRW2D_2X(wsrc); src_rect.Pos.X = R_DRW2D_2X(xsrc); src_rect.Pos.Y = R_DRW2D_2X(0); src_rect.Size.Height = R_DRW2D_2X(locCurrentFont->Height); src_rect.Size.Width = R_DRW2D_2X(wsrc); R_DRW2D_TextureBlit(Dev, &src_rect, &rect); } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Section: Global Functions Description see: <write.h> image/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: SelectFont image/ void TP_FONT_SelectFont(const Font_t *Font) { locCurrentFont = Font; locFontHeight = locCurrentFont->Height; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetFontHeight image/ int TP_FONT_GetFontHeight(void) { return locCurrentFont->Height; } void TP_FONT_SetFontHeight(int32_t Height) { locFontHeight = Height; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetCharWidth image/ int TP_FONT_GetCharWidth(char Character) { int c; c = locGetCharRemapping(Character); if ((c < 0) || (c > 95)) { return 0; } return locCurrentFont->Pos[c].Width; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetTextWidth image/ int TP_FONT_GetTextWidth(char *Text) { int w; w = 0; while (*Text != 0) { w += TP_FONT_GetCharWidth(*Text); Text++; } return w; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetTextHeight image/ int TP_FONT_GetTextHeight(char *Text) { int h; h = 1; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr To include the last line image/ while (*Text != 0) { if (*Text == '\n') { h += TP_FONT_GetFontHeight(); } Text++; } return h; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: Write The color of the rendered text is given by the the current foreground color. image/ void TP_FONT_Print(r_drw2d_Device_t Dev, int PosX, int PosY, r_drw2d_Color_t Color, char *Text) { int startx; r_drw2d_EffectStage_t effect[2]; tex.Buffer.Data = *locCurrentFont->Texture->Data; tex.Buffer.Pitch = locCurrentFont->Texture->Width; tex.Buffer.PixelFormat = R_DRW2D_PIXELFORMAT_AL8; tex.Buffer.Size.Height = locCurrentFont->Texture->Height; tex.Buffer.Size.Width = locCurrentFont->Texture->Width; tex.Flags = R_DRW2D_TEX_BILINEAR; tex.Handle = 0; R_DRW2D_CtxIdentity(Dev); R_DRW2D_CtxTextureIdentity(Dev); R_DRW2D_CtxBlendMode(Dev, R_DRW2D_BLENDMODE_SRC_OVER); R_DRW2D_CtxFillMode(Dev, R_DRW2D_FILLMODE_TEXTURE); effect[0].Name = R_DRW2D_EFFECT_MODULATE; effect[0].Args[0].Source = R_DRW2D_EFFECT_SOURCE_TEXTURE_UNIT; effect[0].Args[0].Param.Color.Source.TextureUnit = 0; effect[0].Args[0].Param.Color.Operand = R_DRW2D_EFFECT_COLOR_OPERAND_RGBA; effect[0].Args[1].Source = R_DRW2D_EFFECT_SOURCE_CONSTANT_COLOR; effect[0].Args[1].Param.Color.Source.ConstantColor = Color; effect[0].Args[1].Param.Color.Operand = R_DRW2D_EFFECT_COLOR_OPERAND_RGBA; R_DRW2D_CtxEffectsSet(Dev, effect, 1); R_DRW2D_CtxTextureSet(Dev, 0, &tex); startx = PosX; while (*Text != 0) { if (*Text == '\n') { PosX = startx; PosY += locCurrentFont->Height; } else { locWriteChar(Dev, PosX, PosY, *Text); PosX += TP_FONT_GetCharWidth(*Text); } Text++; } R_DRW2D_CtxEffectsDelete(Dev); }
