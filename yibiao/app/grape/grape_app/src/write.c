/bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr app_drw2dcpu app_menu app_tripcomp app_tutorial application.c application.h error.c error.h font.h font_data.h fonts fs_data.h hmi_manager.c hmi_manager.h img.c img.h img_data.h img_drw2d.c img_drw2d.h img_format.h main.c main.h mem_init.c mem_init.h sfma.c wm.c wm.h write.c write.h PROJECT : GRAPE_APP FILE : $Id: write.c 25427 2013-06-14 07:55:45Z nan.wang $ ============================================================================ DESCRIPTION Sample program for demonstration of the D1MX GFX features ============================================================================ C O P Y R I G H T ============================================================================ Copyright (c) 2014 by Renesas Electronics (Europe) GmbH. Arcadiastrasse 10 D-40472 Duesseldorf Germany All rights reserved. ============================================================================ Purpose: only for testing, not for mass production DISCLAIMER LICENSEE has read, understood and accepted the terms and conditions defined in the license agreement, especially the usage rights. In any case, it is LICENSEE's responsibility to make sure that any user of the software complies with the terms and conditions of the signed license agreement. SAMPLE CODE is not part of the licensed software, as such it must not be used in mass-production applications. It can only be used for evaluation and demonstration purposes at customer’s premises listed in the signed license agreement. app_drw2dcpu app_menu app_tripcomp app_tutorial application.c application.h error.c error.h font.h font_data.h fonts fs_data.h hmi_manager.c hmi_manager.h img.c img.h img_data.h img_drw2d.c img_drw2d.h img_format.h main.c main.h mem_init.c mem_init.h sfma.c wm.c wm.h write.c write.h app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Title: Write Module This module contains the write functions for bitmap fonts. app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Section: Includes app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ #include "r_typedefs.h" /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Renesas basic types, e.g. uint32_t app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ #include "r_drw2d_os.h" #include "r_drw2d_api.h" #include "img_format.h" #include "font.h" #include "write.h" #include "r_config_d1x.h" #include "main.h" /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Variable: locCurrentFont Font to be used by text operations. app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ static const Font_t *locCurrentFont; static r_drw2d_Rect_t rect; static r_drw2d_Rect_t src_rect; static r_drw2d_Texture_t tex; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: locGetCharRemapping app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ static int locGetCharRemapping(unsigned char Character) { int c; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Character remapping app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ if ((Character >= 32) && (Character < 128)) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr visible ASCII characters start with 32 (blank) not visible chars 0-31 and will be omitted app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ c = (Character - 32); } else { switch (Character) { case 0xB0: /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr special remapping for non ASCII character 'degree' (Â° or 0xB0) non visible char DEL (127) will be used for 'degree' app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ c = (127 - 32); break; default: /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr use blank as default app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ c = 0; break; } } return c; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: locWriteChar Write a single character. Use the currently selected buffer, font and color to draw a character at the given position. Parameters: Dev - R_DRW2D device structure PosX - Display X position (not turned) PosY - Display Y position (not turned) Character - ASCII value of the character Returns: void app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ static void locWriteChar(r_drw2d_Device_t Dev, int PosX, int PosY, unsigned char Character) { int xsrc; int wsrc; char c; c = locGetCharRemapping(Character); xsrc = locCurrentFont->Pos[c].Offset; wsrc = locCurrentFont->Pos[c].Width; rect.Pos.X = R_DRW2D_2X(PosX); rect.Pos.Y = R_DRW2D_2X(PosY); rect.Size.Height = R_DRW2D_2X(locCurrentFont->Height); rect.Size.Width = R_DRW2D_2X(wsrc); src_rect.Pos.X = R_DRW2D_2X(xsrc); src_rect.Pos.Y = R_DRW2D_2X(0); src_rect.Size.Height = R_DRW2D_2X(locCurrentFont->Height); src_rect.Size.Width = R_DRW2D_2X(wsrc); R_DRW2D_TextureBlit(Dev, &src_rect, &rect); } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Section: Global Functions Description see: <write.h> app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: SelectFont app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ void SelectFont(const Font_t *Font) { locCurrentFont = Font; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetFontHeight app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ int GetFontHeight(void) { return locCurrentFont->Height; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetCharWidth app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ int GetCharWidth(char Character) { int c; c = locGetCharRemapping(Character); if ((c < 0) || (c > 95)) { return 0; } return locCurrentFont->Pos[c].Width; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetTextWidth app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ int GetTextWidth(char *Text) { int w; w = 0; while (*Text != 0) { w += GetCharWidth(*Text); Text++; } return w; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: GetTextHeight app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ int GetTextHeight(char *Text) { int h; h = 1; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr To include the last line app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ while (*Text != 0) { if (*Text == '\n') { h += GetFontHeight(); } Text++; } return h; } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Function: Write The color of the rendered text is given by the the current foreground color. app_drw2dcpu/ app_menu/ app_tripcomp/ app_tutorial/ fonts/ void Write(r_drw2d_Device_t Dev, int PosX, int PosY, r_drw2d_Color_t Color, char *Text) { int startx; r_drw2d_EffectStage_t effect[2]; tex.Buffer.Data = *locCurrentFont->Texture->Data; tex.Buffer.Pitch = locCurrentFont->Texture->Width; tex.Buffer.PixelFormat = R_DRW2D_PIXELFORMAT_AL8; tex.Buffer.Size.Height = locCurrentFont->Texture->Height; tex.Buffer.Size.Width = locCurrentFont->Texture->Width; tex.Flags = R_DRW2D_TEX_BILINEAR; tex.Handle = 0; R_DRW2D_CtxIdentity(Dev); R_DRW2D_CtxTextureIdentity(Dev); R_DRW2D_CtxBlendMode(Dev, R_DRW2D_BLENDMODE_SRC_OVER); R_DRW2D_CtxFillMode(Dev, R_DRW2D_FILLMODE_TEXTURE); effect[0].Name = R_DRW2D_EFFECT_MODULATE; effect[0].Args[0].Source = R_DRW2D_EFFECT_SOURCE_TEXTURE_UNIT; effect[0].Args[0].Param.Color.Source.TextureUnit = 0; effect[0].Args[0].Param.Color.Operand = R_DRW2D_EFFECT_COLOR_OPERAND_RGBA; effect[0].Args[1].Source = R_DRW2D_EFFECT_SOURCE_CONSTANT_COLOR; effect[0].Args[1].Param.Color.Source.ConstantColor = Color; effect[0].Args[1].Param.Color.Operand = R_DRW2D_EFFECT_COLOR_OPERAND_RGBA; R_DRW2D_CtxEffectsSet(Dev, effect, 1); R_DRW2D_CtxTextureSet(Dev, 0, &tex); startx = PosX; while (*Text != 0) { if (*Text == '\n') { PosX = startx; PosY += locCurrentFont->Height; } else { locWriteChar(Dev, PosX, PosY, *Text); PosX += GetCharWidth(*Text); } Text++; } R_DRW2D_CtxEffectsDelete(Dev); }
