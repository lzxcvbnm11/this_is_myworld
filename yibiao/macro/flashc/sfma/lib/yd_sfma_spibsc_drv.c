/* **************************************************************************** PROJECT : SFMA driver FILE : $Id: yd_sfma_spibsc_drv.c 7505 2016-02-03 12:29:27Z michael.golczewski $ ============================================================================ DESCRIPTION Driver for the SFMA(Serial Flash Memory Interface) macro ============================================================================ C O P Y R I G H T ============================================================================ Copyright (c) 2013 - 2014 by Renesas Electronics (Europe) GmbH. Arcadiastrasse 10 D-40472 Duesseldorf Germany All rights reserved. ============================================================================  DISCLAIMER  LICENSEE has read, understood and accepted the terms and conditions defined in the license agreement, especially the usage rights. In any case, it is LICENSEE's responsibility to make sure that any user of the software complies with the terms and conditions of the signed license agreement.  **************************************************************************** */  /*************************************************************************** Title: SFMA Spibsc Driver controlling registers  SFMA Internal Interface  */  /*************************************************************************** Section: Includes */ #include "r_typedefs.h" #include "yd_sfma_api.h" #include "r_sfma_api.h" #include "yd_sfma_spibsc.h" #include "yd_sfma_sys.h" #include "yd_config_sfma.h"  /*************************************************************************** Section: Local Defines */  /*************************************************************************** Constants: LOC_YD_SFMA_SPIBSC_CMNCR  The setting value of CMNCR register.  LOC_YD_SFMA_SPIBSC_CMNCR_MD_EXTRD - The setting value of EX operation mode. LOC_YD_SFMA_SPIBSC_CMNCR_MD_SPI - The setting value of SPI operating mode. LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ - The setting value of output idle value is Hi-z. LOC_YD_SFMA_SPIBSC_CMNCR_CPHAT_EVEN - The setting value of even edge of output data. LOC_YD_SFMA_SPIBSC_CMNCR_SFDE - The setting value of data swap setting. LOC_YD_SFMA_SPIBSC_CMNCR_CPHAR_EVEN - The setting value of even edge of reception data. LOC_YD_SFMA_SPIBSC_CMNCR_SSLP_LOW - The setting value of active low SPBSSL signal. LOC_YD_SFMA_SPIBSC_CMNCR_CPOL_LOW - The setting value of SPBCLK output is 0. during SPBSSL negation period. */ #define LOC_YD_SFMA_SPIBSC_CMNCR_MD_EXTRD (0uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_MD_SPI (1uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIGH (1uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ (3uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_CPHAT_EVEN (0uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_SFDE (1uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_CPHAR_EVEN (1uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_SSLP_LOW (0uL) #define LOC_YD_SFMA_SPIBSC_CMNCR_CPOL_LOW (0uL)  /*************************************************************************** Constants: LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK  The setting value of SSLDR register.  LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK - The setting value of next address delay is 1SPBCLK cycles. */ #define LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK (0uL)  /*************************************************************************** Constants: LOC_YD_SFMA_SPIBSC_DRCR  The setting value of DRCR register.  LOC_YD_SFMA_SPIBSC_DRCR_BURST_ENABLE - The setting value of read burst enable. LOC_YD_SFMA_SPIBSC_DRCR_RCF_EXE - The setting value of read cache flash. LOC_YD_SFMA_SPIBSC_DRCR_SSL_NEGATE - The setting value of SPBSSL negate enable. LOC_YD_SFMA_SPIBSC_DRCR_BFM_BURST - The setting value of Enable SFMA cache. */ #define LOC_YD_SFMA_SPIBSC_DRCR_BURST_ENABLE (1uL) #define LOC_YD_SFMA_SPIBSC_DRCR_RCF_EXE (1uL) #define LOC_YD_SFMA_SPIBSC_DRCR_SSL_NEGATE (1uL) #define LOC_YD_SFMA_SPIBSC_DRCR_BFM_BURST (7uL)  /*************************************************************************** Constants: LOC_YD_SFMA_SPIBSC_CMNSR  The setting value of CMNSR register.  LOC_YD_SFMA_SPIBSC_CMNSR_SSL_NEGATE - The setting value of SPBSSL pin negate. LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END - The setting value of transfer end flag. */ #define LOC_YD_SFMA_SPIBSC_CMNSR_SSL_NEGATE (0uL) #define LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END (1uL)  /*************************************************************************** Constants: LOC_YD_SFMA_SPIBSC_SPI_ENABLE  The setting value of SPI enable of SMCR register.  LOC_YD_SFMA_SPIBSC_SPI_ENABLE - The setting value of SPI enable. */ #define LOC_YD_SFMA_SPIBSC_SPI_ENABLE (1uL)  /*************************************************************************** Constant: LOC_YD_SFMA_CMNCR  The offset value of the CMNCR register from the base address. */ #define LOC_YD_SFMA_CMNCR (0x00)  /*************************************************************************** Constant: LOC_YD_SFMA_SSLDR  The offset value of the SSLDR register from the base address. */ #define LOC_YD_SFMA_SSLDR (0x04)  /*************************************************************************** Constant: LOC_YD_SFMA_SPBCR  The offset value of the SPBCR register from the base address. */ #define LOC_YD_SFMA_SPBCR (0x08)  /*************************************************************************** Constant: LOC_YD_SFMA_DRCR  The offset value of the DRCR register from the base address. */ #define LOC_YD_SFMA_DRCR (0x0c)  /*************************************************************************** Constant: LOC_YD_SFMA_DRCMR  The offset value of the DRCMR register from the base address. */ #define LOC_YD_SFMA_DRCMR (0x10)  /*************************************************************************** Constant: LOC_YD_SFMA_DREAR  The offset value of the DREAR register from the base address. */ #define LOC_YD_SFMA_DREAR (0x14)  /*************************************************************************** Constant: LOC_YD_SFMA_DROPR  The offset value of the DROPR register from the base address. */ #define LOC_YD_SFMA_DROPR (0x18)  /*************************************************************************** Constant: LOC_YD_SFMA_DRENR  The offset value of the DRENR register from the base address. */ #define LOC_YD_SFMA_DRENR (0x1c)  /*************************************************************************** Constant: LOC_YD_SFMA_SMCR  The offset value of the SMCR register from the base address. */ #define LOC_YD_SFMA_SMCR (0x20)  /*************************************************************************** Constant: LOC_YD_SFMA_SMCMR  The offset value of the SMCMR register from the base address. */ #define LOC_YD_SFMA_SMCMR (0x24)  /*************************************************************************** Constant: LOC_YD_SFMA_SMADR  The offset value of the SMADR register from the base address. */ #define LOC_YD_SFMA_SMADR (0x28)  /*************************************************************************** Constant: LOC_YD_SFMA_SMOPR  The offset value of the SMOPR register from the base address. */ #define LOC_YD_SFMA_SMOPR (0x2c)  /*************************************************************************** Constant: LOC_YD_SFMA_SMENR  The offset value of the SMENR register from the base address. */ #define LOC_YD_SFMA_SMENR (0x30)  /*************************************************************************** Constant: LOC_YD_SFMA_SMRDR0  The offset value of the SMRDR0 register from the base address. */ #define LOC_YD_SFMA_SMRDR0 (0x38)  /*************************************************************************** Constant: LOC_YD_SFMA_SMRDR1  The offset value of the SMRDR1 register from the base address. */ #define LOC_YD_SFMA_SMRDR1 (0x3c)  /*************************************************************************** Constant: LOC_YD_SFMA_SMWDR0  The offset value of the SMWDR0 register from the base address. */ #define LOC_YD_SFMA_SMWDR0 (0x40)  /*************************************************************************** Constant: LOC_YD_SFMA_SMWDR1  The offset value of the SMWDR1 register from the base address. */ #define LOC_YD_SFMA_SMWDR1 (0x44)  /*************************************************************************** Constant: LOC_YD_SFMA_CMNSR  The offset value of the CMNSR register from the base address. */ #define LOC_YD_SFMA_CMNSR (0x48)  /*************************************************************************** Constant: LOC_YD_SFMA_DRDMCR  The offset value of the DRDMCR register from the base address. */ #define LOC_YD_SFMA_DRDMCR (0x58)  /*************************************************************************** Constant: LOC_YD_SFMA_DRDRENR  The offset value of the DRDRENR register from the base address. */ #define LOC_YD_SFMA_DRDRENR (0x5c)  /*************************************************************************** Constant: LOC_YD_SFMA_SMDMCR  The offset value of the SMDMCR register from the base address. */ #define LOC_YD_SFMA_SMDMCR (0x60)  /*************************************************************************** Constant: LOC_YD_SFMA_SMDRENR  The offset value of the SMDRENR register from the base address. */ #define LOC_YD_SFMA_SMDRENR (0x64)  /*************************************************************************** Constant: LOC_YD_SFMA_CMNCR  A constant for bit mask value and offset value of CMNCR.  LOC_YD_SFMA_CMNCR_BSZ - Mask values of BSZ field. LOC_YD_SFMA_CMNCR_CPOL - Mask values of CPOL field. LOC_YD_SFMA_CMNCR_SSLP - Mask values of SSLP field. LOC_YD_SFMA_CMNCR_CPHAR - Mask values of CPHAR field. LOC_YD_SFMA_CMNCR_CPHAT - Mask values of CPHAT field. LOC_YD_SFMA_CMNCR_IO0FV - Mask values of IO0FV field. LOC_YD_SFMA_CMNCR_IO2FV - Mask values of IO2FV field. LOC_YD_SFMA_CMNCR_IO3FV - Mask values of IO3FV field. LOC_YD_SFMA_CMNCR_MOIIO0 - Mask values of MOIIO0 field. LOC_YD_SFMA_CMNCR_MOIIO1 - Mask values of MOIIO1 field. LOC_YD_SFMA_CMNCR_MOIIO2 - Mask values of MOIIO2 field. LOC_YD_SFMA_CMNCR_MOIIO3 - Mask values of MOIIO3 field. LOC_YD_SFMA_CMNCR_SFDE - Mask values of SFDE field. LOC_YD_SFMA_CMNCR_MD - Mask values of MD field. LOC_YD_SFMA_CMNCR_BSZ_SHIFT - Offset values of BSZ field. LOC_YD_SFMA_CMNCR_CPOL_SHIFT - Offset values of CPOL field. LOC_YD_SFMA_CMNCR_SSLP_SHIFT - Offset values of SSLP field. LOC_YD_SFMA_CMNCR_CPHAR_SHIFT - Offset values of CPHAR field. LOC_YD_SFMA_CMNCR_CPHAT_SHIFT - Offset values of CPHAT field. LOC_YD_SFMA_CMNCR_IO0FV_SHIFT - Offset values of IO0FV field. LOC_YD_SFMA_CMNCR_IO2FV_SHIFT - Offset values of IO2FV field. LOC_YD_SFMA_CMNCR_IO3FV_SHIFT - Offset values of IO3FV field. LOC_YD_SFMA_CMNCR_MOIIO0_SHIFT - Offset values of MOIIO0 field. LOC_YD_SFMA_CMNCR_MOIIO1_SHIFT - Offset values of MOIIO1 field. LOC_YD_SFMA_CMNCR_MOIIO2_SHIFT - Offset values of MOIIO2 field. LOC_YD_SFMA_CMNCR_MOIIO3_SHIFT - Offset values of MOIIO3 field. LOC_YD_SFMA_CMNCR_SFDE_SHIFT - Offset values of SFDE field. LOC_YD_SFMA_CMNCR_MD_SHIFT - Offset values of MD field. */ #define LOC_YD_SFMA_CMNCR_BSZ (0x00000003uL) #define LOC_YD_SFMA_CMNCR_CPOL (0x00000008uL) #define LOC_YD_SFMA_CMNCR_SSLP (0x00000010uL) #define LOC_YD_SFMA_CMNCR_CPHAR (0x00000020uL) #define LOC_YD_SFMA_CMNCR_CPHAT (0x00000040uL) #define LOC_YD_SFMA_CMNCR_IO0FV (0x00000300uL) #define LOC_YD_SFMA_CMNCR_IO2FV (0x00003000uL) #define LOC_YD_SFMA_CMNCR_IO3FV (0x0000C000uL) #define LOC_YD_SFMA_CMNCR_MOIIO0 (0x00030000uL) #define LOC_YD_SFMA_CMNCR_MOIIO1 (0x000C0000uL) #define LOC_YD_SFMA_CMNCR_MOIIO2 (0x00300000uL) #define LOC_YD_SFMA_CMNCR_MOIIO3 (0x00C00000uL) #define LOC_YD_SFMA_CMNCR_SFDE (0x01000000uL) #define LOC_YD_SFMA_CMNCR_MD (0x80000000uL) #define LOC_YD_SFMA_CMNCR_BSZ_SHIFT (0u) #define LOC_YD_SFMA_CMNCR_CPOL_SHIFT (3u) #define LOC_YD_SFMA_CMNCR_SSLP_SHIFT (4u) #define LOC_YD_SFMA_CMNCR_CPHAR_SHIFT (5u) #define LOC_YD_SFMA_CMNCR_CPHAT_SHIFT (6u) #define LOC_YD_SFMA_CMNCR_IO0FV_SHIFT (8u) #define LOC_YD_SFMA_CMNCR_IO2FV_SHIFT (12u) #define LOC_YD_SFMA_CMNCR_IO3FV_SHIFT (14u) #define LOC_YD_SFMA_CMNCR_MOIIO0_SHIFT (16u) #define LOC_YD_SFMA_CMNCR_MOIIO1_SHIFT (18u) #define LOC_YD_SFMA_CMNCR_MOIIO2_SHIFT (20u) #define LOC_YD_SFMA_CMNCR_MOIIO3_SHIFT (22u) #define LOC_YD_SFMA_CMNCR_SFDE_SHIFT (24u) #define LOC_YD_SFMA_CMNCR_MD_SHIFT (31u)  /*************************************************************************** Constant: LOC_YD_SFMA_SSLDR  A constant for bit mask value and offset value of SSLDR.  LOC_YD_SFMA_SSLDR_SCKDL - Mask values of SCKDL field. LOC_YD_SFMA_SSLDR_SLNDL - Mask values of SLNDL field. LOC_YD_SFMA_SSLDR_SPNDL - Mask values of SPNDL field. LOC_YD_SFMA_SSLDR_SCKDL_SHIFT - Offset values of SCKDL field. LOC_YD_SFMA_SSLDR_SLNDL_SHIFT - Offset values of SLNDL field. LOC_YD_SFMA_SSLDR_SPNDL_SHIFT - Offset values of SPNDL field. */ #define LOC_YD_SFMA_SSLDR_SCKDL (0x00000007uL) #define LOC_YD_SFMA_SSLDR_SLNDL (0x00000700uL) #define LOC_YD_SFMA_SSLDR_SPNDL (0x00070000uL) #define LOC_YD_SFMA_SSLDR_SCKDL_SHIFT (0u) #define LOC_YD_SFMA_SSLDR_SLNDL_SHIFT (8u) #define LOC_YD_SFMA_SSLDR_SPNDL_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_SPBCR  A constant for bit mask value and offset value of SPBCR.  LOC_YD_SFMA_SPBCR_BRDV - Mask values of BRDV field. LOC_YD_SFMA_SPBCR_SPBR - Mask values of SPBR field. LOC_YD_SFMA_SPBCR_BRDV_SHIFT - Offset values of BRDV field. LOC_YD_SFMA_SPBCR_SPBR_SHIFT - Offset values of SPBR field. */ #define LOC_YD_SFMA_SPBCR_BRDV (0x00000003uL) #define LOC_YD_SFMA_SPBCR_SPBR (0x0000FF00uL) #define LOC_YD_SFMA_SPBCR_BRDV_SHIFT (0u) #define LOC_YD_SFMA_SPBCR_SPBR_SHIFT (8u)  /*************************************************************************** Constant: LOC_YD_SFMA_DRCR  A constant for bit mask value and offset value of DRCR.  LOC_YD_SFMA_DRCR_RCF - Mask values of RCF field. LOC_YD_SFMA_DRCR_RBURST - Mask values of RBURST field. LOC_YD_SFMA_DRCR_SSLN - Mask values of SSLN field. LOC_YD_SFMA_DRCR_SSLE_SHIFT - Offset values of SSLE field. LOC_YD_SFMA_DRCR_RBE_SHIFT - Offset values of RBE field. LOC_YD_SFMA_DRCR_RCF_SHIFT - Offset values of RCF field. LOC_YD_SFMA_DRCR_RBURST_SHIFT - Offset values of RBURST field. LOC_YD_SFMA_DRCR_SSLN_SHIFT - Offset values of SSLN field. LOC_YD_SFMA_DRCR_BFM_SHIFT - Offset values of BFM field. */ #define LOC_YD_SFMA_DRCR_RCF (0x00000200uL) #define LOC_YD_SFMA_DRCR_RBURST (0x000F0000uL) #define LOC_YD_SFMA_DRCR_SSLN (0x01000000uL) #define LOC_YD_SFMA_DRCR_SSLE_SHIFT (0u) #define LOC_YD_SFMA_DRCR_RBE_SHIFT (8u) #define LOC_YD_SFMA_DRCR_RCF_SHIFT (9u) #define LOC_YD_SFMA_DRCR_RBURST_SHIFT (16u) #define LOC_YD_SFMA_DRCR_SSLN_SHIFT (24u) #define LOC_YD_SFMA_DRCR_BFM_SHIFT (29u)  /*************************************************************************** Constant: LOC_YD_SFMA_DRCMR  A constant for bit mask value and offset value of DRCMR.  LOC_YD_SFMA_DRCMR_OCMD - Mask values of OCMD field. LOC_YD_SFMA_DRCMR_CMD - Mask values of CMD field. LOC_YD_SFMA_DRCMR_OCMD_SHIFT - Offset values of OCMD field. LOC_YD_SFMA_DRCMR_CMD_SHIFT - Offset values of CMD field. */ #define LOC_YD_SFMA_DRCMR_OCMD (0x000000FFuL) #define LOC_YD_SFMA_DRCMR_CMD (0x00FF0000uL) #define LOC_YD_SFMA_DRCMR_OCMD_SHIFT (0u) #define LOC_YD_SFMA_DRCMR_CMD_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_DREAR  A constant for bit mask value and offset value of DREAR.  LOC_YD_SFMA_DREAR_EAC - Mask values of EAC field. LOC_YD_SFMA_DREAR_EAV - Mask values of EAV field. LOC_YD_SFMA_DREAR_EAC_SHIFT - Offset values of EAC field. LOC_YD_SFMA_DREAR_EAV_SHIFT - Offset values of EAV field. */ #define LOC_YD_SFMA_DREAR_EAC (0x00000007uL) #define LOC_YD_SFMA_DREAR_EAV (0x00FF0000uL) #define LOC_YD_SFMA_DREAR_EAC_SHIFT (0u) #define LOC_YD_SFMA_DREAR_EAV_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_DROPR  A constant for bit mask value and offset value of DROPR.  LOC_YD_SFMA_DROPR_OPD0 - Mask values of OPD0 field. LOC_YD_SFMA_DROPR_OPD1 - Mask values of OPD1 field. LOC_YD_SFMA_DROPR_OPD2 - Mask values of OPD2 field. LOC_YD_SFMA_DROPR_OPD3 - Mask values of OPD3 field. LOC_YD_SFMA_DROPR_OPD0_SHIFT - Offset values of OPD0 field. LOC_YD_SFMA_DROPR_OPD1_SHIFT - Offset values of OPD1 field. LOC_YD_SFMA_DROPR_OPD2_SHIFT - Offset values of OPD2 field. LOC_YD_SFMA_DROPR_OPD3_SHIFT - Offset values of OPD3 field. */ #define LOC_YD_SFMA_DROPR_OPD0 (0x000000FFuL) #define LOC_YD_SFMA_DROPR_OPD1 (0x0000FF00uL) #define LOC_YD_SFMA_DROPR_OPD2 (0x00FF0000uL) #define LOC_YD_SFMA_DROPR_OPD3 (0xFF000000uL) #define LOC_YD_SFMA_DROPR_OPD0_SHIFT (0u) #define LOC_YD_SFMA_DROPR_OPD1_SHIFT (8u) #define LOC_YD_SFMA_DROPR_OPD2_SHIFT (16u) #define LOC_YD_SFMA_DROPR_OPD3_SHIFT (24u)  /*************************************************************************** Constant: LOC_YD_SFMA_DRENR  A constant for bit mask value and offset value of DRENR.  LOC_YD_SFMA_DRENR_OPDE - Mask values of OPDE field. LOC_YD_SFMA_DRENR_ADE - Mask values of ADE field. LOC_YD_SFMA_DRENR_OCDE - Mask values of OCDE field. LOC_YD_SFMA_DRENR_CDE - Mask values of CDE field. LOC_YD_SFMA_DRENR_DME - Mask values of DME field. LOC_YD_SFMA_DRENR_DRDB - Mask values of DRDB field. LOC_YD_SFMA_DRENR_OPDB - Mask values of OPDB field. LOC_YD_SFMA_DRENR_ADB - Mask values of ADB field. LOC_YD_SFMA_DRENR_OCDB - Mask values of OCDB field. LOC_YD_SFMA_DRENR_CDB - Mask values of CDB field. LOC_YD_SFMA_DRENR_OPDE_SHIFT - Offset values of OPDE field. LOC_YD_SFMA_DRENR_ADE_SHIFT - Offset values of ADE field. LOC_YD_SFMA_DRENR_OCDE_SHIFT - Offset values of OCDE field. LOC_YD_SFMA_DRENR_CDE_SHIFT - Offset values of CDE field. LOC_YD_SFMA_DRENR_DME_SHIFT - Offset values of DME field. LOC_YD_SFMA_DRENR_DRDB_SHIFT - Offset values of DRDB field. LOC_YD_SFMA_DRENR_OPDB_SHIFT - Offset values of OPDB field. LOC_YD_SFMA_DRENR_ADB_SHIFT - Offset values of ADB field. LOC_YD_SFMA_DRENR_OCDB_SHIFT - Offset values of OCDB field. LOC_YD_SFMA_DRENR_CDB_SHIFT - Offset values of CDB field. */ #define LOC_YD_SFMA_DRENR_OPDE (0x000000F0uL) #define LOC_YD_SFMA_DRENR_ADE (0x00000F00uL) #define LOC_YD_SFMA_DRENR_OCDE (0x00001000uL) #define LOC_YD_SFMA_DRENR_CDE (0x00004000uL) #define LOC_YD_SFMA_DRENR_DME (0x00008000uL) #define LOC_YD_SFMA_DRENR_DRDB (0x00030000uL) #define LOC_YD_SFMA_DRENR_OPDB (0x00300000uL) #define LOC_YD_SFMA_DRENR_ADB (0x03000000uL) #define LOC_YD_SFMA_DRENR_OCDB (0x30000000uL) #define LOC_YD_SFMA_DRENR_CDB (0xC0000000uL) #define LOC_YD_SFMA_DRENR_OPDE_SHIFT (4u) #define LOC_YD_SFMA_DRENR_ADE_SHIFT (8u) #define LOC_YD_SFMA_DRENR_OCDE_SHIFT (12u) #define LOC_YD_SFMA_DRENR_CDE_SHIFT (14u) #define LOC_YD_SFMA_DRENR_DME_SHIFT (15u) #define LOC_YD_SFMA_DRENR_DRDB_SHIFT (16u) #define LOC_YD_SFMA_DRENR_OPDB_SHIFT (20u) #define LOC_YD_SFMA_DRENR_ADB_SHIFT (24u) #define LOC_YD_SFMA_DRENR_OCDB_SHIFT (28u) #define LOC_YD_SFMA_DRENR_CDB_SHIFT (30u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMCR  A constant for bit mask value and offset value of SMCR.  LOC_YD_SFMA_SMCR_SPIE - Mask values of SPIE field. LOC_YD_SFMA_SMCR_SPIWE - Mask values of SPIWE field. LOC_YD_SFMA_SMCR_SPIRE - Mask values of SPIRE field. LOC_YD_SFMA_SMCR_SSLKP - Mask values of SSLKP field. LOC_YD_SFMA_SMCR_SPIE_SHIFT - Offset values of SPIWE field. LOC_YD_SFMA_SMCR_SPIWE_SHIFT - Offset values of SPIRE field. LOC_YD_SFMA_SMCR_SPIRE_SHIFT - Offset values of SSLKP field. LOC_YD_SFMA_SMCR_SSLKP_SHIFT - Offset values of SSLKP field. */ #define LOC_YD_SFMA_SMCR_SPIE (0x00000001uL) #define LOC_YD_SFMA_SMCR_SPIWE (0x00000002uL) #define LOC_YD_SFMA_SMCR_SPIRE (0x00000004uL) #define LOC_YD_SFMA_SMCR_SSLKP (0x00000100uL) #define LOC_YD_SFMA_SMCR_SPIE_SHIFT (0u) #define LOC_YD_SFMA_SMCR_SPIWE_SHIFT (1u) #define LOC_YD_SFMA_SMCR_SPIRE_SHIFT (2u) #define LOC_YD_SFMA_SMCR_SSLKP_SHIFT (8u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMCMR  A constant for bit mask value and offset value of SMCMR.  LOC_YD_SFMA_SMCMR_OCMD - Mask values of OCMD field. LOC_YD_SFMA_SMCMR_CMD - Mask values of CMD field. LOC_YD_SFMA_SMCMR_OCMD_SHIFT - Offset values of OCMD field. LOC_YD_SFMA_SMCMR_CMD_SHIFT - Offset values of CMD field. */ #define LOC_YD_SFMA_SMCMR_OCMD (0x000000FFuL) #define LOC_YD_SFMA_SMCMR_CMD (0x00FF0000uL) #define LOC_YD_SFMA_SMCMR_OCMD_SHIFT (0u) #define LOC_YD_SFMA_SMCMR_CMD_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMADR  A constant for bit mask value and offset value of SMADR.  LOC_YD_SFMA_SMADR_ADR - Mask values of ADR field. LOC_YD_SFMA_SMADR_ADR_SHIFT - Offset values of ADR field. */ #define LOC_YD_SFMA_SMADR_ADR (0xFFFFFFFFuL) #define LOC_YD_SFMA_SMADR_ADR_SHIFT (0u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMOPR_OPD  A constant for bit mask value and offset value of SMOPR.  LOC_YD_SFMA_SMOPR_OPD0 - Mask values of OPD0 field. LOC_YD_SFMA_SMOPR_OPD1 - Mask values of OPD1 field. LOC_YD_SFMA_SMOPR_OPD2 - Mask values of OPD2 field. LOC_YD_SFMA_SMOPR_OPD3 - Mask values of OPD3 field. LOC_YD_SFMA_SMOPR_OPD0_SHIFT - Offset values of OPD0 field. LOC_YD_SFMA_SMOPR_OPD1_SHIFT - Offset values of OPD1 field. LOC_YD_SFMA_SMOPR_OPD2_SHIFT - Offset values of OPD2 field. LOC_YD_SFMA_SMOPR_OPD3_SHIFT - Offset values of OPD3 field. */ #define LOC_YD_SFMA_SMOPR_OPD0 (0x000000FFuL) #define LOC_YD_SFMA_SMOPR_OPD1 (0x0000FF00uL) #define LOC_YD_SFMA_SMOPR_OPD2 (0x00FF0000uL) #define LOC_YD_SFMA_SMOPR_OPD3 (0xFF000000uL) #define LOC_YD_SFMA_SMOPR_OPD0_SHIFT (0u) #define LOC_YD_SFMA_SMOPR_OPD1_SHIFT (8u) #define LOC_YD_SFMA_SMOPR_OPD2_SHIFT (16u) #define LOC_YD_SFMA_SMOPR_OPD3_SHIFT (24u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMENR  A constant for bit mask value and offset value of SMENR.  LOC_YD_SFMA_SMENR_SPIDE - Mask values of SPIDE field. LOC_YD_SFMA_SMENR_OPDE - Mask values of OPDE field. LOC_YD_SFMA_SMENR_ADE - Mask values of ADE field. LOC_YD_SFMA_SMENR_OCDE - Mask values of OCDE field. LOC_YD_SFMA_SMENR_CDE - Mask values of CDE field. LOC_YD_SFMA_SMENR_DME - Mask values of DME field. LOC_YD_SFMA_SMENR_SPIDB - Mask values of SPIDB field. LOC_YD_SFMA_SMENR_OPDB - Mask values of OPDB field. LOC_YD_SFMA_SMENR_ADB - Mask values of ADB field. LOC_YD_SFMA_SMENR_OCDB - Mask values of OCDB field. LOC_YD_SFMA_SMENR_CDB - Mask values of CDB field. LOC_YD_SFMA_SMENR_SPIDE_SHIFT - Offset values of SPIDE field. LOC_YD_SFMA_SMENR_OPDE_SHIFT - Offset values of OPDE field. LOC_YD_SFMA_SMENR_ADE_SHIFT - Offset values of ADE field. LOC_YD_SFMA_SMENR_OCDE_SHIFT - Offset values of OCDE field. LOC_YD_SFMA_SMENR_CDE_SHIFT - Offset values of CDE field. LOC_YD_SFMA_SMENR_DME_SHIFT - Offset values of DME field. LOC_YD_SFMA_SMENR_SPIDB_SHIFT - Offset values of SPIDB field. LOC_YD_SFMA_SMENR_OPDB_SHIFT - Offset values of OPDB field. LOC_YD_SFMA_SMENR_ADB_SHIFT - Offset values of ADB field. LOC_YD_SFMA_SMENR_OCDB_SHIFT - Offset values of OCDB field. LOC_YD_SFMA_SMENR_CDB_SHIFT - Offset values of CDB field. */ #define LOC_YD_SFMA_SMENR_SPIDE (0x0000000FuL) #define LOC_YD_SFMA_SMENR_OPDE (0x000000F0uL) #define LOC_YD_SFMA_SMENR_ADE (0x00000F00uL) #define LOC_YD_SFMA_SMENR_OCDE (0x00001000uL) #define LOC_YD_SFMA_SMENR_CDE (0x00004000uL) #define LOC_YD_SFMA_SMENR_DME (0x00008000uL) #define LOC_YD_SFMA_SMENR_SPIDB (0x00030000uL) #define LOC_YD_SFMA_SMENR_OPDB (0x00300000uL) #define LOC_YD_SFMA_SMENR_ADB (0x03000000uL) #define LOC_YD_SFMA_SMENR_OCDB (0x30000000uL) #define LOC_YD_SFMA_SMENR_CDB (0xC0000000uL) #define LOC_YD_SFMA_SMENR_SPIDE_SHIFT (0u) #define LOC_YD_SFMA_SMENR_OPDE_SHIFT (4u) #define LOC_YD_SFMA_SMENR_ADE_SHIFT (8u) #define LOC_YD_SFMA_SMENR_OCDE_SHIFT (12u) #define LOC_YD_SFMA_SMENR_CDE_SHIFT (14u) #define LOC_YD_SFMA_SMENR_DME_SHIFT (15u) #define LOC_YD_SFMA_SMENR_SPIDB_SHIFT (16u) #define LOC_YD_SFMA_SMENR_OPDB_SHIFT (20u) #define LOC_YD_SFMA_SMENR_ADB_SHIFT (24u) #define LOC_YD_SFMA_SMENR_OCDB_SHIFT (28u) #define LOC_YD_SFMA_SMENR_CDB_SHIFT (30u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMRDR0  A constant for bit mask value and offset value of SMRDR0.  LOC_YD_SFMA_SMRDR0_RDATA0 - Mask values of RDATA0 field. LOC_YD_SFMA_SMRDR0_RDATA0_SHIFT - Offset values of RDATA0 field. */ #define LOC_YD_SFMA_SMRDR0_RDATA0 (0xFFFFFFFFuL) #define LOC_YD_SFMA_SMRDR0_RDATA0_SHIFT (0u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMRDR1  A constant for bit mask value and offset value of SMRDR1.  LOC_YD_SFMA_SMRDR1_RDATA1 - Mask values of RDATA1 field. LOC_YD_SFMA_SMRDR1_RDATA1_SHIFT - Offset values of RDATA1 field. */ #define LOC_YD_SFMA_SMRDR1_RDATA1 (0xFFFFFFFFuL) #define LOC_YD_SFMA_SMRDR1_RDATA1_SHIFT (0u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMWDR0  A constant for bit mask value and offset value of SMWDR0.  LOC_YD_SFMA_SMWDR0_WDATA0 - Mask values of WDATA0 field. LOC_YD_SFMA_SMWDR0_WDATA0_SHIFT - Offset values of WDATA0 field. */ #define LOC_YD_SFMA_SMWDR0_WDATA0 (0xFFFFFFFFuL) #define LOC_YD_SFMA_SMWDR0_WDATA0_SHIFT (0u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMWDR1  A constant for bit mask value and offset value of SMWDR1.  LOC_YD_SFMA_SMWDR1_WDATA1 - Mask values of WDATA1 field. LOC_YD_SFMA_SMWDR1_WDATA1_SHIFT - Offset values of WDATA1 field. */ #define LOC_YD_SFMA_SMWDR1_WDATA1 (0xFFFFFFFFuL) #define LOC_YD_SFMA_SMWDR1_WDATA1_SHIFT (0u)  /*************************************************************************** Constant: LOC_YD_SFMA_CMNSR  A constant for bit mask value and offset value of CMNSR.  LOC_YD_SFMA_CMNSR_TEND - Mask values of TEND field. LOC_YD_SFMA_CMNSR_SSLF - Mask values of SSLF field. LOC_YD_SFMA_CMNSR_TEND_SHIFT - Offset values of TEND field. LOC_YD_SFMA_CMNSR_SSLF_SHIFT - Offset values of SSLF field. */ #define LOC_YD_SFMA_CMNSR_TEND (0x00000001uL) #define LOC_YD_SFMA_CMNSR_SSLF (0x00000002uL) #define LOC_YD_SFMA_CMNSR_TEND_SHIFT (0u) #define LOC_YD_SFMA_CMNSR_SSLF_SHIFT (1u)  /*************************************************************************** Constant: LOC_YD_SFMA_DRDMCR  A constant for bit mask value and offset value of DRDMCR.  LOC_YD_SFMA_DRDMCR_DMCYC - Mask values of DMCYC field. LOC_YD_SFMA_DRDMCR_DMDB - Mask values of DMDB field. LOC_YD_SFMA_DRDMCR_DMCYC_SHIFT - Offset values of DMCYC field. LOC_YD_SFMA_DRDMCR_DMDB_SHIFT - Offset values of DMDB field. */ #define LOC_YD_SFMA_DRDMCR_DMCYC (0x00000007uL) #define LOC_YD_SFMA_DRDMCR_DMDB (0x00030000uL) #define LOC_YD_SFMA_DRDMCR_DMCYC_SHIFT (0u) #define LOC_YD_SFMA_DRDMCR_DMDB_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_DRDRENR  A constant for bit mask value and offset value of DRDRENR.  LOC_YD_SFMA_DRDRENR_DRDRE - Mask values of DRDRE field. LOC_YD_SFMA_DRDRENR_OPDRE - Mask values of OPDRE field. LOC_YD_SFMA_DRDRENR_ADDRE - Mask values of ADDRE field. LOC_YD_SFMA_DRDRENR_DRDRE_SHIFT - Offset values of DRDRE field. LOC_YD_SFMA_DRDRENR_OPDRE_SHIFT - Offset values of OPDRE field. LOC_YD_SFMA_DRDRENR_ADDRE_SHIFT - Offset values of ADDRE field. */ #define LOC_YD_SFMA_DRDRENR_DRDRE (0x00000001uL) #define LOC_YD_SFMA_DRDRENR_OPDRE (0x00000010uL) #define LOC_YD_SFMA_DRDRENR_ADDRE (0x00000100uL) #define LOC_YD_SFMA_DRDRENR_DRDRE_SHIFT (0u) #define LOC_YD_SFMA_DRDRENR_OPDRE_SHIFT (4u) #define LOC_YD_SFMA_DRDRENR_ADDRE_SHIFT (8u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMDMCR  A constant for bit mask value and offset value of SMDMCR.  LOC_YD_SFMA_SMDMCR_DMCYC - Mask values of DMCYC field. LOC_YD_SFMA_SMDMCR_DMDB - Mask values of DMDB field. LOC_YD_SFMA_SMDMCR_DMCYC_SHIFT - Offset values of DMCYC field. LOC_YD_SFMA_SMDMCR_DMDB_SHIFT - Offset values of DMDB field. */ #define LOC_YD_SFMA_SMDMCR_DMCYC (0x00000007uL) #define LOC_YD_SFMA_SMDMCR_DMDB (0x00030000uL) #define LOC_YD_SFMA_SMDMCR_DMCYC_SHIFT (0u) #define LOC_YD_SFMA_SMDMCR_DMDB_SHIFT (16u)  /*************************************************************************** Constant: LOC_YD_SFMA_SMDRENR  A constant for bit mask value and offset value of SMDRENR.  LOC_YD_SFMA_SMDRENR_SPIDRE - Mask values of SPIDRE field. LOC_YD_SFMA_SMDRENR_OPDRE - Mask values of OPDRE field. LOC_YD_SFMA_SMDRENR_ADDRE - Mask values of ADDRE field. LOC_YD_SFMA_SMDRENR_SPIDRE_SHIFT - Offset values of SPIDRE field. LOC_YD_SFMA_SMDRENR_OPDRE_SHIFT - Offset values of OPDRE field. LOC_YD_SFMA_SMDRENR_ADDRE_SHIFT - Offset values of ADDRE field. */ #define LOC_YD_SFMA_SMDRENR_SPIDRE (0x00000001uL) #define LOC_YD_SFMA_SMDRENR_OPDRE (0x00000010uL) #define LOC_YD_SFMA_SMDRENR_ADDRE (0x00000100uL) #define LOC_YD_SFMA_SMDRENR_SPIDRE_SHIFT (0u) #define LOC_YD_SFMA_SMDRENR_OPDRE_SHIFT (4u) #define LOC_YD_SFMA_SMDRENR_ADDRE_SHIFT (8u)  /*************************************************************************** Constants: LOC_YD_SFMA_CMNCR_INIT_VALUE  Initial value of CMNCR register. */ #define LOC_YD_SFMA_CMNCR_INIT_VALUE ( \ (LOC_YD_SFMA_SPIBSC_CMNCR_SFDE << LOC_YD_SFMA_CMNCR_SFDE_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ << LOC_YD_SFMA_CMNCR_MOIIO3_SHIFT)| \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIGH << LOC_YD_SFMA_CMNCR_MOIIO2_SHIFT)| \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ << LOC_YD_SFMA_CMNCR_MOIIO1_SHIFT)| \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ << LOC_YD_SFMA_CMNCR_MOIIO0_SHIFT)| \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ << LOC_YD_SFMA_CMNCR_IO3FV_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIGH << LOC_YD_SFMA_CMNCR_IO2FV_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_OUTPUT_HIZ << LOC_YD_SFMA_CMNCR_IO0FV_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_CPHAT_EVEN << LOC_YD_SFMA_CMNCR_CPHAT_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_CPHAR_EVEN << LOC_YD_SFMA_CMNCR_CPHAR_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_SSLP_LOW << LOC_YD_SFMA_CMNCR_SSLP_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_CMNCR_CPOL_LOW << LOC_YD_SFMA_CMNCR_CPOL_SHIFT))  /*************************************************************************** Constants: LOC_YD_SFMA_SSLDR_INIT_VALUE  Initial value of SSLDR register. */ #define LOC_YD_SFMA_SSLDR_INIT_VALUE ( \ (LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK << LOC_YD_SFMA_SSLDR_SPNDL_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK << LOC_YD_SFMA_SSLDR_SLNDL_SHIFT) | \ (LOC_YD_SFMA_SPIBSC_DELAY_1SPBCLK << LOC_YD_SFMA_SSLDR_SCKDL_SHIFT))  /*************************************************************************** Constants: LOC_YD_SFMA_DRCR_INIT_VALUE  Initial value of DRCR register. */ #define LOC_YD_SFMA_DRCR_INIT_VALUE ( \ (LOC_YD_SFMA_SPIBSC_DRCR_BURST_ENABLE << LOC_YD_SFMA_DRCR_RBE_SHIFT) | \ (YD_SFMA_SPIBSC_SPISSL_KEEP << LOC_YD_SFMA_DRCR_SSLE_SHIFT))  /*************************************************************************** Macro: YD_SFMA_Write32  Write a value to a specified 32bit register. */ #define YD_SFMA_Write32(Addr, Value) {YD_SFMA_WRITE_REG(32,(Addr), (Value));}  /*************************************************************************** Macro: YD_SFMA_Read32  Read a value from a specified 32bit register. */ #define YD_SFMA_Read32(Addr) (YD_SFMA_READ32(Addr))   /*************************************************************************** Section: Local functions */  /*************************************************************************** Function: YD_SFMA_Modify32  Description: This function modifies the 32 bit register of SFMA H/W macro.  Parameter: Addr - The parameter specifies the register address which added an offset to the base address. Value - The parameter specifies the Value that is written. Bitposision - The parameter specifies the bit position that will be modified. BitMask - The parameter specifies the bit mask that will be cleared at bit position before modification.  Return Value: void */ static void YD_SFMA_Modify32(const uint32_t Addr, const uint32_t Value, const uint32_t BitPosition, const uint32_t BitMask);  static void YD_SFMA_Modify32(const uint32_t Addr, const uint32_t Value, const uint32_t BitPosition, const uint32_t BitMask) { uint32_t reg;  reg = YD_SFMA_READ32(Addr); reg &= ~BitMask; reg |= (Value<<BitPosition); YD_SFMA_WRITE32(Addr, reg); }  /*************************************************************************** Function: YD_SpibscWaitTend  Description: This function waits for the data transmission completion to the serial flash memory.  Parameter: Unit - The parameter specifies the instance number.  Return value: See <yd_sfma_Error_t>. */ static yd_sfma_Error_t YD_SpibscWaitTend(const uint32_t Unit);  static yd_sfma_Error_t YD_SpibscWaitTend(const uint32_t Unit) { yd_sfma_Error_t ret = YD_SFMA_ERR_OK; uint32_t reg_value; uint32_t base; uint32_t wait = 0;  base = YD_SFMA_BASE_ADD;  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy read */ YD_SFMA_Sys_SyncPeripheral(); do { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait for transfer-end */ if (wait > YD_SFMA_TRANSFER_END_WAIT) { ret = YD_SFMA_ERR_FATAL_HW; break; } wait++; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; } while (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END);  return ret; }  /*************************************************************************** Section: Global Functions */  /*************************************************************************** Function: YD_SFMA_SpibscCommonInit  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscCommonInit(const uint32_t Unit, const uint32_t Bsz, const uint8_t Spbr, const uint8_t Brdv, const uint8_t DataWidth, const uint8_t TransferMode) { yd_sfma_Error_t ret; uint32_t reg_value; uint32_t write_value; uint32_t base; uint32_t bitrate;  base = YD_SFMA_BASE_ADD;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr PORT setting of SPIBSC */ ret = YD_SFMA_ERR_OK; if (ret == YD_SFMA_ERR_OK) { reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = ((reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT); if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr The initialization of the common controller */ write_value = (LOC_YD_SFMA_CMNCR_INIT_VALUE | (Bsz << LOC_YD_SFMA_CMNCR_BSZ_SHIFT)); if (TransferMode == YD_SFMA_SPIBSC_DDR_TRANS) { write_value &= ~(LOC_YD_SFMA_CMNCR_CPHAR | LOC_YD_SFMA_CMNCR_CPHAT); } YD_SFMA_Write32((base + LOC_YD_SFMA_CMNCR), write_value); YD_SFMA_Modify32((base + LOC_YD_SFMA_DRCR), LOC_YD_SFMA_SPIBSC_DRCR_RCF_EXE, LOC_YD_SFMA_DRCR_RCF_SHIFT, LOC_YD_SFMA_DRCR_RCF);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr The initialization of the SSL delay */ YD_SFMA_Write32((base + LOC_YD_SFMA_SSLDR), LOC_YD_SFMA_SSLDR_INIT_VALUE);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- The initialization of the bit rate ---- */ bitrate = (((uint32_t)Spbr << LOC_YD_SFMA_SPBCR_SPBR_SHIFT) | ((uint32_t)Brdv << LOC_YD_SFMA_SPBCR_BRDV_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SPBCR), bitrate); } }  return ret; }   /*************************************************************************** Section: Global Functions */  /*************************************************************************** Function: YD_SFMA_SpibscReadReg  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscReadReg(void) { uint32_t reg_value; uint32_t base;  base = YD_SFMA_BASE_ADD;  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNCR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_SSLDR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_SPBCR);  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DRCR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DRCMR);  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DREAR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DROPR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DRENR);  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DRDMCR); reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DRDRENR);  return YD_SFMA_ERR_OK; }  /*************************************************************************** Function: YD_SFMA_SpibscDrInit  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscDrInit(const uint32_t Unit, const yd_sfma_SpiConfig_t r_sfma_api.c r_sfma_api.h r_sfma_driver_api.h r_sfma_flash.c r_sfma_flash.h r_sfma_iodevice_api.h r_sfma_spibsc.c r_sfma_spibsc.h r_sfma_spibsc_drv.c r_sfma_sys.h sfma_params.h yd_config_sfma.h yd_dev_api.h yd_dev_asm.s yd_sfma_api.c yd_sfma_api.h yd_sfma_flash.c yd_sfma_flash.h yd_sfma_spibsc.c yd_sfma_spibsc.h yd_sfma_spibsc_drv.c yd_sfma_sys.h yd_sys_sfma.c const SpiConfig) { yd_sfma_Error_t ret = YD_SFMA_ERR_OK; uint32_t reg_value; uint32_t write_value; uint32_t base; uint32_t command; uint32_t opd_enable; uint32_t dmycyc_num; uint32_t dmycyc_bit_size; uint32_t drcr;  if (SpiConfig == R_NULL) { ret = YD_SFMA_ERR_PARAM_INCORRECT; } else { base = YD_SFMA_BASE_ADD; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set parameter */ if (SpiConfig->DataWidth == YD_SFMA_SPIBSC_4BIT) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr command */ if (SpiConfig->TransferMode == YD_SFMA_SPIBSC_SDR_TRANS) { command = SpiConfig->Command.ReadSdrIoQuad; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadSdrIoQuadDummyCycle;  } else { command = SpiConfig->Command.ReadDdrIoQuad; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadDdrIoQuadDummyCycle; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of bits that HI-Z during the dummy cycle */ dmycyc_bit_size = YD_SFMA_SPIBSC_4BIT;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Performance enhance mode needs the option byte */ if(SpiConfig->PerformanceEnMode == YD_SFMA_PER_EN_MODE_ENABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr enable option byte 3 */ opd_enable = YD_SFMA_SPIBSC_OUTPUT_SPID_32; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr optional data none */ opd_enable = YD_SFMA_SPIBSC_OUTPUT_DISABLE; } } else if (SpiConfig->DataWidth == YD_SFMA_SPIBSC_2BIT) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr command */ if (SpiConfig->TransferMode == YD_SFMA_SPIBSC_SDR_TRANS) { command = SpiConfig->Command.ReadSdrIoDual; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadSdrIoDualDummyCycle; } else { command = SpiConfig->Command.ReadDdrIoDual; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadDdrIoDualDummyCycle; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of bits that HI-Z during the dummy cycle */ dmycyc_bit_size = YD_SFMA_SPIBSC_2BIT;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr optional data */ opd_enable = YD_SFMA_SPIBSC_OUTPUT_DISABLE; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr command */ if (SpiConfig->TransferMode == YD_SFMA_SPIBSC_SDR_TRANS) { command = SpiConfig->Command.ReadSdr; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadSdrDummyCycle; } else { command = SpiConfig->Command.ReadDdr; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr dummy cycle number */ dmycyc_num = SpiConfig->Command.ReadDdrDummyCycle; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of bits that HI-Z during the dummy cycle */ dmycyc_bit_size = YD_SFMA_SPIBSC_1BIT;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr optional data */ opd_enable = YD_SFMA_SPIBSC_OUTPUT_DISABLE; }  if (command != YD_SFMA_NOT_SUPPORT_COMMAND) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr External Address mode */ YD_SFMA_Modify32((base + LOC_YD_SFMA_CMNCR), LOC_YD_SFMA_SPIBSC_CMNCR_MD_EXTRD, LOC_YD_SFMA_CMNCR_MD_SHIFT, LOC_YD_SFMA_CMNCR_MD);  drcr = LOC_YD_SFMA_DRCR_INIT_VALUE;  if (SpiConfig->Cachemode != (uint32_t)YD_SFMA_CACHE_OFF) { drcr |= ((LOC_YD_SFMA_SPIBSC_DRCR_BFM_BURST << LOC_YD_SFMA_DRCR_BFM_SHIFT) | ((SpiConfig->Cachemode - 1u) << LOC_YD_SFMA_DRCR_RBURST_SHIFT)); }  YD_SFMA_Write32((base + LOC_YD_SFMA_DRCR), drcr);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr if not continuous address it negeted */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Command ---- */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Command */ write_value = ((command << LOC_YD_SFMA_DRCMR_CMD_SHIFT) | (YD_SFMA_SPIBSC_OUTPUT_DISABLE << LOC_YD_SFMA_SMCMR_OCMD_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_DRCMR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr we don't send out the command in performance enhance mode (CDE)*/ if(SpiConfig->PerformanceEnMode == YD_SFMA_PER_EN_MODE_ENABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr The initialization of the data read enable setting */ write_value = ((YD_SFMA_SPIBSC_4BIT << LOC_YD_SFMA_DRENR_CDB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_ADB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_OPDB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_DRDB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_OCDB_SHIFT) | (YD_SFMA_SPIBSC_DUMMY_CYC_ENABLE << LOC_YD_SFMA_DRENR_DME_SHIFT) | (YD_SFMA_SPIBSC_OUTPUT_DISABLE << LOC_YD_SFMA_DRENR_CDE_SHIFT) | (YD_SFMA_SPIBSC_OUTPUT_DISABLE << LOC_YD_SFMA_DRENR_OCDE_SHIFT) | ((uint32_t)SpiConfig->AddressMode << LOC_YD_SFMA_DRENR_ADE_SHIFT) | (opd_enable << LOC_YD_SFMA_DRENR_OPDE_SHIFT)); } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr The initialization of the data read enable setting */ write_value = ((YD_SFMA_SPIBSC_1BIT << LOC_YD_SFMA_DRENR_CDB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_ADB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_OPDB_SHIFT) | ((uint32_t)SpiConfig->DataWidth << LOC_YD_SFMA_DRENR_DRDB_SHIFT) | (YD_SFMA_SPIBSC_DUMMY_CYC_ENABLE << LOC_YD_SFMA_DRENR_DME_SHIFT) | (YD_SFMA_SPIBSC_OUTPUT_ENABLE << LOC_YD_SFMA_DRENR_CDE_SHIFT) | (YD_SFMA_SPIBSC_OUTPUT_DISABLE << LOC_YD_SFMA_DRENR_OCDE_SHIFT) | ((uint32_t)SpiConfig->AddressMode << LOC_YD_SFMA_DRENR_ADE_SHIFT) | (opd_enable << LOC_YD_SFMA_DRENR_OPDE_SHIFT)); }   YD_SFMA_Write32((base + LOC_YD_SFMA_DRENR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Option Data ---- */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr option byte 3 required in performance enhance mode */ if(SpiConfig->PerformanceEnMode == YD_SFMA_PER_EN_MODE_ENABLE) { YD_SFMA_Write32((base + LOC_YD_SFMA_DROPR), 0xA5000000uL); } else { YD_SFMA_Write32((base + LOC_YD_SFMA_DROPR), 0uL); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set data read dummycycle */ if (dmycyc_num == YD_SFMA_DUMMY_0CYC) { YD_SFMA_Modify32((base + LOC_YD_SFMA_DRENR), YD_SFMA_SPIBSC_DUMMY_CYC_DISABLE, LOC_YD_SFMA_DRENR_DME_SHIFT, LOC_YD_SFMA_DRENR_DME); } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr option byte required in performance enhance mode */ if(SpiConfig->PerformanceEnMode == YD_SFMA_PER_EN_MODE_ENABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of bits that HI-Z during the dummy cycle */ write_value = ((dmycyc_bit_size << LOC_YD_SFMA_DRDMCR_DMDB_SHIFT) | (dmycyc_num << LOC_YD_SFMA_DRDMCR_DMCYC_SHIFT)); } else { write_value = ((YD_SFMA_SPIBSC_1BIT << LOC_YD_SFMA_DRDMCR_DMDB_SHIFT) | (dmycyc_num << LOC_YD_SFMA_DRDMCR_DMCYC_SHIFT)); }  YD_SFMA_Write32((base + LOC_YD_SFMA_DRDMCR), write_value); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set data read DDR enable */ if (SpiConfig->TransferMode == YD_SFMA_SPIBSC_SDR_TRANS) { write_value = ((YD_SFMA_SPIBSC_SDR_TRANS << LOC_YD_SFMA_DRDRENR_ADDRE_SHIFT) | (YD_SFMA_SPIBSC_SDR_TRANS << LOC_YD_SFMA_DRDRENR_OPDRE_SHIFT) | (YD_SFMA_SPIBSC_SDR_TRANS << LOC_YD_SFMA_DRDRENR_DRDRE_SHIFT)); } else { write_value = ((YD_SFMA_SPIBSC_DDR_TRANS << LOC_YD_SFMA_DRDRENR_ADDRE_SHIFT) | (YD_SFMA_SPIBSC_DDR_TRANS << LOC_YD_SFMA_DRDRENR_OPDRE_SHIFT) | (YD_SFMA_SPIBSC_DDR_TRANS << LOC_YD_SFMA_DRDRENR_DRDRE_SHIFT)); }  YD_SFMA_Write32((base + LOC_YD_SFMA_DRDRENR), write_value); YD_SpibscWaitTend(Unit); } else { ret = YD_SFMA_ERR_NOT_SUPPORT_TRANSFER; } } }  return ret; }   /*************************************************************************** Function: YD_SFMA_SpibscClose  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscClose(const uint32_t Unit) { yd_sfma_Error_t ret = YD_SFMA_ERR_OK; uint32_t reg_value; uint32_t base; uint32_t wait = 0;  base = YD_SFMA_BASE_ADD; YD_SFMA_Modify32((base + LOC_YD_SFMA_DRCR), LOC_YD_SFMA_SPIBSC_DRCR_SSL_NEGATE, LOC_YD_SFMA_DRCR_SSLN_SHIFT, LOC_YD_SFMA_DRCR_SSLN); do { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait for transfer-end */ if (wait > YD_SFMA_SPBSSL_NEGATE_WAIT) { ret = YD_SFMA_ERR_FATAL_HW; break; } wait++;  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_SSLF) >> LOC_YD_SFMA_CMNSR_SSLF_SHIFT; } while (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_SSL_NEGATE);  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNCR); reg_value = (reg_value | LOC_YD_SFMA_CMNCR_MD); YD_SFMA_Write32((base + LOC_YD_SFMA_CMNCR), reg_value);  return ret; }  /*************************************************************************** Function: YD_SFMA_SpibscCommandTransfer  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscCommandTransfer(const uint32_t Unit, yd_sfma_SpibscSpimdReg_t r_sfma_api.c r_sfma_api.h r_sfma_driver_api.h r_sfma_flash.c r_sfma_flash.h r_sfma_iodevice_api.h r_sfma_spibsc.c r_sfma_spibsc.h r_sfma_spibsc_drv.c r_sfma_sys.h sfma_params.h yd_config_sfma.h yd_dev_api.h yd_dev_asm.s yd_sfma_api.c yd_sfma_api.h yd_sfma_flash.c yd_sfma_flash.h yd_sfma_spibsc.c yd_sfma_spibsc.h yd_sfma_spibsc_drv.c yd_sfma_sys.h yd_sys_sfma.c const Regset) { yd_sfma_Error_t ret = YD_SFMA_ERR_OK; uint32_t reg_value; uint32_t write_value; uint32_t smenr_value; uint32_t smcmr_value; uint32_t base;  if (Regset == R_NULL) { ret = YD_SFMA_ERR_PARAM_INCORRECT; } else { if ((Regset->Spidb != YD_SFMA_SPIBSC_1BIT) && (Regset->Spide != YD_SFMA_SPIBSC_OUTPUT_DISABLE)) { if ((Regset->Spire == YD_SFMA_SPIBSC_SPIDATA_ENABLE) && (Regset->Spiwe == YD_SFMA_SPIBSC_SPIDATA_ENABLE)) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr When the data size is set to 2 or 4 bits by using the SPIDB[1:0] bits, only one of the SPIRE and SPIWE bits should be enabled.*/ ret = YD_SFMA_ERR_PARAM_INCORRECT; } }  if (ret == YD_SFMA_ERR_OK) { base = YD_SFMA_BASE_ADD; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNCR); reg_value = (reg_value & LOC_YD_SFMA_CMNCR_MD) >> LOC_YD_SFMA_CMNCR_MD_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNCR_MD_SPI) { reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_SSLF) >> LOC_YD_SFMA_CMNSR_SSLF_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_SSL_NEGATE) { ret = YD_SFMA_ERR_FATAL_HW; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SPI Mode */ YD_SFMA_Modify32((base + LOC_YD_SFMA_CMNCR), LOC_YD_SFMA_SPIBSC_CMNCR_MD_SPI, LOC_YD_SFMA_CMNCR_MD_SHIFT, LOC_YD_SFMA_CMNCR_MD); } }  if (ret == YD_SFMA_ERR_OK) { reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Command ---- */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Option Data */ smenr_value = ((Regset->Cde << LOC_YD_SFMA_SMENR_CDE_SHIFT) | (Regset->Ocde << LOC_YD_SFMA_SMENR_OCDE_SHIFT) | (Regset->Ade << LOC_YD_SFMA_SMENR_ADE_SHIFT) | (Regset->Opde << LOC_YD_SFMA_SMENR_OPDE_SHIFT) | (Regset->Dme << LOC_YD_SFMA_SMENR_DME_SHIFT) | (Regset->Spide << LOC_YD_SFMA_SMENR_SPIDE_SHIFT) | (Regset->Spidb << LOC_YD_SFMA_SMENR_SPIDB_SHIFT)); smcmr_value = 0;  if (Regset->Cde != YD_SFMA_SPIBSC_OUTPUT_DISABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Command */ smcmr_value |= ((uint32_t)Regset->Cmd << LOC_YD_SFMA_SMCMR_CMD_SHIFT); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Single/Dual/Quad */ smenr_value |= (Regset->Cdb << LOC_YD_SFMA_SMENR_CDB_SHIFT); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Option Command ---- */ if (Regset->Ocde != YD_SFMA_SPIBSC_OUTPUT_DISABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Option Command */ smcmr_value |= ((uint32_t)Regset->Ocmd << LOC_YD_SFMA_SMCMR_OCMD_SHIFT); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Single/Dual/Quad */ smenr_value |= (Regset->Ocdb << LOC_YD_SFMA_SMENR_OCDB_SHIFT); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Address ---- */ if (Regset->Ade != YD_SFMA_SPIBSC_OUTPUT_DISABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Address */ YD_SFMA_Write32((base + LOC_YD_SFMA_SMADR), Regset->Addr); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Single/Dual/Quad */ smenr_value |= (Regset->Adb << LOC_YD_SFMA_SMENR_ADB_SHIFT); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Option Data ---- */ if (Regset->Opde != YD_SFMA_SPIBSC_OUTPUT_DISABLE) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Option Data */ write_value = (((uint32_t)Regset->Opd[YD_SFMA_OPTION_DATA_0] << LOC_YD_SFMA_SMOPR_OPD0_SHIFT) | ((uint32_t)Regset->Opd[YD_SFMA_OPTION_DATA_1] << LOC_YD_SFMA_SMOPR_OPD1_SHIFT) | ((uint32_t)Regset->Opd[YD_SFMA_OPTION_DATA_2] << LOC_YD_SFMA_SMOPR_OPD2_SHIFT) | ((uint32_t)Regset->Opd[YD_SFMA_OPTION_DATA_3] << LOC_YD_SFMA_SMOPR_OPD3_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMOPR), write_value); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Single/Dual/Quad */ smenr_value |= (Regset->Opdb << LOC_YD_SFMA_SMENR_OPDB_SHIFT); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Dummy ---- */ if (Regset->Dme != YD_SFMA_SPIBSC_DUMMY_CYC_DISABLE) { write_value = (((uint32_t)Regset->Dmdb << LOC_YD_SFMA_SMDMCR_DMDB_SHIFT) | ((uint32_t)Regset->Dmcyc << LOC_YD_SFMA_SMDMCR_DMCYC_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMDMCR), write_value); }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ---- Data ---- */ if (Regset->Spide != YD_SFMA_SPIBSC_OUTPUT_DISABLE) { YD_SFMA_Write32((base + LOC_YD_SFMA_SMWDR0), Regset->Smwdr[YD_SFMA_SMWDR_DATA_0]); YD_SFMA_Write32((base + LOC_YD_SFMA_SMWDR1), Regset->Smwdr[YD_SFMA_SMWDR_DATA_1]); } /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SPI mode */ YD_SFMA_Write32((base + LOC_YD_SFMA_SMENR), smenr_value); YD_SFMA_Write32((base + LOC_YD_SFMA_SMCMR), smcmr_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr SDR Transmission/DDR Transmission Setting */ write_value = ((Regset->Addre << LOC_YD_SFMA_SMDRENR_ADDRE_SHIFT) | (Regset->Opdre << LOC_YD_SFMA_SMDRENR_OPDRE_SHIFT) | (Regset->Spidre << LOC_YD_SFMA_SMDRENR_SPIDRE_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMDRENR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr execute after setting SPNDL bit */ write_value = ((Regset->Sslkp << LOC_YD_SFMA_SMCR_SSLKP_SHIFT) | (Regset->Spire << LOC_YD_SFMA_SMCR_SPIRE_SHIFT) | (Regset->Spiwe << LOC_YD_SFMA_SMCR_SPIWE_SHIFT) | (LOC_YD_SFMA_SPIBSC_SPI_ENABLE << LOC_YD_SFMA_SMCR_SPIE_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMCR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait for transfer-start */ ret = YD_SpibscWaitTend(Unit);  if (ret == YD_SFMA_ERR_OK) { Regset->Smrdr[YD_SFMA_SMRDR_DATA_0] = YD_SFMA_Read32(base + LOC_YD_SFMA_SMRDR0); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr valid in two serial-flash */ Regset->Smrdr[YD_SFMA_SMRDR_DATA_1] = YD_SFMA_Read32(base + LOC_YD_SFMA_SMRDR1); } } } } }  return ret; }   /*************************************************************************** Function: YD_SFMA_SpibscWriteTransfer  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscWriteTransfer(const uint32_t Unit, const yd_sfma_SpibscSpimdReg_t r_sfma_api.c r_sfma_api.h r_sfma_driver_api.h r_sfma_flash.c r_sfma_flash.h r_sfma_iodevice_api.h r_sfma_spibsc.c r_sfma_spibsc.h r_sfma_spibsc_drv.c r_sfma_sys.h sfma_params.h yd_config_sfma.h yd_dev_api.h yd_dev_asm.s yd_sfma_api.c yd_sfma_api.h yd_sfma_flash.c yd_sfma_flash.h yd_sfma_spibsc.c yd_sfma_spibsc.h yd_sfma_spibsc_drv.c yd_sfma_sys.h yd_sys_sfma.c const Regset) { yd_sfma_Error_t ret; uint32_t reg_value; uint32_t write_value; uint32_t base;  if (Regset == R_NULL) { ret = YD_SFMA_ERR_PARAM_INCORRECT; } else { base = YD_SFMA_BASE_ADD; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_SMENR); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr command/address disable */ write_value = (reg_value & ~(LOC_YD_SFMA_SMENR_CDE | LOC_YD_SFMA_SMENR_ADE | LOC_YD_SFMA_SMENR_SPIDB)); write_value |= ((Regset->Spidb << LOC_YD_SFMA_SMENR_SPIDB_SHIFT) | (Regset->Spide << LOC_YD_SFMA_SMENR_SPIDE_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMENR), write_value); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr data set */ YD_SFMA_Write32((base + LOC_YD_SFMA_SMWDR0), Regset->Smwdr[YD_SFMA_SMWDR_DATA_0]); YD_SFMA_Write32((base + LOC_YD_SFMA_SMWDR1), Regset->Smwdr[YD_SFMA_SMWDR_DATA_1]);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr write enable */ write_value = ((YD_SFMA_SPIBSC_SPIDATA_ENABLE << LOC_YD_SFMA_SMCR_SPIWE_SHIFT) | (LOC_YD_SFMA_SPIBSC_SPI_ENABLE << LOC_YD_SFMA_SMCR_SPIE_SHIFT)); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr signal level set */ if (Regset->Sslkp == YD_SFMA_SPIBSC_SPISSL_KEEP) { write_value |= (YD_SFMA_SPIBSC_SPISSL_KEEP << LOC_YD_SFMA_SMCR_SSLKP_SHIFT); } else { write_value &= ~LOC_YD_SFMA_SMCR_SSLKP; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr execute after setting SPNDL bit */ YD_SFMA_Write32((base + LOC_YD_SFMA_SMCR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait for transfer-start */ ret = YD_SpibscWaitTend(Unit); } }  return ret; }  /*************************************************************************** Function: YD_SFMA_SpibscReadTransfer  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscReadTransfer(const uint32_t Unit, yd_sfma_SpibscSpimdReg_t r_sfma_api.c r_sfma_api.h r_sfma_driver_api.h r_sfma_flash.c r_sfma_flash.h r_sfma_iodevice_api.h r_sfma_spibsc.c r_sfma_spibsc.h r_sfma_spibsc_drv.c r_sfma_sys.h sfma_params.h yd_config_sfma.h yd_dev_api.h yd_dev_asm.s yd_sfma_api.c yd_sfma_api.h yd_sfma_flash.c yd_sfma_flash.h yd_sfma_spibsc.c yd_sfma_spibsc.h yd_sfma_spibsc_drv.c yd_sfma_sys.h yd_sys_sfma.c const Regset) { yd_sfma_Error_t ret; uint32_t reg_value; uint32_t write_value; uint32_t base;  if (Regset == R_NULL) { ret = YD_SFMA_ERR_PARAM_INCORRECT; } else { base = YD_SFMA_BASE_ADD; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_SMENR); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr command/address disable */ write_value = (reg_value & ~(LOC_YD_SFMA_SMENR_CDE | LOC_YD_SFMA_SMENR_ADE | LOC_YD_SFMA_SMENR_DME | LOC_YD_SFMA_SMENR_SPIDB)); write_value |= ((Regset->Spidb << LOC_YD_SFMA_SMENR_SPIDB_SHIFT) | (Regset->Spide << LOC_YD_SFMA_SMENR_SPIDE_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_SMENR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr read enable */ write_value = ((YD_SFMA_SPIBSC_SPIDATA_ENABLE << LOC_YD_SFMA_SMCR_SPIRE_SHIFT) | (LOC_YD_SFMA_SPIBSC_SPI_ENABLE << LOC_YD_SFMA_SMCR_SPIE_SHIFT)); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr signal level set */ if (Regset->Sslkp == YD_SFMA_SPIBSC_SPISSL_KEEP) { write_value |= (YD_SFMA_SPIBSC_SPISSL_KEEP << LOC_YD_SFMA_SMCR_SSLKP_SHIFT); } else { write_value &= ~LOC_YD_SFMA_SMCR_SSLKP; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr execute after setting SPNDL bit */ YD_SFMA_Write32((base + LOC_YD_SFMA_SMCR), write_value);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait for transfer-start */ ret = YD_SpibscWaitTend(Unit);  if (ret == YD_SFMA_ERR_OK) { Regset->Smrdr[YD_SFMA_SMRDR_DATA_0] = YD_SFMA_Read32(base + LOC_YD_SFMA_SMRDR0); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr valid in two serial-flash */ Regset->Smrdr[YD_SFMA_SMRDR_DATA_1] = YD_SFMA_Read32(base + LOC_YD_SFMA_SMRDR1); } } }  return ret; }  /*************************************************************************** Function: YD_SFMA_SpibscDrAddr  see: <yd_sfma_spibsc.h> */ yd_sfma_Error_t YD_SFMA_SpibscDrAddr(const uint32_t Unit, const uint8_t Eav, const uint8_t Eac) { yd_sfma_Error_t ret = YD_SFMA_ERR_OK; uint32_t reg_value; uint32_t write_value; uint32_t base;  base = YD_SFMA_BASE_ADD; reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_CMNSR); reg_value = (reg_value & LOC_YD_SFMA_CMNSR_TEND) >> LOC_YD_SFMA_CMNSR_TEND_SHIFT; if (reg_value != LOC_YD_SFMA_SPIBSC_CMNSR_TRANS_END) { ret = YD_SFMA_ERR_FATAL_HW; } else { write_value = (((uint32_t)Eac << LOC_YD_SFMA_DREAR_EAC_SHIFT) | ((uint32_t)Eav << LOC_YD_SFMA_DREAR_EAV_SHIFT)); YD_SFMA_Write32((base + LOC_YD_SFMA_DREAR), write_value); }  YD_SpibscWaitTend(Unit);  reg_value = YD_SFMA_Read32(base + LOC_YD_SFMA_DREAR);  return ret; }
