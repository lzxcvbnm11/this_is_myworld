/***************************************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h File Name : adce.c adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description : Driver source file of ADCE. adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Date: 2016-12-14 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "adce_info.inc"  static BOOL adce_InitStatus;  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_Init adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: ADCE drive initialization adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: none adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: none adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ void ADCE_Init(void) {  /*PORT_ISOPMC10 = 0xFFFF;*/ /*PORT_ISOPM10 = 0xFFFF;*/ /*C_ISO_ADCE clock divider register, C_ISO_ADCE = CLKJIT/4 = 20MHz*/ protected_write(SYSPROTCMDD1, SYSPROTSD1, SYSCKSC_IADCED_CTL, 0x00000002UL); while(SYSCKSC_IADCED_ACT != 0x00000002UL){}  /*NOTE ADC moudle was in reset status after power up reset, user should clear this status before use this moulde.*/ protected_write(SYSPROTCMDMRST, SYSPROTSMRST, SYSMRSTC, 0x00003FFFUL); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Control the virtual channel ADCEnVCRj - Virtual Channel Register j b31:b15 - Reserved set to 0 b15 MPXE - MPX Enable - The use of MPX is prohibited. b14:b12 MPXV - These bits are used to set the MPX value to be transferred to an external analog multiplexer. - Unused. Set to 000'b.  b11:b10 - Reserved set to 0 b 9 CNVCLS - A/D Conversion Type Select for Self-Diagnosis - Unused. Set to 0'b. b 8 ADIE - A/D Conversion End Interrupt Enable - A scan group x end interrupt (NT_SGx) is not generated when A/D conversion for virtual channel j ends in SGx. Set to 0'b. b 7:b 6 ULS - Upper Limit/Lower Limit Table Select - Upper limit and lower limit are checked for ADCEnULLMTBR0.Unused. Set to 01'b. b 5:b 0 GCTRL - Physical Channel Select - Select ANI000 - ANI00F */  ADCE0.VCR00.UINT32 = 0x000000D0UL; ADCE0.VCR01.UINT32 = 0x000000D1UL; ADCE0.VCR02.UINT32 = 0x000000D2UL; ADCE0.VCR03.UINT32 = 0x000000D3UL; ADCE0.VCR04.UINT32 = 0x000000D4UL; ADCE0.VCR05.UINT32 = 0x000000D5UL; ADCE0.VCR06.UINT32 = 0x000000D6UL; ADCE0.VCR07.UINT32 = 0x000000D7UL; ADCE0.VCR08.UINT32 = 0x000000D8UL; ADCE0.VCR09.UINT32 = 0x000000D9UL; ADCE0.VCR10.UINT32 = 0x000000DAUL; ADCE0.VCR11.UINT32 = 0x000000DBUL; ADCE0.VCR12.UINT32 = 0x000000DCUL; ADCE0.VCR13.UINT32 = 0x000000DDUL; ADCE0.VCR14.UINT32 = 0x000000DEUL; ADCE0.VCR15.UINT32 = 0x000000DFUL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Common control the ADCEn ADCEnADCR - A/D Control Register b31:b 8 - Reserved set to 0 b 7 DGON - Self-Diagnostic Voltage Standby Control - The self-diagnostic voltage circuit is turned off. Set to 0'b. b 6 - Reserved set to 0 b 5 CRAC - Alignment Control - The results of conversion to WDDR and ADCAnDRj are stored rightaligned. Set to 0'b. b 4 CTYP - 12/10 Bit Select Mode - 12-bit mode. Set to 0'b. b 3:b 2 - Reserved set to 0 b 1:b 0 SUSMTD - Suspend Mode Select - Synchronous suspend when a higher-priority SG or SVSTOP interrupt. Set to 0'b. */ ADCE0.ADCR.UINT32 = 0x00000000UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Controls the sampling time for SG4 (PWM-Diag) and SG1 to SG3. ADCEnSMPCR - Sampling Control Register b31:b 8 - Reserved set to 0 b 7:b 0 SMPT - These bits are used to set the sampling time (the number of cycles). - 18 cycles (ADCACLK = 8 MHz to 32 MHz) */ ADCE0.SMPCR.UINT32 = 0x00000012UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set safety control. ADCEnSFTCR - Safety Control Register b31:b 5 - Reserved set to 0 b 4 RDCLRE - Read & Clear Enable - ADCEnPWDDR/ADCAnDRj and ADCEnPWDDIR / ADCEnDIRj are not cleared when  ADCEnPWDDR/ADCAnDRj or ADCEnPWDDIR /  ADCEnDIRj is read. Set to 0'b. b 3 ULEIE - A/D Error Interrupt (INT_ADE) Enable on Upper/Lower Limit Error Detection - Enabled. Set to 1'b. b 2 OWEIE - A/D Error Interrupt (INT_ADE) Enable on Overwrite Error Detection - Enabled. Set to 1'b. b 1:b 0 - Reserved set to 0 */  ADCE0.SFTCR.UINT32 = 0x0000000CUL;   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the upper limit / lower limit error detection threshold. ADCEnULLMTBR0 - Upper Limit/Lower Limit Table Registers 0 b31:b20 ULMTB - Upper Limit Table - Upper limit = 0FFFH b19:b16 - Reserved set to 0 b15:b 4 LLMTB - Lower Limit Table - Lower limit = 0800H b 3:b 0 - Reserved set to 0 */  ADCE0.ULLMTBR0.UINT32 = 0xFFF08000UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set A/D conversion trigger (hardware trigger) of SGx ADCEnSGTSELx - Scan Group x Start Trigger Control Register x b31:b 9 - Reserved set to 0 b 8 LLMTB - T1SEL8 - Unused. Set to 0'b. b 7 LLMTB - T1SEL7 - Unused. Set to 0'b. b 6 LLMTB - T1SEL6 - Unused. Set to 0'b. b 5 LLMTB - T1SEL5 - Unused. Set to 0'b. b 4 LLMTB - T1SEL4 - Unused. Set to 0'b. b 3 LLMTB - T1SEL3 - Unused. Set to 0'b. b 2 LLMTB - T1SEL2 - Unused. Set to 0'b. b 1 LLMTB - T1SEL1 - Unused. Set to 0'b. b 0 LLMTB - T1SEL0 - Unused. Set to 0'b. */  ADCE0.SGTSEL1.UINT32 = 0x00000000UL; ADCE0.SGTSEL2.UINT32 = 0x00000000UL; ADCE0.SGTSEL3.UINT32 = 0x00000000UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set A/D conversion trigger (hardware trigger) of SGx ADCEnSGCRx - Scan Group x Control Register b31:b 6 - Reserved set to 0 b 5 SCANMD - Scan Mode - Multicycle scan mode wyf b 4 ADIE - Scan End Interrupt Enable - INT_SGx is output when the scan for SGx ends. Set to 1'b. b 3:b 2 SCT - Channel Repeat Times Select - The selected number of channel repeat times is one. Set to 00'b. b 1 - Reserved set to 0 b 0 TRGMD - Trigger Mode - SGx_TRG start trigger or hold complete trigger A/B is selected for the trigger*/  ADCE0.SGCR1.UINT32 = 0x00000000UL; ADCE0.SGCR2.UINT32 = 0x00000000UL; ADCE0.SGCR3.UINT32 = 0x00000000UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the start pointer of the virtual channel ADCEnSGVCSPx - Scan Group x Start Virtual Channel Pointer b31:b 6 - Reserved set to 0 b 5:b 0 VCSP - Start Virtual Channel Pointer - set ADCA0VCR00 */  ADCE0.SGVCSP1.UINT32 = 0x00000000UL; ADCE0.SGVCSP2.UINT32 = 0x00000000UL; /*多通道选择开始通道*/ ADCE0.SGVCSP3.UINT32 = 0x00000000UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the end pointer of the virtual channel ADCEnSGVCEPx - Scan Group x End Virtual Channel Pointer b31:b 6 - Reserved set to 0 b 5:b 0 VCEP - End Virtual Channel Pointer - set ADCA0VCR0F */  ADCE0.SGVCEP1.UINT32 = 0x0000000FUL; ADCE0.SGVCEP2.UINT32 = 0x00000001UL; /*多通道选择结束通道*/ ADCE0.SGVCEP3.UINT32 = 0x00000002UL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set the scan number of times in the scan mode for a multi-cycle ADCEnSGMCYCRx - Scan Group x Multicycle Register b31:b 2 - Reserved set to 0 b 1:b 0 MCYC - Multicycle Number Specification - Number of scans = 1 */  ADCE0.SGMCYCR1.UINT32 = 0x00000000UL; ADCE0.SGMCYCR2.UINT32 = 0x00000000UL; ADCE0.SGMCYCR3.UINT32 = 0x00000000UL;  ADCE0.ADHALTR.UINT32 = 0x00000001UL;   adce_InitStatus = TRUE; }  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_GetSingleValue adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: get single channel of ad Value adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: Channel:ad channel pResult :store the ad value adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: FAIL/OK/INVALID adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ U8 ADCE_GetSingleValue(AdceChannel_ENUM Channel, PU16 pResult) {  U8 adce_res = RET_OK;  if (FALSE == adce_InitStatus) { adce_res = RET_FAIL; } else { if ((NULL_PTR == pResult) || (INDEX_ADCE_CH_ALL == Channel)) { adce_res = RET_INVALID; } else { while((ADCE0.SGSTR.UINT32 & 0x00000200) != 0);  switch (Channel) { case INDEX_ADCE_CH0: *pResult = ADCE0.DIR00.UINT32; break; case INDEX_ADCE_CH1: *pResult = ADCE0.DIR01.UINT32; break;  case INDEX_ADCE_CH2: *pResult = ADCE0.DIR02.UINT32; break; case INDEX_ADCE_CH3: *pResult = ADCE0.DIR03.UINT32; break; case INDEX_ADCE_CH4: *pResult = ADCE0.DIR04.UINT32;  break; case INDEX_ADCE_CH5: *pResult = ADCE0.DIR05.UINT32; break; case INDEX_ADCE_CH6: *pResult = ADCE0.DIR06.UINT32;  break; case INDEX_ADCE_CH7: *pResult = ADCE0.DIR07.UINT32; break; case INDEX_ADCE_CH8: *pResult = ADCE0.DIR08.UINT32; break; case INDEX_ADCE_CH9: *pResult = ADCE0.DIR09.UINT32; break; case INDEX_ADCE_CH10: *pResult = ADCE0.DIR10.UINT32; break; case INDEX_ADCE_CH11: *pResult = ADCE0.DIR11.UINT32; break; case INDEX_ADCE_CH12: *pResult = ADCE0.DIR12.UINT32;  break; case INDEX_ADCE_CH13: *pResult = ADCE0.DIR13.UINT32;  break; case INDEX_ADCE_CH14: *pResult = ADCE0.DIR14.UINT32; break; case INDEX_ADCE_CH15: *pResult = ADCE0.DIR15.UINT32;  break; default: adce_res = RET_INVALID; break; } } } return adce_res; }  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_GetMultiValue adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: get group of ad value adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: Channel:ad channel pResult :store the ad value adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: FAIL/OK/INVALID adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ U8 ADCE_GetMultiValue(AdceGroup_ENUM Group, PU16 pResult) {  U8 adce_res = RET_FAIL;  if (FALSE == adce_InitStatus) { adce_res = RET_FAIL; } else { if ((NULL_PTR == pResult) || (INDEX_ADCE_GROUP_ALL == Group)) { adce_res = RET_INVALID; } else { if (INDEX_ADCE_GROUP1 == Group) { ADCE0.SGSTCR1.UINT32 = 0x00000001UL; while((ADCE0.SGSTR.UINT32 & 0x00000200) != 0); pResult[0] = ADCE0.DIR00.UINT32; pResult[1] = ADCE0.DIR01.UINT32; pResult[2] = ADCE0.DIR02.UINT32; pResult[3] = ADCE0.DIR03.UINT32; pResult[4] = ADCE0.DIR04.UINT32; pResult[5] = ADCE0.DIR05.UINT32; pResult[6] = ADCE0.DIR06.UINT32; pResult[7] = ADCE0.DIR07.UINT32; pResult[8] = ADCE0.DIR08.UINT32; pResult[9] = ADCE0.DIR09.UINT32; pResult[10] = ADCE0.DIR10.UINT32; pResult[11] = ADCE0.DIR11.UINT32; pResult[12] = ADCE0.DIR12.UINT32; pResult[13] = ADCE0.DIR13.UINT32; pResult[14] = ADCE0.DIR14.UINT32; pResult[15] = ADCE0.DIR15.UINT32; } else if (INDEX_ADCE_GROUP2 == Group) { ADCE0.SGSTCR2.UINT32 = 0x00000001UL; while((ADCE0.SGSTR.UINT32 & 0x00000400) != 0); pResult[0] = ADCE0.DIR00.UINT32; pResult[1] = ADCE0.DIR01.UINT32; } else if (INDEX_ADCE_GROUP3 == Group) { ADCE0.SGSTCR3.UINT32 = 0x00000001UL; while((ADCE0.SGSTR.UINT32 & 0x00000800) != 0); pResult[0] = ADCE0.DIR00.UINT32; pResult[1] = ADCE0.DIR01.UINT32; pResult[2] = ADCE0.DIR02.UINT32; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Do Nothing */ } adce_res = RET_OK; } } return adce_res; }  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_GetInitStatus adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: get the ADCE module initialized status adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: none adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: adce_InitStatus adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ U8 ADCE_GetInitStatus(void) { return adce_InitStatus; }  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_StartConversion adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: Start ad Conversion adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: none adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: FAIL/OK/INVALID adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ U8 ADCE_StartConversion(void) {  U8 res = RET_OK;  if (TRUE == adce_InitStatus) { ADCE0.SGSTCR1.UINT32 = 0x00000001UL; } else { res = RET_FAIL; }  return res; }  /*************************************************** adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Function: ADCE_StopConversion adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Description: Stop ad Conversion adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Parameters: none adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Returns: FAIL/OK/INVALID adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Create & Verlog:$ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Author: Xiaojie.Zheng Date:2016-12-14 Version:V1.0 ****************************************************/ U8 ADCE_StopConversion(void) { U8 adce_res = RET_FAIL;  if (TRUE == adce_InitStatus) { ADCE0.ADHALTR.UINT32 = 0x00000001; adce_res = RET_OK; } else { adce_res = RET_FAIL; } return adce_res; }  /*=========================================================================== adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h $Log:$ * adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * adce.c adce_cfg.h adce_info.inc adce_private.h adce_public.h V1.0 Xiaojie.Zheng 2016-12-14 Initial * *===========================================================================*/
