/***************************************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h File Name : rtca.c rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description : RTCA module source file. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author: Qinhui.Shen rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Date: 2016-12-13 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "rtca_info.inc"  /*--------------- Global variable definition and initialization -----------------*/ static U8 Rtca_InitStatus = TRUE;  /*---------------------- Implementation of module ---------------------*/  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: RTCA_Init. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: RTCA Initialization. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: none rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ void RTCA_Init(void) {    rtca_ClockCfg();  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCA0 setting */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCA0CTL0 b7: Starts/stops the sub-counter RTCAnSUBC operation. 0: Stops the sub-counter operation. All output pins and all status flags in control register RTCAnCTL2 are cleared. 1: Starts the sub-counter operation. The sub-counter counts up. b6: 0-stopped status, 1-enable status. (only read). b5: 0-12 hour format, 1-24 hour format. b4: select operation mode, 0: 32.768 kHz mode, 1: Frequency selection mode. b3~0: reserve. */ RTCA0CTL0 &= 0x70; while (RTCA0CTL0 & 0x40) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr wait until sub-counter has stopped */ } #if USE_32768_CFG RTCA0CTL0 |= 0x20; //0x30 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 24 hour format, Frequency selection mode.*/ RTCA0CTL0 &= 0xEF; //0x30 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 24 hour format, Frequency selection mode.*/ #else  RTCA0CTL0 |= 0x30; //0x30 /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 24 hour format, Frequency selection mode.*/ #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCAnSCMP[21:0] :Sub-counter compare value in frequency selection mode. Sets sub-counter overflow value(RTCATCKI - 1 in Hz) = 60000Hz - 1 = 0xEA5F */  //RTCA0SCMP = 0x0000EA5F;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 12:00:00 17年2月10日星期二*/ rtca_SetValue(0x00000000, 0x17010107);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCA0 start */ RTCA0CTL0 |= 0x80u;  Rtca_InitStatus = TRUE; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: RTCA_GetInitStatus rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: get the RTCA module init status. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: none rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h FALSE(0): init failure rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h TRUE(1): init success. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ U8 RTCA_GetInitStatus(void) { return Rtca_InitStatus; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: RTCA_SetTime rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: set params to RTCA. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h ptime - the params that would be set to RTCA. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_FAIL = (0u), rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_OK, rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_INVALID, * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $log: only a 'return' ****************************************************/  static const U32 HOUR_12FORMAT[24] ={ 0x12,1,2,3,4,5,6,7,8,9,0x10,0x11, 0x32, 0x21,0x22,0x23,0x24,0x25,0x26,0x27,0x28,0x29,0x30,0x31  };   U8 RTCA_SetTime(RtcaTime_ST *ptime) { U32 time = 0; U32 Cal = 0; U32 bcdval = 0; U8 res = RET_FAIL;  if (NULL_PTR == ptime) { res = RET_INVALID; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trans "year/month/day/week" to bcd */ bcdval = rtca_Dec2BCD(ptime->year); Cal |= ((bcdval & 0xFF)<<24); bcdval = rtca_Dec2BCD(ptime->month); Cal |= ((bcdval & 0xFF)<<16); bcdval = rtca_Dec2BCD(ptime->day); Cal |= ((bcdval & 0xFF)<<8); bcdval = rtca_Dec2BCD(ptime->week); Cal |= (bcdval & 0xFF);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trans "hour/minute/seconds" to bcd */ // bcdval = 0; // time |= ((bcdval & 0xFF)<<24); bcdval = rtca_Dec2BCD(ptime->hour); time |= ((bcdval & 0xFF)<<16); bcdval = rtca_Dec2BCD(ptime->minute); time |= ((bcdval & 0xFF)<<8); bcdval = rtca_Dec2BCD(ptime->sec); time |= (bcdval & 0xFF);  rtca_StopCounter(); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr suspend counter first */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set 24 hour format/12hour format. */ if (ptime->dispFmt) { SET_BIT(RTCA0CTL0, 5); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 24 hour */ } else { CLR_BIT(RTCA0CTL0, 5); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 12 hour */ if(ptime->hour < 24){ time &= 0x0000FFFF; time |= (HOUR_12FORMAT[ptime->hour]<<16); }  } rtca_SetValue(time, Cal);/* set date and time */ rtca_RestartCounter(); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr re-active counter last */ res = RET_OK; } return res; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: RTCA_GetTime rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: get time params from RTCA. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h ptime - save the time params. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_FAIL = (0u), rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_OK, rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h RET_INVALID, * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $log: only a 'return' ****************************************************/ U8 RTCA_GetTime(RtcaTime_ST *ptime) { U32 time = 0; U32 Cal = 0; U32 bcdval = 0; U8 res = RET_FAIL;  if (NULL_PTR == ptime) { res = RET_INVALID; } else { rtca_StopCounter(); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr suspend counter first */ rtca_GetValue(&time, &Cal); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr get 24 hour format/12hour format. */ if (GET_BIT(RTCA0CTL0, 5)) { ptime->dispFmt = 0x01; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 24 hour */ } else { ptime->dispFmt = 0x00; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr 12 hour */ } rtca_RestartCounter(); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr re-active counter last */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trans "year/month/day/week" bcd to decimal */ bcdval = ((Cal>>24) & 0xFF); ptime->year = rtca_BCD2Dec(bcdval); bcdval = ((Cal>>16) & 0xFF); ptime->month = rtca_BCD2Dec(bcdval); bcdval = ((Cal>>8) & 0xFF); ptime->day = rtca_BCD2Dec(bcdval); bcdval = (Cal & 0xFF); ptime->week = rtca_BCD2Dec(bcdval);  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trans "hour/minute/seconds" bcd to decimal */ bcdval = ((time>>16) & 0xFF); ptime->hour = rtca_BCD2Dec(bcdval); //test ok hht if(ptime->dispFmt == 0){ for(Cal=0;Cal<24;Cal++){ if(bcdval == HOUR_12FORMAT[Cal]){  ptime->hour = Cal; break; } } } bcdval = ((time>>8) & 0xFF); ptime->minute = rtca_BCD2Dec(bcdval); bcdval = (time & 0xFF); ptime->sec = rtca_BCD2Dec(bcdval); res = RET_OK; } return res; }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr internal function define *************************************/ /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_ClockCfg rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: set RTCA clock. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: none rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static void rtca_ClockCfg( void ) { #if USE_32768_CFG  SYSSOSCST = 0xFFFF; /*set subosc stabilization time*/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Enable SubOsc */ protected_write(SYSPROTCMD0, SYSPROTS0, SYSSOSCE, 0x00000001U);  while (!(SYSSOSCS & 0x00000004U)) { }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTC clock domain setting = 01B: SubOsc 32.768 KHz */ protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_ARTCAS_CTL, 0x00000001U);  while (SYSCKSC_ARTCAS_ACT != 0x00000001U) { }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCATCKI = C_AWO_RTCA */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr C_AWO_RTCA clock = 011B:CGC_RTCA_CLK_DIVIDER/1 = 32.768KHz */  protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_ARTCAD_CTL, 0x00000001U);  while (SYSCKSC_ARTCAD_ACT != 0x00000001U) { } #else /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTC clock domain setting = 011B: Low Speed IntOsc fRL = 240 KHz */ protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_ARTCAS_CTL, 0x00000003U); while (SYSCKSC_ARTCAS_ACT != 0x00000003U) { }  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr RTCATCKI = C_AWO_RTCA */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr C_AWO_RTCA clock = 011B:CGC_RTCA_CLK_DIVIDER/1 = 240KHz/4=60KHz */ protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_ARTCAD_CTL, 0x00000003U); while (SYSCKSC_ARTCAD_ACT != 0x00000003U) { } #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Clock domain C_AWO_RTCA is not stopped in DEEPSTOP mode */ SYSCKSC_ARTCAD_STPM = 0x00000001U; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_SetValue rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: set time and date to RTCA. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h eg.(12:00:00 16年11月4日星期五): rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h rtca_SetValue(0x00120000, 0x16110405); rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h time - BCD format time: 0x00hhmmss. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Cal - BCD format date: 0xYYMMDDWW. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static void rtca_SetValue(U32 time, U32 Cal) { /*set hour/minute/second*/ RTCA0TIME = time; /*set year/month/day/day of week*/ RTCA0CAL = Cal; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_GetValue rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: get time and date from RTCA. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h eg.(12:00:00 16年11月4日星期五): rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h (0x00120000, 0x16110405) rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h time - get BCD format time: 0x00hhmmss. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Cal - get BCD format date: 0xYYMMDDWW. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static void rtca_GetValue(U32 *time, U32 *Cal) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr read the time counter*/ *time = RTCA0TIMEC; /*read the calendar counter*/ *Cal = RTCA0CAL; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_StopCounter rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: Stops all clock counters temporarily. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h The sub-counter is still running. rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static void rtca_StopCounter(void) { /*Restarts/stops all clock counters (RTCAnSECC to RTCAnYEARC): 0: Restarts all clock counters either immediately or immediately after the clock counter write operation finishes. 1: Stops all clock counters temporarily. The sub-counter is still running.*/ RTCA0CTL2 |= 0x01; while (0x00 == (RTCA0CTL2 & 0x02)) { /*wait the clock counters stop*/ } }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_RestartCounter rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: Restarts/stops all clock counters. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns:none * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static void rtca_RestartCounter(void) { /*Restarts/stops all clock counters (RTCAnSECC to RTCAnYEARC): 0: Restarts all clock counters either immediately or immediately after the clock counter write operation finishes. 1: Stops all clock counters temporarily. The sub-counter is still running.*/ RTCA0CTL2 &= 0xFE; }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_Dec2BCD rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: transformat the decimal value to BCD format. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h dec - decimal value. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h BCD format value * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static U32 rtca_Dec2BCD(U32 dec) { U32 k = 0; U32 Bcd = 0; U32 temp = 0;  for (k = 0; ((k < 8) && (dec != 0)); k++) { temp = dec%10; Bcd |= (temp<<(k*4)); dec /= 10; } return Bcd;  }  /*************************************************** rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Function: rtca_BCD2Dec rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Description: transformat the BCD format value to decimal value. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Parameters: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h input: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h bcd - BCD format value. * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Returns: rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h decimal value * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Create & Verlog:$ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Author:Qinhui.Shen Date:2016-12-13 Version:V1.0 ****************************************************/ static U32 rtca_BCD2Dec(U32 bcd) { U32 k = 0; U32 dec = 0; U32 weight = 1;  for (k = 0; ((k < 8) && (bcd != 0)); k++) { dec += (bcd & 0x0F)*weight; weight *= 10; bcd >>= 4; } return dec; }   /*----------------- End of Module -----------------*/  /*=========================================================================== rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h $Log:$ * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * rtca.c rtca_cfg.h rtca_info.inc rtca_private.h rtca_public.h V1.0 Qinhui.Shen 2016-12-13 Initial * *===========================================================================*/
