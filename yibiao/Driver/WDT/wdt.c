/***************************************************************************** wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h File Name : wdt.c wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Description : WDT configuration. wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Author: Qinhui.Shen wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Date: 2016-12-13 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "wdt_info.inc"  /*--------------- Global variable definition and initialization -----------------*/ static U8 Wdt_Status = FALSE;  /*---------------------- Implementation of module ---------------------*/  /*************************************************** wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Function: Clock_Init. wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Description: Clock Initialization. wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Parameters: none wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Returns: none * wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h $Create & Verlog:$ wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Author:Qinhui.Shen Date:2016-10-14 Version:V1.0 ****************************************************/ void WDT_Init(void) { #if (0 == GRAPE_FBL_ENABLE) return; #endif /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Source Clock Setting for C_AWO_WDTA CKSC_AWDTAD_CTL - C_AWO_WDTA Source Clock Selection Register b31:b 2 - Reserved set to 0 b 1:b 0 AWDTADCSID - Source Clock Setting for C_AWO_WDTA 001B: Low Speed IntOsc fRL / 128 (default) 010B: Low Speed IntOsc fRL / 1 011B: Low Speed IntOsc fRL / 256 100B: Low Speed IntOsc fRL / 512 101B: Low Speed IntOsc fRL / 1024 110B: Low Speed IntOsc fRL / 2048 */ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set WDTA clock to LS IntOsc fRL (240 kHz) / 128 = 1875Hz */ //protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_AWDTA0D_CTL, 0x00000001UL); //while ( 0x00000001UL != SYSCKSC_AWDTA0D_ACT) //{ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Waiting for CKSC_AWDTA0D_CTL to set. */ //}  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set a mode of WDT WDTAnMD - WDTA Mode Register b7 - Reserved set to 0 b6:b4 WDTAnOVF - Selects the overflow interval time - 000: 512 / WDTATCKI WDTATCKI = fRL(240 kHz) / 128 = 1875Hz overflow = 512 / WDTATCKI = 273ms b3 WDTAnWIE - Enables/disables the 75% interrupt request INTWDTAn. - 1: INTWDTAn enabled b2 WDTAnERM - Specifies the error mode. - 1: Reset mode b1:b0 WDTAnWS - Selects the window-open period. - 11: 100% */ //WDTA0MD = 0x7F; //WDTA1MD = 0x7F; //protected_write(SYSPROTCMD0, SYSPROTS0, SYSCKSC_AWDTA0D_CTL, 0x00000001UL); //SCDS0.OPBT0.UINT32 =0X8F87;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set interrupt flags */ INTC1EIC1 = 0x0047;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr write the active code set WDTA1 start*/  WDTA1WDTE = 0xAC;  Wdt_Status = TRUE; }  /*************************************************** wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Function: WDT_GetInitStatus wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Description: get the WDT module init status. wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Parameters: none wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Returns: wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h FALSE(0): init failure wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h TRUE(1): init success. * wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h $Create & Verlog:$ wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Author:Qinhui.Shen Date:2016-10-14 Version:V1.0 ****************************************************/ U8 WDT_GetInitStatus(void) { return Wdt_Status; }   /*************************************************** wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Function: WDT_Feed wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Description: feed watch dog timer. wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Parameters: none wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Returns:none wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h $Create & Verlog:$ wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Author:Qinhui.Shen Date:2016-10-14 Version:V1.0 ****************************************************/ void WDT_Feed(void) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Writing an variable activation code generates the WDTA trigger and starts/restarts the WDTAn counting. WDTAnEVAC - WDTA Enable VAC Register b7:b0 WDTAnEVAC - Control the start / restart of the WDTAn count. */  WDTA1WDTE = 0xAC;  }    /*----------------- End of Module -----------------*/  /*=========================================================================== wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h $Log:$ * wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * wdt.c wdt_cfg.h wdt_info.inc wdt_private.h wdt_public.h V1.0 Qinhui.Shen 2016-12-13 Initial * *===========================================================================*/
