/***************************************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h File Name : rstc.c rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description : RSTC module source file. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author: Qinhui.Shen rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Date: 2016-12-14 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "rstc_info.inc"  /*--------------- Global variable definition and initialization -----------------*/ static U8 Rstc_InitStatus = FALSE;  /*---------------------- Implementation of module ---------------------*/  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_Init. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: RSTC Initialization. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Parameters: none rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns: none * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ void RSTC_Init(void) { Rstc_InitStatus = TRUE; }  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_GetInitStatus rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: get the RSTC module init status. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Parameters: none rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h FALSE(0): init failure rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h TRUE(1): init success. * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ U8 RSTC_GetInitStatus(void) { return Rstc_InitStatus; }  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_GetRstFlag rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: read the RESF (reset factor register). rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Parameters: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h output: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h flag - get the value of RESF. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_FAIL = (0u), rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_OK, rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_INVALID, * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $log: only a 'return' ****************************************************/ U8 RSTC_GetRstFlag(PU32 flag) { U32 MasterVal = 0; U32 RedundantVal = 0; U8 res = RET_FAIL;  if (NULL_PTR == flag) { res = RET_INVALID; } else { MasterVal = SYSRESF; RedundantVal = SYSRESFR; *flag = (MasterVal | RedundantVal); res = RET_OK; } return res; }  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_ClrRstFlag rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: clear the RESF (reset factor register). rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Parameters: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Input: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h flag - specify the flag want to clear. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h NOTE: if FLAG_RSTC_ALL, then clear all. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_FAIL = (0u), rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_OK, rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_INVALID, * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $log: only a 'return' ****************************************************/ U8 RSTC_ClrRstFlag(RstcResetFlag_ENUM flag) { U8 res = RET_FAIL;  if (TRUE == Rstc_InitStatus) { res = RET_FAIL; } else if (FLAG_RSTC_ALL < flag) { res = RET_INVALID; } else { if (FLAG_RSTC_ALL == flag) { SYSRESFC = RSTC_RESF_MASK; SYSRESFCR = RSTC_RESF_MASK; } else { SET_BIT(SYSRESFC, flag); SET_BIT(SYSRESFCR, flag); } res = RET_OK; } return res; }  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_SoftwareReset rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: generate a software reset SWRES rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Parameters:none rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns:none * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ void RSTC_SoftwareReset(void) { protected_write(SYSPROTCMD0, SYSPROTS0, SYSSWRESA, 0x01u); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trigger enable (protected write) */ }  /*************************************************** rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Function: RSTC_ModuleReset rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Description: generate separate resets for various modules rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Input: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h module - specify the module want to reset. rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Returns: rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_FAIL = (0u), rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_OK, rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h RET_INVALID, rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Create & Verlog:$ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $log: only a 'return' ****************************************************/ U8 RSTC_ModuleReset(RstcModuleRst_ENUM module, U8 IsInactive) { U32 val = 0; U8 res = RET_FAIL;  if (TRUE == Rstc_InitStatus) { res = RET_FAIL; } else if (MRES_RSTC_ALL < module) { res = RET_INVALID; } else { if (MRES_RSTC_ALL == module) { if (IsInactive) { val = 0x00003FFF; } else { val = 0x00000000; } } else { val = SYSMRSTC; if (IsInactive) { SET_BIT(val, module); } else { CLR_BIT(val, module); } } protected_write(SYSPROTCMDMRST, SYSPROTSMRST, SYSMRSTC, val); /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr trigger enable (protected write) */ res = RET_OK; } return res; }  /*----------------- End of Module -----------------*/  /*=========================================================================== rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h $Log:$ * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * rstc.c rstc_cfg.h rstc_info.inc rstc_private.h rstc_public.h V1.0 Qinhui.Shen 2016-12-14 Initial * *===========================================================================*/
