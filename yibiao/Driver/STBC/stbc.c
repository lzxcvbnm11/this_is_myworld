/***************************************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h File Name : stbc.c stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description : STBC module source file. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author: Qinhui.Shen stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Date: 2016-12-14 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "stbc_info.inc"  /*--------------- Global variable definition and initialization -----------------*/ static U8 Stbc_InitStatus = FALSE; static U8 Stbc_IsFirstCfg = FALSE; static U32 Stbc_SourceMask; static StbcWakeUpSource_ENUM source = 0; /*---------------------- Implementation of module ---------------------*/  /*************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Function: STBC_Init. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description: STBC Initialization. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Parameters: none stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Returns: none * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Create & Verlog:$ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ void STBC_Init(void) {   Stbc_IsFirstCfg = FALSE;  FCLA0CTL6 = 0x00; FCLA0CTL7 = 0x00; FCLA1CTL1 = 0x00; SYSWUFMSK0 = 0xFFFFFFFFUL; SYSWUFC0 = 0xFFFFFFFFUL; protected_write(SYSPROTCMD0, SYSPROTS0, SYSIOHOLD, 0x0000);  Stbc_InitStatus = TRUE; }  /*************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Function: STBC_GetInitStatus stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description: get the STBC module init status. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Parameters: none stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Returns: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h FALSE(0): init failure stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h TRUE(1): init success. * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Create & Verlog:$ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ U8 STBC_GetInitStatus(void) { return Stbc_InitStatus; }  /*************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Function: STBC_EnterDeepStop stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description: enter DEEPSTOP mode. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Parameters:none stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Returns:none * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Create & Verlog:$ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ void STBC_EnterDeepStop(void) { U8 res;  PWM_Control(CMD_PWM_STOP, CH_PWMM_TFT); PWM_Control(CMD_PWM_STOP, CH_PWMM_PANEL); PWM_Control(CMD_PWM_STOP, CH_PWMM_POINTER); PWM_Control(CMD_PWM_STOP, CH_PWMM_INDICATOR);  DIO_SetIOSts(INDEX_DIO_PIN16, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN10, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN86, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN87, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN88, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN89, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN90, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN92, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN142, STATUS_IOM_HIGH, &res); DIO_SetIOSts(INDEX_DIO_PIN79, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN80, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN81, STATUS_IOM_LOW, &res); DIO_SetIOSts(INDEX_DIO_PIN82, STATUS_IOM_LOW, &res);  R_BSP_GFX_TFT_PortStb_Init();  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr set the IO buffer used to hold state*/ protected_write(SYSPROTCMD0, SYSPROTS0, SYSIOHOLD, 0x007E);  SET_BIT(PORT_AWOPFCE0, 0); SET_BIT(PORT_AWOPFC0, 0); SET_BIT(PORT_AWOPM0,0); SET_BIT(PORT_AWOPMC0, 0); CLR_BIT(PORT_AWOPIBC0, 0); CLR_BIT(PORT_AWOPIPC0, 0);  SET_BIT(PORT_AWOPFCE0, 5); SET_BIT(PORT_AWOPFC0, 5); SET_BIT(PORT_AWOPM0,5); SET_BIT(PORT_AWOPMC0, 5);  CLR_BIT(PORT_AWOPFCE0, 7); CLR_BIT(PORT_AWOPFC0, 7);  SET_BIT(PORT_AWOPM0,7); SET_BIT(PORT_AWOPMC0, 7);  FCLA0CTL6 = 0x04; FCLA0CTL7 = 0x02; FCLA1CTL1 = 0x02;    INTC1EIC11 = 0x004F;   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Set interrupt flags */ INTC1EIC11 &= 0xEF7F;   /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Clear all the wakeup factor WUFC0 - Wake-Up Factor Registers b31:b0 WUFy - Indicates the generation of a wake-up event. */ SYSWUFC0 = 0xFFFFFFFFUL;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Masked the interrupt of the unused wakeup factor, and Unmasked the interrupt of the wakeup factor. WUFMSK0 - Wake-Up Factor Mask Registers b31:b0 WUFMSKy - Enables/disables a wake-up event. */ SYSWUFMSK0 = 0xFFFFFB3FUL;// Stbc_SourceMask; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr mask/unmask wakeup factor. */  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr PLL unused in this sample, so do not need the processes below*/    /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr clear RESF and RESFR*/ SYSRESFC = SYSRESF; SYSRESFCR = SYSRESFR;  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Shift to DEEPSTOP mode STBC0PSC - Power Save Control Register b31:b2 - Reserved set to 0 b 1 STBC0DISTRG - DEEPSTOP mode is entered. Set to 1 b 0 - Reserved set to 0 */  ADCE0.ADHALTR.UINT32 = 0x00000001UL;  protected_write(SYSPROTCMD0, SYSPROTS0, SYSSTBC0PSC, 0x00000002); while (SYSSTBC0PSC != 0x00000002 ) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Waiting for shift to DEEPSTOP mode. */ }  while (1) { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Waiting for shift to DEEPSTOP mode. */ } }  /*************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Function: STBC_WakeupType stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description: get the wake-up source type. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Parameters:none stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Returns: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h wake-up source type(StbcWakeUpSource_ENUM), stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h if none then return INDEX_STBC_WKPSOURCE_ALL. * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Create & Verlog:$ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 ****************************************************/ StbcWakeUpSource_ENUM STBC_WakeupType(void) { U32 val = 0; U8 k = 0; StbcWakeUpSource_ENUM retval = INDEX_STBC_WKPSOURCE_ALL;  val = (SYSWUF0 & (~SYSWUFMSK0));  for (k = 0; k < INDEX_STBC_WKPSOURCE_ALL; k++) { if (GET_BIT(val, k)) { retval = (StbcWakeUpSource_ENUM)k; break; } else { /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Do Nothing. */ } } source = retval; return retval; }   /*************************************************** stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Function: STBC_WakeUpChannel stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Description: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Parameters: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h input: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h index - specify which wake-up source will unmask. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h NOTE: if INDEX_STBC_WKPSOURCE_ALL, then unmask all. stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Returns: stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h RET_FAIL = (0u), stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h RET_OK, stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h RET_INVALID, * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Create & Verlog:$ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-14 Version:V1.0 stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Author:Qinhui.Shen Date:2016-12-18 Version:V1.1 stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $log: only a 'return' ****************************************************/ U8 STBC_WakeUpChannel(StbcWakeUpSource_ENUM index) { U8 retVal = RET_OK;  if (FALSE == Stbc_InitStatus) { retVal = RET_FAIL; } else if (INDEX_STBC_WKPSOURCE_ALL < index) { retVal = RET_INVALID; } else if (INDEX_STBC_WKPSOURCE_ALL == index) { Stbc_IsFirstCfg = TRUE; Stbc_SourceMask = STBC_UNMASK_ALL; } else { if (FALSE == Stbc_IsFirstCfg) { Stbc_IsFirstCfg = TRUE; Stbc_SourceMask = 0xFFFFFFFFUL; CLR_BIT(Stbc_SourceMask, index); } else { CLR_BIT(Stbc_SourceMask, index); } }  return retVal; }   StbcWakeUpSource_ENUM STBC_GetWakeUpType(void) { return source; } /*----------------- End of Module -----------------*/  /*=========================================================================== stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h $Log:$ * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * stbc.c stbc_cfg.h stbc_info.inc stbc_private.h stbc_public.h V1.0 Qinhui.Shen 2016-12-14 Initial * *===========================================================================*/
