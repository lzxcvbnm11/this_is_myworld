/***************************************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h File Name : bpm.c bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description :the bpm module. bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author: Xueping.Chen bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Date: 2016-11-30 ******************************************************************************/ /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "r_typedefs.h" #include "r_dev_pin_types.h" #include "bpm_info.inc" #include "R_tick_api.h" static BOOL bpm_InitStatus = FALSE; static U32 bpm_ListIndex = 0; static BpmInfo_ST bpm_WarnInfo; static BOOL bpm_WarnWorkStatus = FALSE; static BpmPrm_ST g_pPrmList[8]; static BpmTC_ST bpm_TcPrm; static U16 timecnt = 0;  /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: BPM_Init bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: the initializing of the bpm module bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2016-11-30 Version:V1.0 ****************************************************/ void BPM_Init(void) { U8 res; bpm_InitStatus = (DIO_GetInitStatus() && TAUB_GetInitStatus() /*&& OSTM_GetInitStatus()*/); /*initializing the variable */ memset(&g_pPrmList,0,sizeof(g_pPrmList)); bpm_WarnInfo.pPrmList = &g_pPrmList;//NULL_PTR; bpm_WarnInfo.PrmList_size = 0; bpm_WarnInfo.OutCircle = 0; bpm_WarnInfo.OutEnable = FALSE; bpm_WarnInfo.Reserve = 0; bpm_TcPrm.HighTime = 0; bpm_TcPrm.CycleTime = 0; bpm_TcPrm.Dcnt_Max = 0; bpm_TcPrm.cnt = 0; bpm_TcPrm.IsHigh = 0; bpm_TcPrm.Reserve = 0; }  /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: BPM_Process_10ms bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: the process of the bpm module bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2016-11-30 Version:V1.0 ****************************************************/ void BPM_Process_10ms(void) {  }  /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: bpm_Handle bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: the handler of the bmp bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2017-01-02 Version:V1.0 ****************************************************/ void BPM_Handle(void) { U8 res =0;  if (++timecnt >= bpm_TcPrm.Dcnt_Max) { timecnt = 0;  if (bpm_ListIndex >= bpm_WarnInfo.PrmList_size) { bpm_WarnWorkStatus =FALSE; } else { DIO_SetIOSts(INDEX_POWER_BUZZER,bpm_WarnInfo.pPrmList[bpm_ListIndex].PwrLevel, &res); bpm_Trans(&(bpm_WarnInfo.pPrmList[bpm_ListIndex]), &bpm_TcPrm); bpm_ListIndex++; }  } else { } }   /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: bpm_Trans bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: Information conversion, depending on the type of BpmPrm_ST coexist to BpmTC_ST type variable bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: *pinfo : input reference the BpmPrm_ST *pTC : output reference the BpmTC_ST bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: TRUE or FALSE bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2016-11-30 Version:V1.0 ****************************************************/ static U8 bpm_Trans(BpmPrm_ST *pinfo, BpmTC_ST *pTC) { U8 res = RET_FAIL;  if (FALSE == bpm_InitStatus) { res = RET_FAIL; } else if ((NULL_PTR == pinfo) || (NULL_PTR == pTC)) { res = RET_INVALID; } else { pTC->HighTime =6163*pinfo->Duty/pinfo->Frequency; pTC->Dcnt_Max = pinfo->Duration;  if(pinfo->Frequency == 0) { pTC->CycleTime = 0; } else { pTC->CycleTime = 616300 / pinfo->Frequency; }  if (0 !=pTC->CycleTime && 0 !=pTC->HighTime) { TAUB_SetParam(TYPE_TAUB_2, pTC->CycleTime,pTC->HighTime); TAUB_Start(TYPE_TAUB_2); } else { TAUB_Stop(TYPE_TAUB_2); }  res = RET_OK; } return res; }  /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: BPM_GetInitStatus bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: get the status of the bpm initializing bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: none bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: TRUE or FALSE bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2016-11-30 Version:V1.0 ****************************************************/ BOOL BPM_GetInitStatus(void) { return bpm_InitStatus; }   /*************************************************** bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Function: BPM_SetWarnInfo bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Description: get the warning infomation for the bpm bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Parameters: *pStInfor : input reference the BpmInfo_ST bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Returns: TRUE or FALSE bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Create & Verlog:$ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Author:Xueping.Chen Date:2016-11-30 Version:V1.0 ****************************************************/ U8 BPM_SetWarnInfo(BpmInfo_ST *pStInfor) { U8 res = RET_FAIL;  if (FALSE == bpm_InitStatus) { res = RET_FAIL; } else if (NULL_PTR == pStInfor) { res = RET_INVALID; } else { bpm_WarnInfo = *pStInfor;  bpm_WarnWorkStatus =TRUE;  bpm_ListIndex =0;  timecnt =0xffff;  res = RET_OK; }  return res; }    BOOL BPM_GetWorkStatus(void) { return bpm_WarnWorkStatus; }  U32 BPM_GetOutCircleValue(void) { return bpm_WarnInfo.OutCircle; } /*=========================================================================== bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h $Log:$ * bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * bpm.c bpm_cfg.h bpm_info.inc bpm_private.h bpm_public.h V1.0 Xueping.Chen 2016-11-30 Initial * *===========================================================================*/
