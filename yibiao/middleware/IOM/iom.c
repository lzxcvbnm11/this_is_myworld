/***************************************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h File Name : iom.c iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description : IOM module middleware iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author: Xueping.Chen iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Date: 2016-11-23 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "iom_info.inc"   static IomDebounceData_ST iom_value[INDEX_IOINTPUT_ALL]; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IOM值*/ static BOOL iom_InitStatus = FALSE; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr IOM初始化状态，默认值为FALSE */   /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function: IOM_Init iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: IOM module initialized iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: none iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: none iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ void IOM_Init(void) { U8 i = 0; iom_InitStatus = DIO_GetInitStatus();  for (i = 0; i < INDEX_IOINTPUT_ALL; i++) { iom_value[i].value = STATUS_IOM_LOW; iom_value[i].debounce = STATUS_IOM_LOW; iom_value[i].res = RET_FAIL; iom_value[i].cnt = 0; }/*end of for()*/  }  /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function: IOM_Process_100ms iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: the process of the IOM module iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: none iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: none iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ void IOM_Process_100ms(void) { IomInPut_ENUM i = INDEX_IOINTPUT_WINTERMODE;  if (TRUE == iom_InitStatus) { for (i = INDEX_IOINTPUT_WINTERMODE; i < INDEX_IOINTPUT_ALL; i++) { iom_InputDebounce(i); }/*end of for()*/ } else { } }  /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function: iom_InputDebounce iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: the debounce of the input IO port iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: input: index the index of the input IO port iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: return value reference IomRes_ENUM iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ static U8 iom_InputDebounce(IomInPut_ENUM index) { U8 value = 0; U8 status = RET_FAIL; U8 res = RET_FAIL;  status = DIO_GetIOSts(index, &value);  if(INDEX_IOINTPUT_ALL <= index) { res = RET_INVALID; } else if (RET_OK == status) { if (iom_value[index].value == value) { if (iom_value[index].cnt >= IOM_DEBOUNCE_MAXCNT) { iom_value[index].cnt = 0; iom_value[index].value = value; iom_value[index].debounce = iom_value[index].value; iom_value[index].res = RET_OK; } else { iom_value[index].cnt++; } } else { iom_value[index].cnt = 0; iom_value[index].value = value; iom_value[index].res = RET_FAIL; }  res = iom_value[index].res ; }/*end of if()*/ else { }  return res; }  /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function: IOM_SetOutPutLevel iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: set the level of IO port iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: input：Index the index of the ouput IO port，reference the IomInPut_ENUM input: value the level of the output IO port IOM_STATUS_HIGH : High Level IOM_STATUS_LOW : Low Level iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: return value reference IomRes_ENUM iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ U8 IOM_SetOutPutLevel(IomOutPut_ENUM index, U8 value) { U8 status = FALSE; U8 ret = 0; U8 res = RET_FAIL;  status = DIO_SetIOSts(Iom_Matrix[index + INDEX_IOINTPUT_ALL].ch, value, &ret);  if(FALSE == iom_InitStatus) { res = RET_FAIL; } else if ((ret == value) && (TRUE == status)) { res = RET_OK; } else { res = RET_FAIL; }  return res;  }  /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function:IOM_GetInputLevel iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: get the status of the input IO after debounce iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: input：Index the index of the input IO port，reference the IomInPut_ENUM output：pRes the level of the input IO port after debounce IOM_STATUS_HIGH : High Level IOM_STATUS_LOW :Low Level pRes : iom_value[n].debounce;(reference IomInPut_ENUM) iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: return value reference IomRes_ENUM iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ U8 IOM_GetInputLevel(IomInPut_ENUM index, PU8 pRes) { U8 res = RET_OK;  if (FALSE == iom_InitStatus) { res = RET_FAIL; } else if((NULL_PTR == pRes) || (INDEX_IOINTPUT_ALL <= index)) { res = RET_INVALID; } else { *pRes = iom_value[index].value; }  return res; }  /*************************************************** iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Function: IOM_GetModuleStatus iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Description: get the IOM module initialized status iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Parameters: none iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Returns: TRUE or FALSE iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Create & Verlog:$ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Author:Xueping.Chen Date:2016-11-24 Version:V1.0 ****************************************************/ BOOL IOM_GetModuleStatus(void) { return iom_InitStatus; }  /*=========================================================================== iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h $Log:$ * iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * iom.c iom_cfg.h iom_info.inc iom_private.h iom_public.h V1.0 Xueping.Chen 2016-11-24 Initial * *===========================================================================*/
