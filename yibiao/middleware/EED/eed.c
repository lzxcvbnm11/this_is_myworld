/***************************************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h File Name : eed.c eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description : EED module middleware eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author: Xuenian.Feng eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Date: 2016-11-29 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "eed_info.inc"   static BOOL eed_InitStatus = FALSE; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr EED3?¨º??¡¥¡Á¡ä¨¬?,??¨¨??¦Ì?aFALSE*/ static U8 eed_Config[256] = {0}; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr EED2?¨ºy????*/ //3  static U8 eed_Function[112] = {0}; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr EED1|?¨¹????*/ static EedWorkStatus_ENUM eed_Workstatus = STATUS_EED_UNKNOWN; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr EED1¡è¡Á¡Â¡Á¡ä¨¬???¨¨??aSTATUS_EED_UNKNOWN*/  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_Init eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: EED module initialized eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ void EED_Init(void) { if (RET_OK== DSPI_GetInitStatus(HANDLE_DSPI_EEP)) { eed_InitStatus = TRUE; eed_Workstatus = STATUS_EED_IDLE; } else { eed_InitStatus = FALSE; eed_Workstatus = STATUS_EED_UNKNOWN; } }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_GetInitStatus eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: get the EED module initialized status eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: TRUE: eed have initialed already FALSE:eed not initialed eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ BOOL EED_GetInitStatus(void) { return eed_InitStatus; }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_GetEEPROMStatus eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: Read the current work status of EED module eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters:  input: status the current work status of EED modle eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: TRUE or FALSE eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_GetEEPROMStatus(PU8 status) { U8 res = RET_OK;  if (RET_FAIL == eed_InitStatus)  { res = RET_FAIL; } else if (NULL_PTR == status) { res = RET_INVALID; } else { *status =(U8)eed_Workstatus; }  return res; }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_WriteByte eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: Write a byte for EED eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h address: input, the data address to write into the EEPROM eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h data: input, the value to write into the EEPROM eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: TRUE:write operation success FALSE:write operation fail  eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-12-05 Version:V1.1 eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_WriteByte(U32 address, U8 data) { U8 res = FALSE; U32 cmd[EED_ADDR_CMD_LEN]; U16 size = 0;  if (FALSE == eed_InitStatus) { return res; } else { }  eed_Workstatus = STATUS_EED_WRITEING; res = DSPI_SPIStart(HANDLE_DSPI_EEP); cmd[0] = DSPI_EED_CMD_WREN; res = DSPI_WriteByte(HANDLE_DSPI_EEP, cmd[0]); res = DSPI_SPIStop(HANDLE_DSPI_EEP); res = DSPI_SPIStart(HANDLE_DSPI_EEP);  if (TRUE == res) { /*write one Byte */ cmd[0] = DSPI_EED_CMD_WRITE; cmd[1] = ((address >> 8) & 0xFF); cmd[2] = (address & 0xFF); res = DSPI_WriteBytes(HANDLE_DSPI_EEP, cmd, EED_ADDR_CMD_LEN); res = DSPI_WriteByte(HANDLE_DSPI_EEP, data); res = DSPI_SPIStop(HANDLE_DSPI_EEP);  /*Read Write status*/ /*delay_ms(1);*/ res = DSPI_SPIStart(HANDLE_DSPI_EEP); cmd[0] = DSPI_EED_CMD_RDSR; res = DSPI_WriteByte(HANDLE_DSPI_EEP,cmd[0]);  size = EED_WAIT_RDWT_CNT;  while (size--) { cmd[0] = 0xFF; res = DSPI_ReadByte(HANDLE_DSPI_EEP,cmd); if ((cmd[0] & 0x01) == 0) { eed_Workstatus = STATUS_EED_IDLE; break; } else { eed_Workstatus = STATUS_EED_ERR; }  }/*delay_ms(1);*/  res =DSPI_SPIStop(HANDLE_DSPI_EEP); } else { } return res; }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_WriteBytes eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: Write bytes for EED eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h address: the beginning address of data eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h data: the data which will write into the eeprom eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h size: the byte len of data eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h TRUE:write success eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h FALSE:write fail eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_WriteBytes(U32 address, const PU8 data, U16 size) { U8 res = RET_FAIL; U8 cmd[EED_ADDR_CMD_LEN];  if (FALSE == eed_InitStatus) { return res; } else { }  eed_Workstatus = STATUS_EED_ERR;  cmd[0] = DSPI_EED_CMD_WREN; res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteByte(HANDLE_DSPI_EEP, cmd[0]); res = DSPI_SPIStop(HANDLE_DSPI_EEP);  if (TRUE == res) { /*write Bytes */ cmd[0] = DSPI_EED_CMD_WRITE; cmd[1] = ((address >> 8) & 0xFF); cmd[2] = (address & 0xFF); res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteBytes(HANDLE_DSPI_EEP, cmd, EED_ADDR_CMD_LEN); res = DSPI_WriteBytes(HANDLE_DSPI_EEP, data, size); res = DSPI_SPIStop(HANDLE_DSPI_EEP);  /*Read Write status*/ cmd[0] = DSPI_EED_CMD_RDSR; res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteByte(HANDLE_DSPI_EEP,cmd[0]);   size = EED_WAIT_RDWT_CNT;  while (size--) { WDT_Feed();  res = DSPI_ReadByte(HANDLE_DSPI_EEP,cmd);  if ((cmd[0] & 0x01) == 0) { if (STATUS_EED_WRITEING ==eed_Workstatus) { eed_Workstatus = STATUS_EED_IDLE; } else { } break; } else { eed_Workstatus = STATUS_EED_WRITEING; } }  res = DSPI_SPIStop(HANDLE_DSPI_EEP); }  return res; }    /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_ReadByte eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: Read a byte for EED eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h address: the beginning address of the reading data eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h data: stored the reading data from eeprom eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h TRUE:read success eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h FALSE:read fail eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_ReadByte(U32 address, PU8 data) { U8 res = TRUE; U8 cmd[EED_ADDR_CMD_LEN]; U16 size = 0;  if (FALSE == eed_InitStatus) { return FALSE; } else { }  eed_Workstatus = STATUS_EED_READING; if (TRUE == res) { /*read one byte */ cmd[0] = DSPI_EED_CMD_READ; cmd[1] = ((address >> 8) & 0xFF); cmd[2] = (address & 0xFF); res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteBytes(HANDLE_DSPI_EEP, cmd, EED_ADDR_CMD_LEN); res = DSPI_ReadByte(HANDLE_DSPI_EEP, data); res = DSPI_SPIStop(HANDLE_DSPI_EEP);  /*Read EED Read status*/ /*delay_ms(1);*/ cmd[0] = DSPI_EED_CMD_RDSR; res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteByte(HANDLE_DSPI_EEP,cmd[0]);   size = EED_WAIT_RDWT_CNT; while (size--) { WDT_Feed(); res = DSPI_ReadByte(HANDLE_DSPI_EEP,cmd); if ((cmd[0] & 0x01) == 0) { eed_Workstatus = STATUS_EED_IDLE; break; } else { eed_Workstatus = STATUS_EED_ERR; } /*delay_ms(1);*/ } res = DSPI_SPIStop(HANDLE_DSPI_EEP); } else { }  return res; }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_ReadBytes eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: Read a byte for EED eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h address: the beginning address of the reading data eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h data: stored the reading data from eeprom eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h size: tell the reading byte len of data eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h TRUE:read success eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h FALSE:read fail eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_ReadBytes (U32 address, const PU8 data, U16 size) { U8 res = TRUE; U8 cmd[EED_ADDR_CMD_LEN];  if (FALSE == eed_InitStatus) { return FALSE; } else { }  eed_Workstatus = STATUS_EED_READING; if (TRUE == res) { cmd[0] = DSPI_EED_CMD_READ; cmd[1] = ((address >> 8) & 0xFF); cmd[2] = (address & 0xFF); res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteBytes(HANDLE_DSPI_EEP, cmd, EED_ADDR_CMD_LEN); res = DSPI_ReadBytes(HANDLE_DSPI_EEP, data, size); res = DSPI_SPIStop(HANDLE_DSPI_EEP);  /*Read Write status*/ /*delay_ms(1);*/ cmd[0] = DSPI_EED_CMD_RDSR; res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteByte(HANDLE_DSPI_EEP,cmd[0]);   size = EED_WAIT_RDWT_CNT; while (size--) { WDT_Feed(); res = DSPI_ReadByte(HANDLE_DSPI_EEP,cmd); if ((cmd[0] & 0x01) == 0) { eed_Workstatus = STATUS_EED_IDLE; break; } else { eed_Workstatus = STATUS_EED_ERR; } /*delay_ms(1);*/ }  res = DSPI_SPIStop(HANDLE_DSPI_EEP);  } else { }  return res; }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_RelieveProtectBlock eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: RelieveProtectBlock V2 eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters:none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns: TRUE:write operation success FALSE:write operation fail eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-12-05 Version:V1.1 eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ U8 EED_RelieveProtectBlock(void) { U8 res = FALSE; U8 cmd[EED_ADDR_CMD_LEN]; U16 size = 0;  if (FALSE == eed_InitStatus) { return res; } else { }  cmd[0] = DSPI_EED_CMD_WRSR; res = DSPI_SPIStart(HANDLE_DSPI_EEP); res = DSPI_WriteByte(HANDLE_DSPI_EEP, cmd[0]); res = DSPI_WriteByte(HANDLE_DSPI_EEP, 0x80); res = DSPI_SPIStop(HANDLE_DSPI_EEP); return res; } /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_EraseAllBlock eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: EraseAllBlock eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters:none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns:none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-12-05 Version:V1.1 eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ void EED_EraseAllBlock(void) { U8 i = 0; U8 byteBufer[16] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF}; U16 address = 0;  for (i = 0; i<50; i++) { EED_WriteBytes(address, byteBufer, 16); address = address + 16; } }  /*************************************************** eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Function: EED_WriteInitData eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Description: WriteInitData eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Parameters:none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Returns:none eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Create & Verlog:$ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-12-05 Version:V1.1 eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Author:Xuenian.Feng Date:2016-11-29 Version:V1.0 ****************************************************/ void EED_WriteInitData(void) { U32 i = 0;  for (i = 0; i < 16; i++) { EED_WriteBytes(0x02D0 + i eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h 0x10, eed_Config + i eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h 0x10, 16); }  for (i = 0; i < 7; i++) { EED_WriteBytes(0x0680 + i eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h 0x10, eed_Function + i eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h 0x10, 16); } }  /*=========================================================================== eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h $Log:$ * eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * eed.c eed_cfg.h eed_info.inc eed_private.h eed_public.h V1.0 Xuenian.Feng 2016-11-29 Initial * *===========================================================================*/
