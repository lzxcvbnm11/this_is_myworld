/***************************************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h File Name : adm.c adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description : ADM module middleware adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author: Xueping.Chen adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Date: 2016-11-25 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "adm_info.inc"  static BOOL adm_InitStatus = FALSE; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ADM初始化状态，默认值为FALSE */ static U8 adm_ADCEConversionRes = RET_FAIL; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ADCE转化结果 默认值为RET_FAIL*/ static AdmGatherData_ST adm_Value[ADM_CHANNEL_MAX]; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr ADM值*/  /*************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Function: ADM_Init adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description: ADM module initialized adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Parameters: none adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Returns: none adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Create & Verlog:$ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author:Xueping.Chen Date:2016-11-25 Version:V1.0 ****************************************************/ void ADM_Init(void) { U8 i = 0;  for (i = 0; i < ADM_CHANNEL_MAX; i++) { adm_Value[i].cnt = 0; adm_Value[i].sum = 0; adm_Value[i].value = 0; adm_Value[i].debounceValue = 0;  adm_Value[i].res = RET_FAIL; }  adm_ADCEConversionRes = ADCE_StartConversion(); adm_InitStatus = ADCE_GetInitStatus();  #if 1 for( i = 0 ; i < DEBOUNCE_FUEL_COUNT; i ++) { ADM_Process_5ms(); } #endif }  /*************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Function: ADM_Process_5ms  adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description: the process of the ADM module adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Parameters: none adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Returns: none adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Create & Verlog:$ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author:Xueping.Chen Date:2016-11-25 Version:V1.0 ****************************************************/ void ADM_Process_5ms (void) { AdmChannel_ENUM index = INDEX_ADM_SRS;  if (FALSE == adm_InitStatus) { ; } else if (RET_OK == adm_ADCEConversionRes) { for (index = INDEX_ADM_SRS; index < INDEX_ADM_ALL; index++) { adm_ChannelDebounce(index); } ADCE_StartConversion(); } else  {   }  return; }  /*************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Function: adm_ChannelDebounce adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description: the debounce of ADC adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Parameters: input : the channal of ADCE adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Returns: return value reference AdmRes_ENUM adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Create & Verlog:$ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author:Xueping.Chen Date:2016-11-25 Version:V1.0 ****************************************************/ static U8 adm_ChannelDebounce(AdmChannel_ENUM index) { U16 value = 0; U16 range = 0;  U8 res = RET_OK;  if ((INDEX_ADM_ALL <= index) || (Adm_Matrix[index].ch > ADM_CHANNEL_MAX)) { res = RET_INVALID; } else {  if (RET_OK == ADCE_GetSingleValue(Adm_Matrix[index].ch, &value)) { range = ABS_SUB(value, adm_Value[Adm_Matrix[index].ch].value); if (range < Adm_Matrix[index].range) { if (adm_Value[Adm_Matrix[index].ch].cnt >= Adm_Matrix[index].debCnt) { adm_Value[Adm_Matrix[index].ch].debounceValue = (adm_Value[Adm_Matrix[index].ch].sum / Adm_Matrix[index].debCnt); adm_Value[Adm_Matrix[index].ch].sum = 0; adm_Value[Adm_Matrix[index].ch].cnt = 0; adm_Value[Adm_Matrix[index].ch].res = RET_OK; } else { adm_Value[Adm_Matrix[index].ch].sum += value; adm_Value[Adm_Matrix[index].ch].cnt++; } } else { adm_Value[Adm_Matrix[index].ch].cnt = 0; adm_Value[Adm_Matrix[index].ch].sum = 0; adm_Value[Adm_Matrix[index].ch].res = RET_FAIL; }  adm_Value[Adm_Matrix[index].ch].value = value; }/*end of ADCE_GetSingleValue(Adm_Matrix[index].ch, &value) */ else { res = RET_FAIL; } }  return res; }  /*************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Function: ADM_GetInitStatus adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description: get the ADM module initialized status adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Parameters: none adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Returns: TRUE or FALSE adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Create & Verlog:$ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author:Xueping.Chen Date:2016-11-25 Version:V1.0 ****************************************************/ BOOL ADM_GetInitStatus(void) { return adm_InitStatus; }  /*************************************************** adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Function: ADM_GetDebounceValue adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Description: Get the value of AD after debounce adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Parameters: input: Index the channel of ADC output: pRes the value of AD adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Returns: return value reference AdmRes_ENUM adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Create & Verlog:$ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Author:Xueping.Chen Date:2016-11-25 Version:V1.0 ****************************************************/ U8 ADM_GetDebounceValue(AdmChannel_ENUM index, PU16 pRes) { U8 res = RET_OK;  if (FALSE == adm_InitStatus) { res = RET_FAIL; } else if ((NULL_PTR == pRes) ||(INDEX_ADM_ALL <= index) || (Adm_Matrix[index].ch > ADM_CHANNEL_MAX)) { res = RET_INVALID; } else { *pRes = adm_Value[Adm_Matrix[index].ch].debounceValue; res = adm_Value[Adm_Matrix[index].ch].res; } return res; }  /*=========================================================================== adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h $Log:$ * adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * adm.c adm_cfg.h adm_info.inc adm_private.h adm_public.h V1.0 Xueping.Chen 2016-11-25 Initial * *===========================================================================*/
