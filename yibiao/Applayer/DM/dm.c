/************************************************************************** | Copyright |------------------------------------------------------------------------ |Copyright(c) by YEEDON MultiMedia Co.LTD. All rights reserved. | | this software if furnished under a license and may be used and copied | only in accordance with the terms of such license and with the inclusion | of he above copyright notic.This software or any other copies thereof | may not be provided of otherwise made available to any other persion. | No title to and ownership of the software is hereby transferred. | | the information in this software is subject to change without notice | and should not be construed as a commitment by | YEEDON MultiMedia Co.LTD. | | YEEDON MultiMedia Co.LTD. assumes no responsibility for the use or reliability | of its Software on equipment which is not supported by YEEDON MultiMedia Co.LTD. |-------------------------------------------------------------- **************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Files for including */ #include "dm_info.inc"  static BOOL DM_InitSts = FALSE; static BOOL insTrip1UserEnPrm; static BOOL insTrip2UserEnPrm; static U8 insTCConUnitsPrm; static BOOL insTripRollOverPrm; static BOOL insUnitsPrm; static U8 insMenuSpeedTresholdPrm; static BOOL insIFCEnPrm; static BOOL insRTEEnPrm; static U8 insTCDispTimeoutPrm; static BOOL insMenuIllumAdEnPrm; static BOOL insMenuDigCEnPrm; static BOOL insSCSOffSwitchEnPrm; static U8 insPresstime1Prm; static U8 insTCFuelDispUpdatePrm; static U8 insPrndEnPrm; static BOOL insGearShiftUpDwnWarnPrm; static BOOL insTyrePresUnitsPrm;/*not defined*/ static BOOL insTyrTemDisUntPrm;/*not defined*/  static DM_Send_PageValue_ST Dm_Send_Data; static Dm_Logo_ENUM logoCnt; static Dm_SubFuction_TC_ENUM TCSel; static U8 SetSel; static Dm_ILLU_ENUM illu_Level; static Dm_SpeedLimit_ENUM speed_Limit; static U8 SCS_Sts; static BOOL scs_cmd ; static AllPage_Index_ENUM CurPage_Point; static AllPage_Index_ENUM DestPage_Point; static WarnEventData_ST Dm_CurEvent; static U8 CurTotolFaultList; static U8 CurFaultList = 0; static U8 dm_RadioSubPage = 0; static Dm_CMD_ST dm_FunPage; static MSG_EVENT_ENUM dm_MsgIndex = INDEX_MSG_NULL; static BOOL StartLogoEn = FALSE; static Dm_SetPageData_ST dm_stSet; static U32 dm_EscCnt = 0; static U32 dm_EscMaxCnt = 0; static BOOL EnableFun = FALSE;  /************************************************** *Function :DM_Init *Description: DM Module Initial *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void DM_Init(void) { U8 Value =0 ; DM_InitSts = FALSE;  insTrip1UserEnPrm = DIAG_GetTrip1UserEn(); insTrip2UserEnPrm = DIAG_GetTrip2UserEn(); insTCConUnitsPrm = DIAG_GetTCConUnits(); insTripRollOverPrm = DIAG_GetTripRollOver(); insUnitsPrm = DIAG_GetUnits(); insMenuSpeedTresholdPrm = DIAG_GetMenuSpeedTreshold(); insIFCEnPrm = DIAG_GetIFCEn(); insRTEEnPrm = DIAG_GetRTEEn(); insTCDispTimeoutPrm = DIAG_GetTCDispTimeout(); insMenuIllumAdEnPrm = DIAG_GetMenuIllumAdEn(); insMenuDigCEnPrm = DIAG_GetMenuDigCEn(); insMenuSpeedTresholdPrm = DIAG_GetMenuSpeedTreshold(); insSCSOffSwitchEnPrm = DIAG_GetSCSOffSwitchEn(); insPresstime1Prm = DIAG_GetPresstime1(); insTCFuelDispUpdatePrm = DIAG_GetTCFuelDispUpdate(); insPrndEnPrm = DIAG_GetPrndEn(); insGearShiftUpDwnWarnPrm = DIAG_GetGearShiftUpDwnWarn(); insTyrePresUnitsPrm = DIAG_GetTyrePresUnits(); insTyrTemDisUntPrm = DIAG_GetTyrTemDisUnt(); insTCDispTimeoutPrm = DIAG_GetTCDispTimeout();  DestPage_Point = INDEX_TC_SPEED; CurPage_Point = INDEX_TC_SPEED; Value = DIAG_GetOSThresh(); if(Value < 30) Value = 0; speed_Limit = Value/5; /*INDEX_SPEEDLIMIT_OFF*/ logoCnt = INDEX_LOGO1; SetSel = 0; TCSel = SUBFUCTION_TC_SPEED; SCS_Sts = 0; scs_cmd = FALSE; CurFaultList = 0; //dm_NavDircn = INDEX_NAVI_PARKING; dm_MsgIndex = INDEX_MSG_NULL;  dm_stSet.illuEn = DIAG_GetMenuIllumAdEn(); dm_stSet.SpdLmtEn = DIAG_GetMenuSpeedTreshold(); dm_stSet.ScsEn = DIAG_GetSCSOffSwitchEn(); dm_EscMaxCnt = ((insTCDispTimeoutPrm*1000)/DM_PROCESS_PRO); dm_EscCnt = 0;  memset(&Dm_Send_Data.DATA, 0, sizeof(Dm_DATA_ST)); Dm_Send_Data.CMD.PageType = INDEX_NULL; Dm_Send_Data.CMD.MainPage = 0; Dm_Send_Data.CMD.SubPage = 0; NZM_GetDataValue(INDEX_NZM_MAINPAGE,&dm_FunPage.MainPage,1);  switch(dm_FunPage.MainPage) { case MAINFUCTION_TC: NZM_GetDataValue(INDEX_NZM_TCSUBPAGE,&TCSel,1);  if( (FALSE == DIAG_GetTrip1UserEn()) && (TCSel ==  SUBFUCTION_TC_AUTOSTART)) { TCSel ++; } else { } if( (FALSE == DIAG_GetTrip2UserEn()) && (TCSel ==  SUBFUCTION_TC_AUTORST)) { TCSel ++; } else { } dm_FunPage.SubPage = TCSel;  switch(TCSel) { case SUBFUCTION_TC_SPEED:  CurPage_Point = INDEX_TC_SPEED; DestPage_Point = INDEX_TC_SPEED; break; case SUBFUCTION_TC_INSFUELCOMP:  CurPage_Point = INDEX_TC_INSFUELCOMPN; DestPage_Point = INDEX_TC_INSFUELCOMPN; break; case SUBFUCTION_TC_RANGE:  CurPage_Point = INDEX_TC_RANG; DestPage_Point = INDEX_TC_RANG; break; case SUBFUCTION_TC_BAT:  CurPage_Point = INDEX_TC_BAT; DestPage_Point = INDEX_TC_BAT; break; case SUBFUCTION_TC_AUTOSTART:  CurPage_Point = INDEX_TC_AUTOSTART; DestPage_Point = INDEX_TC_AUTOSTART; break; case SUBFUCTION_TC_AUTORST:  CurPage_Point = INDEX_TC_AUTORST; DestPage_Point = INDEX_TC_AUTORST; break; case SUBFUCTION_TC_TIREPRESS:  CurPage_Point = INDEX_TC_TIREPRESS; DestPage_Point = INDEX_TC_TIREPRESS; break; } break; case MAINFUCTION_SET:  dm_FunPage.SubPage = SUBFUCTION_SETTING; NZM_GetDataValue(INDEX_NZM_SETINDEX,&SetSel,1);  CurPage_Point = INDEX_SET_SETTING; DestPage_Point = INDEX_SET_SETTING; break; case MAINFUCTION_ENTERTAINMENT: CurPage_Point = INDEX_ENT_MEDIA_MUSIC; DestPage_Point = INDEX_ENT_MEDIA_MUSIC; break; case MAINFUCTION_FAULT:  CurPage_Point = INDEX_FAULT_FAULTLIST; DestPage_Point = INDEX_FAULT_FAULTLIST; NZM_GetDataValue(INDEX_NZM_SETINDEX,&CurFaultList,1); if(CurFaultList%4 != 0) CurFaultList = 0; break; }   NZM_GetDataValue(INDEX_NZM_ILLULEVEL,&illu_Level,1); if (INDEX_ILLU_OFF == illu_Level) { illu_Level = INDEX_ILLU_lEVEL2; }  ILLU_SetILLULevel(CHANNEL_ILLU_TFT,illu_Level);  memcpy(&Dm_Send_Data, &dm_FunPage,sizeof(Dm_DATA_ST)); EnableFun = FALSE; DM_InitSts = TRUE; }   /************************************************** *Function :DM_Process_50ms *Description: DM Module Process *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void DM_Process_50ms(void) { U8 res; U8 chkstatus; static Dm_CMD_ST cmd; U8 update = 0;  dm_AdjustSpeedThsHold_100ms(); dm_Get_Eninfotainment_SubPage(); if( TRUE == DIAG_GetMenuIllumAdEn()) { dm_stSet.illuEn = ILLU_GetMenuEnable(); } else { dm_stSet.illuEn = FALSE; } res =PWR_GetChkStatus(&chkstatus); switch(chkstatus) { case STATUS_SLFCHK_NOT_READY: StartLogoEn = FALSE;  EnableFun = FALSE; logoCnt = 0; break; case STATUS_SLFCHK_ING: StartLogoEn = TRUE;  EnableFun = FALSE; if(LOGO_TABLE_CNT > logoCnt) { logoCnt++; } break; case STATUS_SLFCHK_FINISH: StartLogoEn = FALSE; EnableFun = TRUE;  logoCnt = 0; break; }  dm_Get_DestPage_Process(); if(0 != memcpy(&cmd,&Dm_Send_Data.CMD,sizeof(Dm_CMD_ST))) { update = TRUE; } else { update = FALSE; } dm_Get_DestData_Process(update);  update = FALSE; cmd = Dm_Send_Data.CMD;  }  /************************************************** *Function :dm_AdjustSpeedThsHold_100ms *Description: DM Module Process *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_AdjustSpeedThsHold_100ms(void) { U16 Value; BOOL Enable;  COM_GetSignalValue_BOOL(INDEX_COM_RS_FICMOVERSPDTHRSHLDADJTRA,&Enable); COM_GetSignalValue_16(INDEX_COM_RS_FICMOVERSPDTHRSHLDADJ,&Value); if(FALSE != Enable) { if(Value > SPEED_THRESHHOLD_MAX) { Value = SPEED_THRESHHOLD_MAX; } else { } DIAG_SetOSThresh((U8)Value); if(Value < 30)  { Value = 0; } else { } speed_Limit = Value/5; } else { } }  /************************************************** *Function :dm_SetMenu_AutoExist *Description: DM Module Process *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void dm_SetMenu_AutoExist(void) {  U8 Value =0 ;  if((INDEX_FUNCTION== Dm_Send_Data.CMD.PageType) && (MAINFUCTION_SET == Dm_Send_Data.CMD.MainPage) ) { switch(Dm_Send_Data.CMD.SubPage) { case SUBFUCTION_SET_ILLU: dm_EscCnt ++; if((dm_EscMaxCnt <= dm_EscCnt) || (FALSE == dm_stSet.illuEn)) { dm_EscCnt = 0;  DestPage_Point = INDEX_SET_SETTING;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = MAINFUCTION_SET;  CurPage_Point = DestPage_Point;  } else { }   break; case SUBFUCTION_SET_SPEEDLIMIT: dm_EscCnt ++; if(dm_EscMaxCnt <= dm_EscCnt) { dm_EscCnt = 0;   DestPage_Point = INDEX_SET_SETTING;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = MAINFUCTION_SET;  CurPage_Point = DestPage_Point;  } else { } break; case SUBFUCTION_SET_SCS: dm_EscCnt ++; if(dm_EscMaxCnt <= dm_EscCnt) { dm_EscCnt = 0;   DestPage_Point = INDEX_SET_SETTING;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = MAINFUCTION_SET;  CurPage_Point = DestPage_Point;  } else { } break; } } }  /************************************************** *Function :dm_Get_Eninfotainment_SubPage *Description: Get Infotainment page information *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_Eninfotainment_SubPage(void) { U8 MusSrcMd = 0; U16 RdoFrqcVal = 0;  COM_GetSignalValue_8(INDEX_COM_RS_MUSSRCMD, &MusSrcMd); dm_RadioSubPage = 0; return; }   /************************************************** *Function :dm_Get_POPUP_MainPage_MSG_Data *Description: Get Warn Page Infomation  *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_POPUP_MainPage_MSG_Data(void) {  U8 NavDircn; U16 NavDist; U8 unit = 0; U8 FrtDoorSts = 0; U8 PnsgDoorSts = 0;  Dm_Send_Data.DATA.Buffer.msg.MsgType = dm_MsgIndex; // dm_MsgIndex;  switch(dm_MsgIndex) { case INDEX_MSG_TPMS_PRESURELOW: case INDEX_MSG_TPMS_TEMPHIGH: case INDEX_MSG_TPMS_LEAKAGE: case INDEX_MSG_TPMS_PRESUREHIGH: case INDEX_MSG_TPMS_BALANCEFAIL: case INDEX_MSG_TPMS_BATLOW: TPMS_GetTPMSDATA(&(Dm_Send_Data.DATA.Buffer.msg.MsgData.TirePress)); break; case INDEX_MSG_FUEL_LOW_U50: case INDEX_MSG_FUEL_CRITICAL_U50: Dm_Send_Data.DATA.Buffer.msg.MsgData.Range.RangeToEmpty= RANG_GetDisplayRangeToEmpty(); break; case INDEX_MSG_DOORANDLID_DOOR_L5: case INDEX_MSG_DOORANDLID_DOOR_U5: case INDEX_MSG_WELCOME: { COM_GetSignalValue_8(INDEX_COM_RS_DRVRDOOROPENSTS, &FrtDoorSts); COM_GetSignalValue_8(INDEX_COM_RS_FRTPSNGDOOROPENSTS, &PnsgDoorSts); if( (0 != FrtDoorSts) || (0 != PnsgDoorSts) ) { Dm_Send_Data.DATA.Buffer.msg.MsgData.door.DrvDoorSts = FrtDoorSts; Dm_Send_Data.DATA.Buffer.msg.MsgData.door.PnsgDoorSts= PnsgDoorSts;  } } break; default: break; }  return;  }  /************************************************** *Function :dm_Get_POPUP_MainPage_MSG_Data *Description: Get Warn Page Infomation  *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void dm_Get_POPUP_MainPage_Navi_Data(MSG_EVENT_ENUM NaviMsg ) {  U8 NavDircn; U16 NavDist; U8 unit = 0; COM_GetSignalValue_16(INDEX_COM_RS_NAVDIST, &NavDist); COM_GetSignalValue_8(INDEX_COM_RS_NAVDISTUNIT, &unit);  Dm_Send_Data.DATA.Buffer.Navi.NavDircn = NaviMsg - INDEX_MSG_NAVI_CARLOGO; Dm_Send_Data.DATA.Buffer.Navi.NaviUnit = unit; Dm_Send_Data.DATA.Buffer.Navi.NavDist = NavDist; }   /************************************************** *Function :dm_Get_DestPage_Process *Description: Get DestPage Include Key opertion,and time *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_DestPage_Process(void) { U8 res; BOOL msg_Status; TRIPKeySts_ST Key_value; MSG_EVENT_ENUM index = INDEX_MSG_NULL; U8 group = 0; U8 pos = 0; U8 CurMsgEventCnt; BOOL bnaviActive = FALSE; static U8 KeyCnt = 0;  KeyCnt ++; if( 5 < KeyCnt) { KeyCnt = 0; res = TRIP_GetGetKeyEvent(&Key_value); }   if (ILLU_GetWelComeSts())  { dm_MsgIndex = INDEX_MSG_WELCOME;  } else { MSG_GetPopIndex(&dm_MsgIndex); } #if RANGE_ALERT_TEST dm_MsgIndex = INDEX_MSG_FUEL_CRITICAL_U50;//INDEX_MSG_FUEL_LOW_U50 #endif  #if TRIP_THRESHHOLD_TEST dm_MsgIndex = INDEX_MSG_NULL; #endif if((TRUE == EnableFun) || ((INDEX_MSG_NULL != dm_MsgIndex)&&(FALSE == StartLogoEn))) { index = dm_MsgIndex;  switch(index) { case INDEX_MSG_NAVI_CARLOGO: /*0*/ //¦Ì?o?MSG case INDEX_MSG_NAVI_GOSTRAIGHT: case INDEX_MSG_NAVI_TURNLEFT: case INDEX_MSG_NAVI_TURNRIGHT: case INDEX_MSG_NAVI_KEEPLEFT: case INDEX_MSG_NAVI_KEEPRIGHT:/*5*/ case INDEX_MSG_NAVI_TURNINCLINEDLEFT: case INDEX_MSG_NAVI_TURNINCLINEDRIGHT: case INDEX_MSG_NAVI_TURNLEFTAFTER: case INDEX_MSG_NAVI_TURNRIGHTAFTER: case INDEX_MSG_NAVI_LEFTBACK:/*10*/ case INDEX_MSG_NAVI_RIGHTBACK: case INDEX_MSG_NAVI_THREEFORKSONLEFT: case INDEX_MSG_NAVI_THREEFORKSONMIDDLE: case INDEX_MSG_NAVI_THREEFORKSONRIGHT: case INDEX_MSG_NAVI_CLOSEROADONLEFT:/*15*/ case INDEX_MSG_NAVI_CLOSEROADONRIGHT: case INDEX_MSG_NAVI_CLOSEROADONLEFTRAMP: case INDEX_MSG_NAVI_CLOSEROADONRIGHTRAMP: case INDEX_MSG_NAVI_LEFTSTRAIGHT: case INDEX_MSG_NAVI_RIGHTSTRAIGHT:/*20*/ case INDEX_MSG_NAVI_ITTOCIRCLEZONE: case INDEX_MSG_NAVI_OUTCIRCLEZONE: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE45: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE90: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE135:/*25*/ case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE180: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE225: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE270: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE315: case INDEX_MSG_NAVI_OUTCIRCLEANTICLOCKWISE360:/*30*/ case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE45: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE90: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE135: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE180: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE225:/*35*/ case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE270: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE315: case INDEX_MSG_NAVI_OUTCIRCLECLOCKWISE360: case INDEX_MSG_NAVI_DIRECTROAD: case INDEX_MSG_NAVI_TOLLSTATION:/*40*/ case INDEX_MSG_NAVI_FERRY: case INDEX_MSG_NAVI_TUNNELENTRANCE: case INDEX_MSG_NAVI_BRIDGEENTRANCE: case INDEX_MSG_NAVI_ORIGIN: case INDEX_MSG_NAVI_PATHWAY1:/*45*/ case INDEX_MSG_NAVI_PATHWAY2: case INDEX_MSG_NAVI_PATHWAY3: case INDEX_MSG_NAVI_PATHWAY4: case INDEX_MSG_NAVI_PATHWAY5: case INDEX_MSG_NAVI_DESTINATION:/*50*/ case INDEX_MSG_NAVI_VILLAGE: case INDEX_MSG_NAVI_SUPERVISEDRAILWAY: case INDEX_MSG_NAVI_UNSUPERVISEDRAILWAY: case INDEX_MSG_NAVI_SHARPLEFTTURN: case INDEX_MSG_NAVI_SHARPRIGHTTURN:/*55*/ case INDEX_MSG_NAVI_LEFTMERGING: case INDEX_MSG_NAVI_RIGHTMERGING: case INDEX_MSG_NAVI_UPSLOPE: case INDEX_MSG_NAVI_DOWNSLOPE: case INDEX_MSG_NAVI_HUMPBRIDGE:/*60*/ case INDEX_MSG_NAVI_TUNNEL:  Dm_Send_Data.CMD.PageType = INDEX_POPUP; Dm_Send_Data.CMD.MainPage =POPUP_MAINFUNCTION_NAVI; Dm_Send_Data.CMD.SubPage = 0; break;  case INDEX_MSG_NULL: { if(INDEX_FUNCTION != Dm_Send_Data.CMD.PageType) {  Dm_Send_Data.CMD = dm_FunPage; } else { }  #if TRIP_THRESHHOLD_TEST Dm_Send_Data.CMD.MainPage = MAINFUCTION_TC; Dm_Send_Data.CMD.SubPage= SUBFUCTION_TC_INSFUELCOMP; #endif  Dm_Send_Data.CMD.PageType = INDEX_FUNCTION; if(((Key_value.status == STATUS_TRIP_PRESS_SHORT) ||(Key_value.status == STATUS_TRIP_PRESS_LONG)) && (0 == KeyCnt))  { switch(Key_value.type) { case TYPE_TRIP_OK: dm_EscCnt = 0; dm_KeyRespond_OK(); break; case TYPE_TRIP_UP:  dm_EscCnt = 0; dm_KeyRespond_UP(); break; case TYPE_TRIP_DOWN:  dm_EscCnt = 0; dm_KeyRespond_DOWN(); break; case TYPE_TRIP_RIGHT:  dm_EscCnt = 0; dm_KeyRespond_RIGHT(); break; case TYPE_TRIP_LEFT:  dm_EscCnt = 0; dm_KeyRespond_LEFT(); break; default: break; } } else { /*do nothing*/ if(MAINFUCTION_ENTERTAINMENT == Dm_Send_Data.CMD.MainPage) {  Dm_Send_Data.CMD.SubPage = dm_RadioSubPage; } else { } dm_SetMenu_AutoExist(); }  if(SUBFUCTION_TC_TIREPRESS == Dm_Send_Data.CMD.SubPage) { Dm_Send_Data.DATA.Buffer.Tire.TitleIndex = INDEX_MSG_NULL; } else { }  dm_FunPage = Dm_Send_Data.CMD; } break; default: Dm_Send_Data.CMD.PageType = INDEX_POPUP; Dm_Send_Data.CMD.MainPage = POPUP_MAINFUNCTION_MSG; Dm_Send_Data.CMD.SubPage = dm_FunPage.MainPage;  dm_EscCnt = 0; break;  }   } else { if(TRUE == StartLogoEn) { Dm_Send_Data.CMD.PageType = INDEX_LOGO;  } else { Dm_Send_Data.CMD.PageType = INDEX_LOGO;  } } }   /************************************************** *Function :dm_KeyRespond_OK *Description: KEY-OK RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyRespond_OK(void) { U8 Value =0 ;  switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_TIREPRESS: break; case INDEX_SET_ILLU: DestPage_Point = INDEX_SET_SETTING;  ILLU_SetILLULevel(CHANNEL_ILLU_TFT,illu_Level);  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_OK.MainPage;  CurPage_Point = DestPage_Point; break; case INDEX_SET_SPEEDLIMIT: DIAG_SetOSThresh(speed_Limit);  DestPage_Point = INDEX_SET_SETTING;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_OK.MainPage;  CurPage_Point = DestPage_Point; break; case INDEX_SET_SCS: if((0 == SCS_Sts) && (FALSE == SCS_Get_StabCtrlDsblSwAReq())) { scs_cmd = TRUE; } else { }  DestPage_Point = INDEX_SET_SETTING;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SETTING; Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_OK.MainPage;  CurPage_Point = DestPage_Point; break; case INDEX_ENT_MEDIA_MUSIC: case INDEX_FAULT_FAULTLIST: break; case INDEX_TC_AUTOSTART: break; case INDEX_TC_AUTORST: break; case INDEX_SET_SETTING: if(dm_stSet.maxCnt >0) { switch(dm_stSet.Item[SetSel]) { case ITEM_SETMAIN_NULL:  break; case ITEM_SETMAIN_ILLU:  DestPage_Point = INDEX_SET_ILLU;  ILLU_GetILLULevel(&illu_Level); Dm_Send_Data.CMD.SubPage = SUBFUCTION_SET_ILLU; break; case ITEM_SETMAIN_LIMIT:  DestPage_Point = INDEX_SET_SPEEDLIMIT;  Value = DIAG_GetOSThresh(); if(Value < 30)  { Value = 0; } else { } speed_Limit = Value/5;  Dm_Send_Data.CMD.SubPage = SUBFUCTION_SET_SPEEDLIMIT; break; case ITEM_SETMAIN_SCSOFF:  DestPage_Point = INDEX_SET_SCS;  if( TRUE == SCS_Get_StabCtrlDsblSwAReq()) { SCS_Sts = 0; } else { SCS_Sts = 1; } Dm_Send_Data.CMD.SubPage = SUBFUCTION_SET_SCS; break; } } Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_OK.MainPage;  CurPage_Point = DestPage_Point; break; default: break; } }  /************************************************** *Function :dm_KeyTripCmpt_UP *Description: TC Function KEY-UP RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void dm_KeyTripCmpt_UP(void) { if(SUBFUCTION_TC_SPEED == TCSel) { TCSel = SUBFUCTION_TC_TIREPRESS; } else { switch(TCSel) { case SUBFUCTION_TC_TIREPRESS:  TCSel--; if(FALSE == DIAG_GetTrip2UserEn()) {  TCSel--;  if(FALSE == DIAG_GetTrip1UserEn()) { TCSel--;  } else { } } else { } break; case SUBFUCTION_TC_AUTORST: TCSel--;  if(FALSE == DIAG_GetTrip1UserEn()) { TCSel--;  } else { } break; default:  TCSel--;  break; }  }  }  /************************************************** *Function :dm_KeyRespond_UP *Description: KEY-UP RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyRespond_UP(void) {  switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST: case INDEX_TC_TIREPRESS:  dm_KeyTripCmpt_UP();  DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_UP.DestPage_Point; Dm_Send_Data.CMD.SubPage = TCSel; break; case INDEX_ENT_MEDIA_MUSIC: break; case INDEX_SET_SETTING: case INDEX_SET_ILLU: case INDEX_SET_SPEEDLIMIT: case INDEX_SET_SCS: case INDEX_FAULT_FAULTLIST:  default: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_UP.DestPage_Point; Dm_Send_Data.CMD.SubPage = DestPage_Matrix[CurPage_Point].CMD_UP.SubPage; break; }  switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST: case INDEX_TC_TIREPRESS: break; case INDEX_ENT_MEDIA_MUSIC: break; case INDEX_SET_SETTING: if(SetSel > 0) { SetSel--; } else { } break; case INDEX_SET_ILLU: if(INDEX_ILLU_lEVEL3 > illu_Level)  { illu_Level++; } else { } break; case INDEX_SET_SPEEDLIMIT: if(INDEX_SPEEDLIMIT_OFF == speed_Limit) { speed_Limit = INDEX_SPEEDLIMIT_220; } else if(INDEX_SPEEDLIMIT_30 == speed_Limit) { speed_Limit = INDEX_SPEEDLIMIT_OFF; } else { speed_Limit--; } break; case INDEX_SET_SCS: if(1 == SCS_Sts) { SCS_Sts --; } else { } break; case INDEX_FAULT_FAULTLIST: if(CurFaultList >= DM_FLTLIST_ITEM_MAX) { CurFaultList -=4; } else { } break; default: break; } Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_UP.MainPage; CurPage_Point = DestPage_Point; }   /************************************************** *Function :dm_KeyTripCmpt_DOWN *Description: TC FUNCTION KEY-down RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyTripCmpt_DOWN(void) { if(SUBFUCTION_TC_TIREPRESS == TCSel) { TCSel = SUBFUCTION_TC_SPEED; } else { switch(TCSel) { case SUBFUCTION_TC_BAT:  TCSel++; if(FALSE == DIAG_GetTrip1UserEn()) {  TCSel++;  if(FALSE == DIAG_GetTrip2UserEn()) { TCSel++;  } else { } } else { } break; case SUBFUCTION_TC_AUTOSTART: TCSel++;  if(FALSE == DIAG_GetTrip2UserEn()) { TCSel++;  } else { } break; default:  TCSel++; break; } }  }   /************************************************** *Function :dm_KeyRespond_DOWN *Description: KEY-down RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyRespond_DOWN(void) { switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST: case INDEX_TC_TIREPRESS:  dm_KeyTripCmpt_DOWN(); DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_DOWN.DestPage_Point; Dm_Send_Data.CMD.SubPage = TCSel; break; case INDEX_ENT_MEDIA_MUSIC: break; case INDEX_SET_SETTING: case INDEX_SET_ILLU: case INDEX_SET_SPEEDLIMIT: case INDEX_SET_SCS: case INDEX_FAULT_FAULTLIST:  default: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_DOWN.DestPage_Point; Dm_Send_Data.CMD.SubPage = DestPage_Matrix[CurPage_Point].CMD_DOWN.SubPage; break; }  switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST: case INDEX_ENT_MEDIA_MUSIC: case INDEX_TC_TIREPRESS: break; case INDEX_SET_SETTING: if(SetSel < dm_stSet.maxCnt-1) { SetSel++; } else { } break; case INDEX_SET_ILLU: if(INDEX_ILLU_lEVEL1 < illu_Level)  { illu_Level--; } else { } break; case INDEX_SET_SPEEDLIMIT: if(INDEX_SPEEDLIMIT_220 == speed_Limit) { speed_Limit = INDEX_SPEEDLIMIT_OFF; } else if(INDEX_SPEEDLIMIT_OFF == speed_Limit) { speed_Limit = INDEX_SPEEDLIMIT_30; } else  { speed_Limit++; } break; case INDEX_SET_SCS: if(0 == SCS_Sts) { SCS_Sts ++; } else { } break; case INDEX_FAULT_FAULTLIST: if(CurFaultList+DM_FLTLIST_ITEM_MAX < CurTotolFaultList) { CurFaultList +=DM_FLTLIST_ITEM_MAX; } else { } break; default: break; } Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_DOWN.MainPage; CurPage_Point = DestPage_Point; }   /************************************************** *Function :dm_KeyRespond_LEFT *Description: KEY-left RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyRespond_LEFT(void) { U8 NavDircn; U16 NavDist; U8 MusSrcMd;  COM_GetSignalValue_8(INDEX_COM_RS_MUSSRCMD, &MusSrcMd); COM_GetSignalValue_8(INDEX_COM_RS_NAVDIRCN, &NavDircn); COM_GetSignalValue_16(INDEX_COM_RS_NAVDISTUNIT, &NavDist);  switch(CurPage_Point) {   case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST:  case INDEX_TC_TIREPRESS: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_LEFT.DestPage_Point; Dm_Send_Data.CMD.SubPage = DestPage_Matrix[CurPage_Point].CMD_LEFT.SubPage; break; case INDEX_SET_ILLU: case INDEX_SET_SPEEDLIMIT: case INDEX_SET_SCS: case INDEX_SET_SETTING: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_LEFT.DestPage_Point; Dm_Send_Data.CMD.SubPage = TCSel; break; case INDEX_ENT_MEDIA_MUSIC: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_LEFT.DestPage_Point; Dm_Send_Data.CMD.SubPage = DestPage_Matrix[CurPage_Point].CMD_LEFT.SubPage; break; case INDEX_FAULT_FAULTLIST:  DestPage_Point = dm_RadioSubPage + INDEX_ENT_MEDIA_MUSIC;  Dm_Send_Data.CMD.SubPage = dm_RadioSubPage; break; default: break; } Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_LEFT.MainPage; CurPage_Point = DestPage_Point; }   /************************************************** *Function :dm_KeyRespond_RIGHT *Description: KEY-right RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_KeyRespond_RIGHT(void) { U8 NavDircn; U16 NavDist; U8 MusSrcMd;  COM_GetSignalValue_8(INDEX_COM_RS_MUSSRCMD, &MusSrcMd); COM_GetSignalValue_8(INDEX_COM_RS_NAVDIRCN, &NavDircn); COM_GetSignalValue_16(INDEX_COM_RS_NAVDIST, &NavDist);  switch(CurPage_Point) { case INDEX_TC_SPEED: case INDEX_TC_INSFUELCOMPN: case INDEX_TC_RANG: case INDEX_TC_BAT: case INDEX_TC_AUTOSTART: case INDEX_TC_AUTORST: case INDEX_TC_TIREPRESS: case INDEX_ENT_MEDIA_MUSIC: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_RIGHT.DestPage_Point; Dm_Send_Data.CMD.SubPage = DestPage_Matrix[CurPage_Point].CMD_RIGHT.SubPage; break; case INDEX_SET_SETTING: case INDEX_SET_ILLU: case INDEX_SET_SPEEDLIMIT: case INDEX_SET_SCS: DestPage_Point = dm_RadioSubPage + INDEX_ENT_MEDIA_MUSIC; Dm_Send_Data.CMD.SubPage = dm_RadioSubPage; break; case INDEX_FAULT_FAULTLIST: DestPage_Point = DestPage_Matrix[CurPage_Point].CMD_RIGHT.DestPage_Point; Dm_Send_Data.CMD.SubPage = TCSel;  break; default: break; } Dm_Send_Data.CMD.MainPage = DestPage_Matrix[CurPage_Point].CMD_RIGHT.MainPage; CurPage_Point = DestPage_Point; }   /************************************************** *Function :dm_Get_Trip_Tirepress_Data *Description: KEY-right RESPONSE *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ void dm_Get_Trip_Tirepress_Data(Dm_TC_TirePress_ST *TirePress) { BOOL FLTirePressV; BOOL FLTireTempV; BOOL FRTirePressV; BOOL FRTireTempV; BOOL RLTirePressV; BOOL RLTireTempV; BOOL RRTirePressV; BOOL RRTireTempV; U8 FLTirePress; U8 FLTireTemp; U8 FRTirePress; U8 FRTireTemp; U8 RLTirePress; U8 RLTireTemp; U8 RRTirePress; U8 RRTireTemp; U8 FLTireSts; U8 FRTireSts; U8 RLTireSts; U8 RRTireSts;  COM_GetSignalValue_8(INDEX_COM_RS_FLTIREPRSV, &FLTirePressV); COM_GetSignalValue_8(INDEX_COM_RS_FLTIRETEMV, &FLTireTempV); COM_GetSignalValue_8(INDEX_COM_RS_FRTIREPRSV, &FRTirePressV); COM_GetSignalValue_8(INDEX_COM_RS_FRTIRETEMV, &FRTireTempV); COM_GetSignalValue_8(INDEX_COM_RS_RLTIREPRSV, &RLTirePressV); COM_GetSignalValue_8(INDEX_COM_RS_RLTIRETEMV, &RLTireTempV); COM_GetSignalValue_8(INDEX_COM_RS_RRTIREPRSV, &RRTirePressV); COM_GetSignalValue_8(INDEX_COM_RS_RRTIRETEMV, &RRTireTempV); COM_GetSignalValue_8(INDEX_COM_RS_FLTIREPRS, &FLTirePress); COM_GetSignalValue_8(INDEX_COM_RS_FLTIRETEM, &FLTireTemp); COM_GetSignalValue_8(INDEX_COM_RS_FRTIREPRS, &FRTirePress); COM_GetSignalValue_8(INDEX_COM_RS_FRTIRETEM, &FRTireTemp); COM_GetSignalValue_8(INDEX_COM_RS_RLTIREPRS, &RLTirePress); COM_GetSignalValue_8(INDEX_COM_RS_RLTIRETEM, &RLTireTemp); COM_GetSignalValue_8(INDEX_COM_RS_RRTIREPRS, &RRTirePress); COM_GetSignalValue_8(INDEX_COM_RS_RRTIRETEM, &RRTireTemp); COM_GetSignalValue_8(INDEX_COM_RS_FLTIRESTS, &FLTireSts); COM_GetSignalValue_8(INDEX_COM_RS_FRTIRESTS, &FRTireSts); COM_GetSignalValue_8(INDEX_COM_RS_RLTIRESTS, &RLTireSts); COM_GetSignalValue_8(INDEX_COM_RS_RRTIRESTS, &RRTireSts);  TirePress->FLTirePressV = FLTirePressV; TirePress->FLTireTempV = FLTireTempV; TirePress->FRTirePressV = FRTirePressV; TirePress->FRTireTempV = FRTireTempV; TirePress->RLTirePressV = RLTirePressV; TirePress->RLTireTempV = RLTireTempV; TirePress->RRTirePressV = RRTirePressV; TirePress->RRTireTempV = RRTireTempV; TirePress->FLTirePress = FLTirePress; TirePress->FLTireTemp = FLTireTemp; TirePress->FRTirePress = FRTirePress; TirePress->FRTireTemp = FRTireTemp ; TirePress->RLTirePress = RLTirePress; TirePress->RLTireTemp = RLTireTemp; TirePress->RRTirePress = RRTirePress; TirePress->RRTireTemp = RRTireTemp; TirePress->FLTireSts = FLTireSts; TirePress->FRTireSts = FRTireSts; TirePress->RLTireSts = RLTireSts; TirePress->RRTireSts = RRTireSts; }   /************************************************** *Function :dm_Get_DestData_Process *Description: Dest Data Update *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_DestData_Process(U8 isUpdate) { U8 res; U8 sts; PTime_ST Time; U32 OdoValue; MSG_EVENT_ENUM Cur_EventOccur; AccGearInfo_ST GearType;  res = RTC_GetCurTime(&Time); memcpy(&Dm_Send_Data.DATA.time, &Time, sizeof(PTime_ST)); Dm_Send_Data.DATA.odoTgt.show = TRUE; EVT_GetCrusTgtSpd(&Dm_Send_Data.DATA.odoTgt.isCrusTgt,&OdoValue); if(FALSE == Dm_Send_Data.DATA.odoTgt.isCrusTgt) { res = ODO_GetODOValue(INDEX_ODO_ODOVALUE, &OdoValue); EED_GetEEPROMStatus(&sts);  switch(sts) { case STATUS_EED_READING: case STATUS_EED_WRITEING: case STATUS_EED_PROTECTING: break;  case STATUS_EED_UNKNOWN: case STATUS_EED_ERR: Dm_Send_Data.DATA.odoTgt.show = FALSE;  break;  case STATUS_EED_IDLE: default: break;  }  } else { } if(OdoValue > 999999) { OdoValue = 999999; } else { } Dm_Send_Data.DATA.odoTgt.value = OdoValue; res = ACC_GetGearSts(&GearType); Dm_Send_Data.DATA.GearType = GearType;  if(INDEX_LOGO == Dm_Send_Data.CMD.PageType) { Dm_Send_Data.DATA.Buffer.Logo_index = logoTab[logoCnt]; } else if(INDEX_POPUP == Dm_Send_Data.CMD.PageType) { if(POPUP_MAINFUNCTION_MSG == Dm_Send_Data.CMD.MainPage) { dm_Get_POPUP_MainPage_MSG_Data(); } else if(POPUP_MAINFUNCTION_NAVI== Dm_Send_Data.CMD.MainPage) { dm_Get_POPUP_MainPage_Navi_Data(dm_MsgIndex); }  else { } } else/*INDEX_FUNCTION == Dm_Send_Data.CMD.PageType*/ {   if(MAINFUCTION_TC == Dm_Send_Data.CMD.MainPage) { dm_Get_MainPage_TC_Data(isUpdate); } else if(MAINFUCTION_SET == Dm_Send_Data.CMD.MainPage) { dm_Get_MainPage_Set_Data(); } else if(MAINFUCTION_ENTERTAINMENT == Dm_Send_Data.CMD.MainPage) { dm_Get_MainPage_ENT_Data(); } else/*fault*/ { dm_Get_MainPage_FAULT_Data(); } } }  /************************************************** *Function :dm_Get_DestData_Process *Description: Dest Data Update *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_MainPage_TC_Data(U8 isUpdate) { U8 res; U8 FuelConsumption; BOOL FuelConsumptionV; DBL DisplayFuel; U8 UnitType; float InsFuelConpn; U32 DrivenTime; U32 AverageSpeed; U32 DisplaySpeed;  U32 trip; U16 BatValue; U16 RangeToEmpty; //U16 angle = 0; static U16 count_1s = 0;  static U8 SpeetCnt = DM_DISPLAYSPEED_CNT;  static U8 autoStartCnt = DM_AUTOSTART_CNT; static U8 autoRstCnt = DM_AUTORST_CNT; U8 rstFlg = FALSE;  switch(Dm_Send_Data.CMD.SubPage) { case SUBFUCTION_TC_SPEED: //res = ST_GetDisplaySpeed(&DisplaySpeed);   DisplaySpeed = ST_GetCurAngleSpeed();  SpeetCnt++; if((DM_DISPLAYSPEED_CNT <= SpeetCnt) || (TRUE == isUpdate)) { Dm_Send_Data.DATA.Buffer.DisplaySpeed = DisplaySpeed; SpeetCnt = 0; } else { } break; case SUBFUCTION_TC_INSFUELCOMP:  res = ACC_GetInstantFuelConsumption(&(Dm_Send_Data.DATA.Buffer.InsFuel)); break; case SUBFUCTION_TC_RANGE: RangeToEmpty = RANG_GetDisplayRangeToEmpty(); Dm_Send_Data.DATA.Buffer.RangeToEmpty = RangeToEmpty; break; case SUBFUCTION_TC_BAT: res = BAT_GetBCMBatValue(&BatValue); Dm_Send_Data.DATA.Buffer.bat.Value = BatValue; Dm_Send_Data.DATA.Buffer.bat.Valid = VALID; break; case SUBFUCTION_TC_AUTOSTART:  FuelConsumptionV = FC_GetFuelConsumptionV1(); FuelConsumption = FC_GetFuelConsumption1();  if(DM_AVRGFUELCONPN_MAX <= FuelConsumption) { FuelConsumption = DM_AVRGFUELCONPN_MAX; } else { }   res = ODO_GetODOValue(INDEX_ODO_TRIP1, &trip); res = RTC_GetDrivenTime(E_DRIVEN_TIME1, &DrivenTime); res = ST_GetAverageSpeed(E_ST_AVERAGE_SPEED1, &AverageSpeed); TRIP_GetTripRstSts(RSTTYPE_TRIP_TRIP1,&rstFlg); if(TRUE == rstFlg) { autoStartCnt = 0; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgSpeed1 = 0;  Dm_Send_Data.DATA.Buffer.AutoStart_Show.ODOValue1 = 0; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgFuelConpnV1 = INVALID; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgFuelConpn1 = 0; Dm_Send_Data.DATA.Buffer.AutoStart_Show.DrivenTime1 = 0; } else { autoStartCnt ++; if((DM_AUTOSTART_CNT >= autoStartCnt) || (TRUE == isUpdate)) { autoStartCnt = 0; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgSpeed1 = AverageSpeed;  Dm_Send_Data.DATA.Buffer.AutoStart_Show.ODOValue1 = trip; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgFuelConpnV1 = FuelConsumptionV; Dm_Send_Data.DATA.Buffer.AutoStart_Show.AvrgFuelConpn1 = FuelConsumption; Dm_Send_Data.DATA.Buffer.AutoStart_Show.DrivenTime1 = DrivenTime; } else { } }  break; case SUBFUCTION_TC_AUTORST: FuelConsumptionV = FC_GetFuelConsumptionV2(); FuelConsumption = FC_GetFuelConsumption2();  if(DM_AVRGFUELCONPN_MAX <= FuelConsumption) { FuelConsumption = DM_AVRGFUELCONPN_MAX; } else { }   res = ODO_GetODOValue(INDEX_ODO_TRIP2, &trip); res = RTC_GetDrivenTime(E_DRIVEN_TIME2, &DrivenTime); res = ST_GetAverageSpeed(E_ST_AVERAGE_SPEED2, &AverageSpeed); TRIP_GetTripRstSts(RSTTYPE_TRIP_TRIP2,&rstFlg);  #if TRIP_THRESHHOLD_TEST  FuelConsumptionV = VALID; FuelConsumption = 20; trip = 299; #endif if(TRUE == rstFlg) { autoRstCnt = 0; Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgSpeed2 = 0; Dm_Send_Data.DATA.Buffer.AutoRst_Show.ODOValue2 = 0; Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgFuelConpnV2 = INVALID; Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgFuelConpn2 = 0; Dm_Send_Data.DATA.Buffer.AutoRst_Show.DrivenTime2 = 0; } else {  autoRstCnt ++; if((DM_AUTORST_CNT >= autoRstCnt) || (TRUE == isUpdate)) { autoRstCnt = 0;  Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgSpeed2 = AverageSpeed; Dm_Send_Data.DATA.Buffer.AutoRst_Show.ODOValue2 = trip; Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgFuelConpnV2 = FuelConsumptionV; Dm_Send_Data.DATA.Buffer.AutoRst_Show.AvrgFuelConpn2 = FuelConsumption; Dm_Send_Data.DATA.Buffer.AutoRst_Show.DrivenTime2 = DrivenTime; } else { } }  break; case SUBFUCTION_TC_TIREPRESS: TPMS_GetTPMSDATA(&Dm_Send_Data.DATA.Buffer.Tire.TirePress); break; default: break; } }    /************************************************** *Function :dm_Get_MainPage_Set_Data *Description: collect Dest Data Update *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_MainPage_Set_Data(void) { U8 i = 0; switch(Dm_Send_Data.CMD.SubPage) { case SUBFUCTION_SETTING: for(i =0; i< SETMAIN_TABLE_MAXCNT; i++) { if((dm_SetTab[i].illuEn == dm_stSet.illuEn) && (dm_SetTab[i].ScsEn== dm_stSet.ScsEn) && (dm_SetTab[i].SpdLmtEn== dm_stSet.SpdLmtEn)) {  memcpy(&dm_stSet,&(dm_SetTab[i]),sizeof(Dm_SetPageData_ST)); memcpy(Dm_Send_Data.DATA.Buffer.SetMain.Item,dm_stSet.Item,3);  break; } else { /*do nothing*/ } }  if(SetSel >= dm_stSet.maxCnt-1) { SetSel = dm_stSet.maxCnt-1; } else { } Dm_Send_Data.DATA.Buffer.SetMain.Sel = SetSel; break; case SUBFUCTION_SET_ILLU: Dm_Send_Data.DATA.Buffer.IlluLevel = illu_Level; break; case SUBFUCTION_SET_SPEEDLIMIT: Dm_Send_Data.DATA.Buffer.SpeadLimit = speed_Limit; break; case SUBFUCTION_SET_SCS: Dm_Send_Data.DATA.Buffer.SCSEn = SCS_Sts; break; default: break; } }    /************************************************** *Function :dm_Get_MainPage_ENT_Data *Description: collect Enfotainment Data *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_MainPage_ENT_Data(void) { U8 res; U8 GearType; U16 RdoFrqcVal; U8 NavDircn; U16 NavDist; U8 unit = 0; U8 FICMLost = FALSE;  U8 MusSrcMd = 0; COM_GetSignalValue_8(INDEX_COM_RS_MUSSRCMD, &MusSrcMd); NWD_GetNodeMissing(INDEX_FICM_NODE_SOT,&FICMLost);  switch(Dm_Send_Data.CMD.SubPage) { case SUBFUCTION_MEDIA_MUSIC: if(FALSE == FICMLost) Dm_Send_Data.DATA.Buffer.MusicSrc = MusSrcMd; else  Dm_Send_Data.DATA.Buffer.MusicSrc = 0; break;  default: break; } }    /************************************************** *Function :dm_Get_MainPage_FAULT_Data *Description: collect Enfotainment Data *Parameters:none *Returns: none **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ static void dm_Get_MainPage_FAULT_Data(void) {  EVT_GetFltListItem(CurFaultList,&Dm_Send_Data.DATA.Buffer.Fault,DM_FLTLIST_ITEM_MAX);  CurTotolFaultList = Dm_Send_Data.DATA.Buffer.Fault.total; CurFaultList = Dm_Send_Data.DATA.Buffer.Fault.index;  }   /************************************************** *Function :DM_GetDisplayInfo *Description: Collect all data whitch HMI need  *Parameters:none *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success   **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 ***************************************************/ U8 DM_GetDisplayInfo(DM_Send_PageValue_ST *pInfo) { U8 res;  if (FALSE == DM_InitSts) { res = RET_FAIL; } else if (NULL_PTR == pInfo) { res = RET_INVALID; } else { memcpy(pInfo, &Dm_Send_Data, sizeof(DM_Send_PageValue_ST)); res = RET_OK;  } return res; }   /*************************************************************** *Function :DM_GetScsSwEn *Description:DM SHOULD CLEAN THE scs status with 100ms period  *Parameters:none *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ /*DM SHOULD CLEAN THE scs status with 100ms*/ U8 DM_GetScsSwEn(PU8 status) {  if(FALSE == DM_InitSts) { return RET_FAIL; } else { }  if(NULL_PTR == status) { return RET_INVALID; } else { *status = scs_cmd; return RET_OK; } }    /*************************************************************** *Function :DM_SetScsSwEn *Description:HMI will use this function to modify the SCS output  *Parameters:none *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ void DM_SetScsSwEn(U8 status) { scs_cmd = status; }  /*************************************************************** *Function :DM_GetSetMainIndex *Description:HMI will use this function to Get  mainset page highlight index  *Parameters:Index out put *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ U8 DM_GetSetMainIndex(PU8 pIndex) { if(FALSE == DM_InitSts) { return RET_FAIL; } else { }  if(NULL_PTR == pIndex) { return RET_INVALID; } else { *pIndex = SetSel; return RET_OK; } }   /*************************************************************** *Function :DM_GetFltListIndex *Description:HMI will use this function to Get  Fault list page the first item show on the screen *Parameters:Index out put *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ U8 DM_GetFltListIndex(PU8 pIndex) { if(FALSE == DM_InitSts) { return RET_FAIL; } else { }  if(NULL_PTR == pIndex) { return RET_INVALID; } else { *pIndex = CurFaultList; return RET_OK; } }   /*************************************************************** *Function :DM_UpdatePageInfo *Description:HMI will use this function to Get  function information when pwr-on *Parameters:Index out put *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ U8 DM_UpdatePageInfo(Dm_CMD_ST *data) { if(FALSE == DM_InitSts) { return RET_FAIL; } else { }  if(NULL_PTR == data) { return RET_INVALID; } else { memcpy(data,&dm_FunPage,sizeof(Dm_CMD_ST));  return RET_OK; } }   /*************************************************************** *Function :DM_GetIlluLevel *Description:Get the current ILLUMINATION LEVEL *Parameters:Index out put *Returns:  RET_FAIL: DM module init fail RET_INVALID: parameter err RET_OK: operation success  **create&Verlog: *Author Name xs Date:2017-09-22 Ver:02 *****************************************************************/ U8 DM_GetIlluLevel(PU8 Level) {  if(FALSE == DM_InitSts) { return RET_FAIL; } else if(NULL_PTR == Level) { return RET_INVALID; } else { *Level = illu_Level;  return RET_OK; } } /*=========================================================================================================== dm.c dm_cfg.h dm_info.inc dm_private.h dm_public.h File Revision History (bottom to top:first revision to last revision) * *============================================================================================================ *$Log:$ *  *Rev: Userid: date: description *----- ----- ----------- ----------- *Rev 1 zhangxianxiang 2017-06-22 initial ============================================================================================================*/
