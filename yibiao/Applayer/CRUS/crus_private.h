/***************************************************************************** crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h Copyright (C) 2016 ShenZhen Yeedon Media co.,LTD. All rights reserved. * crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h File Name : crus_private.h crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h Description : the private datas of the Crus crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h Author: chensongming crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h Date: 2017-6-29 ******************************************************************************/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr check of multiple include */ #ifndef _CRUS_PRIVATE_H_  #define _CRUS_PRIVATE_H_ #define CRUS1_TABLE_SIZE (sizeof(crus4Key_Martrix) /sizeof(crus4Key_Martrix[0])) #define CRUS2_TABLE_SIZE (sizeof(crus8Key_Martrix) /sizeof(crus8Key_Martrix[0]))  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Macro defines */  #define CRUS_PROCESS_CNT 60 #define CRUS_STICKY_CNT 30000 #define CRUS_PROCESS_PERIOD 20 #define CNT_FAULT_PERIOD (CRUS_PROCESS_CNT / CRUS_PROCESS_PERIOD) #define CNT_STICKY_FAULT_PERIOD (CRUS_STICKY_CNT / CRUS_PROCESS_PERIOD) #define CNT_CANCEL_BAT (CRUS_PROCESS_CNT / CRUS_PROCESS_PERIOD) #define CNT_CANCEL_GND (CRUS_PROCESS_CNT / CRUS_PROCESS_PERIOD) #define CNT_CANCEL_OUTRANGE (CRUS_PROCESS_CNT / CRUS_PROCESS_PERIOD)   #define CRUS_SIGNAL_REST_BAND 3256/*269*/ #define CRUS_SIGNAL_SHORT_2_BAT 3686//3169/*3686*/ #define CRUS_SIGNAL_SHORT_2_GND 141/*164*/ #define CRUS_OFFSETRANGE 164  #define FAILURE_DETECTED 2 #define ILLEAGAL_RANGE 3  #define CRUS_SIGNAL_SET 357 #define CRUS_SIGNAL_OFF 936 #define CRUS_SIGNAL_ON 1525 #define CRUS_SIGNAL_RESUME 2111 #define CRUS_SIGNAL_CANCEL 2670  #define CRUS_SIGNAL_DECEL 357/*415*/ #define CRUS_SIGNAL_AECEL 536/*936*//*1089*/ #define CRUS_SIGNAL_DISTANCE_AEC 1290 /*1525*//*1774*/ #define CRUS_SIGNAL_DISTANCE_DEC 2010/*2111*//*2456*/  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Private data structures defines */ typedef struct CRUSSendNetData_Tag { BOOL CCSwStsCanclSwA; /*表示Cancel有效性*/ BOOL CCSwStsOnSwA; /*表示On有效性*/ BOOL CCSwStsRsmSwA; /*表示Resume有效性*/ BOOL CCSwStsSetSwA ; /*表示Set有效性*/ BOOL CCSwStsSpdDecSwA; /*表示Decel有效性*/ BOOL CCSwStsSpdIncSwA; /*表示Incell有效性*/ BOOL CCSwStsDistDecSwA; /*表示Distance +有效性*/ BOOL CCSwStsDistIncSwA; /*表示Distance-有效性*/ U8 CCSwStsSwDataIntgty; /*表示数据完整性*/ U8 CCSwStsPV; /*表示巡航开关控制保护*/ U8 CCSwStsAlvRC; /*表示巡航开关状态计数器*/ U8 Reserve; } CRUSSendNetData_ST;  typedef union BYTE0_Tag { U8 Byte; struct { U8 CRUS_CCSwStsSwDataIntgty : 2; U8 CRUS_CCSwStsSpdDecSwA : 1; U8 CRUS_CCSwStsSpdIncSwA : 1; U8 CRUS_CCSwStsSetSwA : 1; U8 CRUS_CCSwStsRsmSwA : 1; U8 CRUS_CCSwStsOnSwA : 1; U8 CRUS_CCSwStsCanclSwA : 1; }BYTES; }BYTE0_UN;  typedef union BYTE2_Tag { U8 Byte; struct { U8 CCSwStsAlvRC: 2; U8 CCSwStsDistDecSwA: 1; U8 CCSwStsDistIncSwA: 1; U8 Clearbit: 4; /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr reserved bits */ }BYTES; }BYTE2_UN;  typedef enum CRUS1SwitchSts_Tag { STATUS_CRUS1_SET = (0u), /*开关位置处于SET位置 */ STATUS_CRUS1_OFF, /*开关位置处于OFF位置 */ STATUS_CRUS1_ON, /*开关位置处于ON位置 */ STATUS_CRUS1_RESUME, /*开关位置处于RESUME位置 */ STATUS_CRUS1_CANCEL, /*开关位置处于CANCEL位置 */ STATUS_CRUS1_REST_BAND, /*开关全部断开*/ STATUS_CRUS1_SHORT_2_BAT, /*开关对电源短路 */ STATUS_CRUS1_SHORT_2_GND, /*开关对地短路 */ STATUS_CRUS1_OUTRANGE, /*OUT of range*/ STATUS_CRUS1_ALL }CRUS1SwitchStatus_ENUM;     typedef enum CRUS2SwitchSts_Tag { STATUS_CRUS2_DECEL = (0u), /*开关位置处于DECEL位置 */ STATUS_CRUS2_AECEL, /*开关位置处于AECEL位置 */ STATUS_CRUS2_DISTANCE_AEC, /*开关位置处于DISTANCE+位置 */ STATUS_CRUS2_DISTANCE_DEC, /*开关位置处于DISTANCE-位置 */ STATUS_CRUS2_REST_BAND, /*开关全部断开*/ STATUS_CRUS2_SHORT_2_BAT, /*开关对电源短路 */ STATUS_CRUS2_SHORT_2_GND, /*开关对地短路 */ STATUS_CRUS2_OUTRANGE, /*OUT of range*/ STATUS_CRUS2_ALL }CRUS2SwitchStatus_ENUM;  typedef struct CRUS1Matrix_Tag { BOOL IOStatus; U16 adValue; BOOL CCSwStsOnSwA; /*表示On有效性*/ BOOL CCSwStsRsmSwA; /*表示Resume有效性*/ BOOL CCSwStsCanclSwA; /*表示Cancel有效性*/ BOOL CCSwStsSetSwA ; /*表示Set有效性*/ U8 CCSwStsSwDataIntgty; /*表示数据完整性*/ }CRUS1Matrix_ST;  typedef struct CRUS2Martrix_Tag { U16 adcValuepre; U16 adValue; BOOL CCSwStsSpdDecSwA; /*表示Decel有效性*/ BOOL CCSwStsSpdIncSwA; /*表示Incell有效性*/ BOOL CCSwStsDistDecSwA; /*表示Distance +有效性*/ BOOL CCSwStsDistIncSwA; /*表示Distance-有效性*/ U8 CCSwStsSwDataIntgty; /*表示数据完整性*/ }CRUS2Matrix_ST;   typedef enum CRUS_CCSwStsSwDataIntgty_Tag { STATUS_CRUS_DATAVALID = (0u), STATUS_CRUS_DATAINVALID, STATUS_CRUS_FAILUREDETECTED, STATUS_CRUS_ILLEGARANGE, STATUS_CRUS_ALL }CRUS_CCSwStsSwDataIntgty_ENUM;    /*constant define*/   const CRUS1Matrix_ST crus4Key_Martrix[] = /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of 计算元素个数*/ { /*IOStatus, adValue, CCSwStsOnSwA, CCSwStsRsmSwA, CCSwStsCanclSwA , CCSwStsSetSwA , CCSwStsSwDataIntgty */ {STATUS_IOM_HIGH, CRUS_SIGNAL_OFF, FALSE, FALSE, FALSE, FALSE, STATUS_CRUS_DATAVALID}, {STATUS_IOM_HIGH, CRUS_SIGNAL_ON, FALSE, FALSE, FALSE, FALSE, STATUS_CRUS_FAILUREDETECTED}, {STATUS_IOM_HIGH, CRUS_SIGNAL_CANCEL, FALSE, FALSE, FALSE, FALSE, STATUS_CRUS_FAILUREDETECTED}, {STATUS_IOM_HIGH, CRUS_SIGNAL_RESUME, FALSE, FALSE, FALSE, FALSE, STATUS_CRUS_FAILUREDETECTED}, {STATUS_IOM_HIGH, CRUS_SIGNAL_SET, FALSE, FALSE, FALSE, TRUE, STATUS_CRUS_DATAVALID}, {STATUS_IOM_LOW, CRUS_SIGNAL_OFF, FALSE, FALSE, FALSE, FALSE, STATUS_CRUS_FAILUREDETECTED}, {STATUS_IOM_LOW, CRUS_SIGNAL_ON, TRUE, FALSE, FALSE, FALSE, STATUS_CRUS_DATAVALID}, {STATUS_IOM_LOW, CRUS_SIGNAL_CANCEL, TRUE, FALSE, TRUE, FALSE, STATUS_CRUS_DATAVALID}, {STATUS_IOM_LOW, CRUS_SIGNAL_RESUME, TRUE, TRUE, FALSE, FALSE, STATUS_CRUS_DATAVALID}, {STATUS_IOM_LOW, CRUS_SIGNAL_SET, TRUE, FALSE, FALSE, TRUE, STATUS_CRUS_DATAVALID} };  const CRUS2Matrix_ST crus8Key_Martrix[] = /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr size of 计算元素个数*/ { /*adcValuepre, adValue, CCSwStsSpdDecSwA, CCSwStsSpdIncSwA, CCSwStsDistDecSwA, CCSwStsDistIncSwA, CCSwStsSwDataIntgty*/ {CRUS_SIGNAL_REST_BAND, CRUS_SIGNAL_DECEL, TRUE, FALSE, FALSE, FALSE, STATUS_CRUS_DATAVALID}, {CRUS_SIGNAL_REST_BAND, CRUS_SIGNAL_AECEL, FALSE, TRUE, FALSE, FALSE, STATUS_CRUS_DATAVALID}, {CRUS_SIGNAL_REST_BAND, CRUS_SIGNAL_DISTANCE_AEC, FALSE, FALSE, TRUE, FALSE, STATUS_CRUS_DATAVALID}, {CRUS_SIGNAL_REST_BAND, CRUS_SIGNAL_DISTANCE_DEC, FALSE, FALSE, FALSE, TRUE, STATUS_CRUS_DATAVALID} };  /bin /cmd /dev /etc /git-bash.exe /git-cmd.exe /LICENSE.txt /mingw64 /proc /ReleaseNotes.html /tmp /unins000.dat /unins000.exe /unins000.msg /usr Private static functions declare */ static void crus_LocalProcess(void); static void crus_CalRollingCnt(void); static void crus_CalCCSwStsPV(void); static void crus_ChangeSignalStatus(BOOL value); static void crus_KeyStatusProcess(void); static void crus_KeyFaultRemove(void); static void crus_KeyFaultCheck(void);  #endif /*_CRUS_PRIVATE_H_*/  /*------------------end of file----------------------------*/  /*=========================================================================== crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h File Revision History(bottom to top:first revision to last revision) *============================================================================ crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h $Log:$ * crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h Rev: Userid: Date: Description *-------- ---------- --------- ------------------------------ * crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h V1.0 Hejianjun 2016-11-30 Initial crus.c crus_cfg.h crus_info.inc crus_private.h crus_public.h V2.0 chensongming 2016-6-29 modify *===========================================================================*/
